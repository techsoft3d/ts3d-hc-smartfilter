var hcSmartSearch;(()=>{"use strict";var e={d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SmartSearch:()=>n,SmartSearchCondition:()=>o,SmartSearchConditionType:()=>a,SmartSearchEditorUI:()=>p,SmartSearchManager:()=>l,SmartSearchManagerUI:()=>m,SmartSearchPropertiesUI:()=>u,SmartSearchPropertyType:()=>r,SmartSearchRelationshipType:()=>i,SmartSearchReport:()=>c,SmartSearchReportsUI:()=>d,SmartSearchResult:()=>s,SmartSearchResultsUI:()=>h,getVersion:()=>g});const a={contains:0,exists:1,notExists:2,greaterOrEqual:3,lessOrEqual:4,equals:5,unequal:6,greaterOrEqualDate:7,lessOrEqualDate:8,evaluate:9,regex:10,notregex:11},r={nodeName:0,nodeId:1,nodeChain:2,nodeType:3,nodeColor:4,relationship:5,property:6,SmartSearch:7,numChildren:8,ifcglobalid:9,bounding:10},i={none:0,nodeParent:1,nodeChildren:2,containedIn:3,spaceBoundary:4,aggregate:5};class o{static convertEnumConditionToString(e){switch(e){case a.contains:return"contains";case a.exists:return"exists";case a.notExists:return"!exists";case a.greaterOrEqual:return">=";case a.lessOrEqual:return"<=";case a.greaterOrEqualDate:return">=(Date)";case a.lessOrEqualDate:return"<=(Date)";case a.equals:return"=";case a.evaluate:return"evaluate";case a.unequal:return"≠";case a.regex:return"regex";case a.notregex:return"!regex"}}static convertStringConditionToEnum(e){switch(e){case"contains":return a.contains;case"exists":return a.exists;case"!exists":return a.notExists;case">=":return a.greaterOrEqual;case"<=":return a.lessOrEqual;case"=":return a.equals;case"≠":return a.unequal;case">=(Date)":return a.greaterOrEqualDate;case"<=(Date)":return a.lessOrEqualDate;case"evaluate":return a.evaluate;case"regex":return a.regex;case"!regex":return a.notregex}}static convertStringPropertyTypeToEnum(e){if(e.indexOf("SmartSearch")>-1)return r.SmartSearch;switch(e){case"Node Name":return r.nodeName;case"Nodeid":return r.nodeId;case"Node Chain":return r.nodeChain;case"Node Type":return r.nodeType;case"Node Color":return r.nodeColor;case"Rel:IFC ContainedIn":case"Rel:IFC SpaceBoundary":case"Rel:IFC Aggregate":case"Rel:Node Parent":case"Rel:Node Children":case"Rel:Node Children":return r.relationship;case"SmartSearch":return r.SmartSearch;case"# Children":return r.numChildren;case"IFC GlobalId":return r.ifcglobalid;case"Bounding":return r.bounding;default:return r.property}}static convertStringToRelationshipType(e){switch(e){case"Rel:IFC ContainedIn":return i.containedIn;case"Rel:IFC SpaceBoundary":return i.spaceBoundary;case"Rel:IFC Aggregate":return i.aggregate;case"Rel:Node Parent":return i.nodeParent;case"Rel:Node Children":return i.nodeChildren;default:return!1}}static convertEnumRelationshipTypeToString(e){switch(e){case i.containedIn:return"IFC ContainedIn";case i.spaceBoundary:return"IFC SpaceBoundary";case i.aggregate:return"IFC Aggregate";case i.nodeParent:return"Node Parent";case i.nodeChildren:return"Node Children"}}constructor(){this.and=!0,this.conditionType=a.contains,this.propertyType=r.nodeName,this.propertyName="",this.text="",this.childFilter=null,this.SmartSearchID=null,this.relationship=!1}toJSON(e){if(this.propertyType==r.SmartSearch&&!this.SmartSearchFitlerID){let t=e.getSmartSearchByName(this.text);t&&(this.SmartSearchID=t._id)}return{and:this.and,conditionType:this.conditionType,propertyType:this.propertyType,propertyName:JSON.parse(JSON.stringify(this.propertyName)),text:this.text,childFilter:this.childFilter,SmartSearchID:this.SmartSearchID,relationship:this.relationship}}fromJSON(e){this.and=e.and,this.conditionType=e.conditionType,this.propertyType=e.propertyType,this.propertyName=e.propertyName,this.text=e.text,this.childFilter=e.childFilter,this.SmartSearchID=e.SmartSearchID,this.relationship=null!=e.relationship&&e.relationship}setSmartSearchID(e){this.SmartSearchFitlerID=e}getSmartSearchID(){return this.SmartSearchID}setAndOr(e){this.and=e}getAndOr(){return this.and}setConditionType(e){this.conditionType=e}getConditionType(){return this.conditionType}setPropertyName(e){this.propertyName=e}getPropertyName(){return this.propertyName}setPropertyType(e){this.propertyType=e}getPropertyType(){return this.propertyType}setText(e){this.text=e}getText(){return this.text}setChildFilter(e){this.childFilter=e}getChildFilter(){return this.childFilter}}class s{static createChainText(e,t,a,r){let i=t,o=[];for(;;){let t=e.model.getNodeParent(i);if(null==t||t==a)break;o.push(e.model.getNodeName(t)),i=t}let s="";for(let e=o.length-1-r;e>=0;e--)s+=e>0?o[e]+"->":o[e];return s}constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._query=t}getTotalSearchCount(){return this._query.getSearchCounter()}getQuery(){return this._query}generateItems(e,t,a){this._items=[];for(let r=0;r<e.length;r++){let i=s.createChainText(this._viewer,e[r],t,a),o={name:this._viewer.model.getNodeName(e[r]),id:e[r],chaintext:i};this._items.push(o)}}getItems(){return this._items}makeVisible(e){let t=this._itemsToSelections();this._viewer.model.setNodesVisibility(t,e)}async setOpacity(e){let t=this._itemsToSelections();this._viewer.model.setNodesOpacity(t,e)}async setSelectable(e){let t=this._itemsToSelections();this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,t,!e)}async colorize(e){let t=this._itemsToSelections();await this._viewer.model.setNodesFaceColor(t,e)}isolateAll(){let e=this._itemsToSelections();this._viewer.view.isolateNodes(e)}selectAll(){let e=[];for(let t=0;t<this._items.length;t++)e.push(new Communicator.Selection.SelectionItem(parseInt(this._items[t].id)));this._viewer.selectionManager.add(e)}_itemsToSelections(){let e=[];for(let t=0;t<this._items.length;t++)e.push(parseInt(this._items[t].id));return e}}class n{constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._limitselectionlist=[],this._conditions=[],this._name="",this._action=["","",""],this._keepSearchingChildren=!1,this._prop=!1,this._autoColors=null,this._id=e.generateGUID(),this._searchCounter=0,this._autoColorsProperty=null,this._startnode=t||this._viewer.model.getRootNode()}getAction(e=0){return this._action[e]}setAction(e,t=0){this._action[t]=e}hasAction(){return""!=this._action[0]||""!=this._action[1]||""!=this._action[2]}clearActions(){this._action=["","",""]}setAutoColors(e=null,t=null){this._autoColors=e,this._autoColorsProperty=t}getAutoColors(){return this._autoColors}getAutoColorProperty(){return this._autoColorsProperty}async performAction(e,t=!0){if(""==this._action[0]&&""==this._action[1]&&""==this._action[2])return;let a;a=e||await this.apply();for(let e=0;e<3;e++){let r=[];if(t||"Isolate"==this._action[e]||"Show"==this._action[e])r=a;else for(let e=0;e<a.length;e++)this._viewer.model.getBranchVisibility(a[e])&&r.push(a[e]);switch(this._action[e]){case"red":await this._viewer.model.setNodesFaceColor(r,new Communicator.Color(255,0,0));break;case"green":await this._viewer.model.setNodesFaceColor(r,new Communicator.Color(0,255,0));break;case"blue":await this._viewer.model.setNodesFaceColor(r,new Communicator.Color(0,0,255));break;case"yellow":await this._viewer.model.setNodesFaceColor(r,new Communicator.Color(255,255,0));break;case"grey":await this._viewer.model.setNodesFaceColor(r,new Communicator.Color(128,128,128));break;case"Transparent":await this._viewer.model.setNodesOpacity(r,.3);break;case"Opaque":await this._viewer.model.setNodesOpacity(r,1);break;case"Isolate":await this._viewer.view.isolateNodes(r,0,!1);break;case"Show":await this._viewer.model.setNodesVisibility(r,!0);break;case"Hide":await this._viewer.model.setNodesVisibility(r,!1);break;case"Auto Color":await this.autoColorAction(r);break;case"Not Selectable":await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,r,!0);break;case"Selectable":await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,r,!1);break;case"Fit Nodes":await this._viewer.view.fitNodes(r,0);break;case"Fit World":await this._viewer.view.fitWorld(0);break;case"Select":let e=[];for(let t=0;t<r.length;t++)e.push(new Communicator.Selection.SelectionItem(r[t]));await this._viewer.selectionManager.add(e)}}}setKeepSearchingChildren(e){this._keepSearchingChildren=e}getKeepSearchingChildren(){return this._keepSearchingChildren}updateConditions(e){this._conditions=e}setProp(e){this._prop=e}getProp(){return this._prop}setName(e){this._name=e,""==this._name&&(this._name=this.generateString())}getName(){return this._name}getNumConditions(){return this._conditions.length}getCondition(e){return this._conditions[e]}addCondition(e){this._conditions.push(e)}removeCondition(e){if(1==this._conditions.length&&this._conditions[0].childFilter){let e=this._conditions[0].childFilter;this._conditions.splice(0,1);for(let t=0;t<e._conditions.length;t++)this._conditions.unshift(e._conditions[t])}else this._conditions.splice(e,1)}fromJSON(e){this._conditions=[];for(let t=0;t<e.conditions.length;t++){let a=new o;a.fromJSON(e.conditions[t]),this._conditions.push(a)}for(let e=0;e<this._conditions.length;e++)if(this._conditions[e].childFilter){let t=new n(this._manager,this._conditions[e].childFilter.startnode);t.fromJSON(this._conditions[e].childFilter),this._conditions[e].childFilter=t}if(this._name=e.name,null==e.prop?this._prop=!1:this._prop=e.prop,null==e.action?this._action=["","",""]:this._action=JSON.parse(JSON.stringify(e.action)),null==e.keepSearchingChildren?this._keepSearchingChildren=!1:this._keepSearchingChildren=e.keepSearchingChildren,e.id&&(this._id=e.id),e.autoColors){this._autoColorsProperty=e.autoColorsProperty,this._autoColors=[];for(let t=0;t<e.autoColors.length;t++)this._autoColors[e.autoColors[t].name]=new Communicator.Color(e.autoColors[t].r,e.autoColors[t].g,e.autoColors[t].b)}}toJSON(){let e=[];for(let t=0;t<this._conditions.length;t++){let a=this._conditions[t].toJSON(this._manager);this._conditions[t].childFilter&&(a.childFilter=this._conditions[t].childFilter.toJSON()),e.push(a)}let t=null;if(this._autoColors){t=[];for(let e in this._autoColors){let a=this._autoColors[e];a&&t.push({name:e,r:a.r,g:a.g,b:a.b})}}return{autoColorsProperty:this._autoColorsProperty,autoColors:t,action:this._action,conditions:e,name:this._name,id:this._id,keepSearchingChildren:this._keepSearchingChildren,prop:this._prop}}limitToNodes(e){this._limitselectionlist=[],this._searchCounter=0;for(let t=0;t<e.length;t++)this._limitselectionlist.push(e[t])}getLimitSelectionList(){return this._limitselectionlist}getStartNode(){return this._startnode}getSearchCounter(){return 0==this._limitselectionlist.length?this._searchCounter-1:this._searchCounter}async apply(){this._selectionBounds=null,this._searchCounter=0;let e=this._conditions,t=this._limitselectionlist;for(let t=0;t<e.length;t++)e[t].text=e[t].text.replace(/&quot;/g,'"'),"/*"==e[t].propertyName.slice(-2)?e[t].wildcardString=e[t].propertyName.slice(0,-2):e[t].wildcardString=null,e[t].wildcardArray=null;let a=[];if(0==t.length)this._startnode==this._viewer.model.getRootNode()?await this._gatherMatchingNodesRecursive(e,this._startnode,a,this._startnode,""):await this._gatherMatchingNodesRecursive(e,this._startnode,a,this._viewer.model.getNodeParent(this._startnode),"");else for(let r=0;r<t.length;r++)await this._gatherMatchingNodesRecursive(e,t[r],a,this._viewer.model.getNodeParent(t[r]),"");if(this._manager.getFilterBodies()){let e=[],t=[];for(let r=0;r<a.length;r++)if(this._viewer.model.getNodeType(a[r])!=Communicator.NodeType.BodyInstance)t[a[r]]||(e.push(a[r]),t[a[r]]=!0);else{let i=this._viewer.model.getNodeParent(a[r]);t[i]||(e.push(i),t[i]=!0)}return e}return a}async testOneNodeAgainstConditions(e){let t=this._conditions;for(let e=0;e<t.length;e++)t[e].text=t[e].text.replace(/&quot;/g,'"');return await this._testNodeAgainstConditions(e,this._conditions,"")}async findAllPropertiesOnNode(e,t,a,i){let o,s,n;t?(o=t,s=a,n=i):(o=this._conditions,s=[],n=[]);for(let t=0;t<o.length;t++)if(o[t].childFilter)await this.findAllPropertiesOnNode(e,o[t].childFilter._conditions,s,n);else if(o[t].propertyType==r.property){let a=this._manager._propertyHash[e];a[o[t].propertyName]&&!n[o[t].propertyName]&&(n[o[t].propertyName]=!0,s.push({name:o[t].propertyName,value:a[o[t].propertyName]}))}return s}generateString(){let e="";for(let t=0;t<this._conditions.length;t++)t>0&&(e+=" "+(this._conditions[t].and?"and":"or")+" "),this._conditions[t].childFilter?e+="("+this._conditions[t].childFilter.generateString()+") ":(this._conditions[t].relationship&&(e+="Rel:"+o.convertEnumRelationshipTypeToString(this._conditions[t].relationship)+"("),this._conditions[t].propertyType==r.SmartSearch&&(e+="("),e+=this._conditions[t].propertyName+" "+o.convertEnumConditionToString(this._conditions[t].conditionType)+" "+this._conditions[t].text,this._conditions[t].propertyType==r.SmartSearch&&(e+=")"),this._conditions[t].relationship&&(e+=")"));return e=e.replace(/&quot;/g,'"'),e}async _checkSpaceBoundaryCondition(e,t){let r,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._spaceBoundaryHash[e]?r=this._manager._spaceBoundaryHash[e]:(r=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.SpaceBoundary),this._manager._spaceBoundaryHash[e]=r),r.length>0){let a=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<r.length;e++)if(await this._testNodeAgainstConditions(parseInt(r[e])+a,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==a.notExists)return!0;return!1}async _checkNodeParentCondition(e,t){let a=this._viewer.model.getNodeParent(e),r=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;return t.relationship=!1,await this._testNodeAgainstConditions(a+r,i,"")?(t.relationship=o,!0):(t.relationship=o,!1)}async _checkNodeChildrenCondition(e,t){let a=this._viewer.model.getNodeChildren(e);if(a.length>0){let r=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<a.length;e++)if(await this._testNodeAgainstConditions(a[e]+r,i,""))return t.relationship=o,!0;t.relationship=o}return!1}async _checkAggregateCondition(e,t){let r,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._aggregateHash[e]?r=this._manager._aggregateHash[e]:(r=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.Aggregates),this._manager._aggregateHash[e]=r),r.length>0){let a=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<r.length;e++)if(await this._testNodeAgainstConditions(parseInt(r[e])+a,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==a.notExists)return!0;return!1}async _checkContainedInCondition(e,t){let r,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._containedInSpatialStructureHash[e]?r=this._manager._containedInSpatialStructureHash[e]:(r=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.ContainedInSpatialStructure),this._manager._containedInSpatialStructureHash[e]=r),r.length>0){let a=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<r.length;e++)if(await this._testNodeAgainstConditions(parseInt(r[e])+a,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==a.notExists)return!0;return!1}_evaluateComparison(e){const t=e.match(/^\s*(-?\d+(?:\.\d+)?)\s*([<>]=?)\s*(-?\d+(?:\.\d+)?)\s*$/);if(!t)return!1;const a=parseFloat(t[1]),r=t[2],i=parseFloat(t[3]);switch(r){case"<":return a<i;case">":return a>i;case"<=":return a<=i;case">=":return a>=i;default:return!1}}_extractCoordinates(e){const t=e.match(/x:([\d,\-]+(\.\d+)?)\s*y:([\d,\-]+(\.\d+)?)\s*z:([\d,\-]+(\.\d+)?)/);if(t){const e=parseFloat(t[1].replace(",","")),a=parseFloat(t[3].replace(",","")),r=parseFloat(t[5].replace(",",""));return new Communicator.Point3(e,a,r)}}async _checkCondition(e,t,i){if(t.conditionType!=a.contains&&t.conditionType!=a.regex&&t.conditionType!=a.notregex){if(t.conditionType==a.exists||t.conditionType==a.notExists){let i=!1,o=!1;return t.conditionType==a.notExists&&(o=!0),t.propertyType==r.property?this._manager._propertyHash[e]&&null!=this._manager._propertyHash[e][t.propertyName]&&(i=!0):t.propertyType==r.nodeName?""!=this._viewer.model.getNodeName(e)&&(i=!0):t.propertyType==r.nodeId||t.propertyType==r.nodeType?i=!0:t.propertyType==r.ifcglobalid?null!=this._viewer.model.getGenericIdFromBimId(e,e.toString())&&(i=!0):t.propertyType==r.nodeColor&&0==this._viewer.model.getNodeChildren(e).length&&(await this._viewer.model.getNodesEffectiveFaceColor([e]))[0]&&(i=!0),o?!i:i}let i;if(t.propertyType==r.nodeName)i=parseFloat(this._viewer.model.getNodeName(e));else if(t.propertyType==r.nodeId)i=e;else if(t.propertyType==r.numChildren)i=this._viewer.model.getNodeChildren(e).length;else{if(t.conditionType==a.evaluate){let a;if("COG"==t.propertyName){let r=this._manager._propertyHash[e][t.propertyName];if(!r)return!1;let i=this._extractCoordinates(r);a=new Communicator.Box(i,i)}else{try{a=await this._viewer.model.getNodesBounding([e])}catch(e){return!1}if(-1!=t.text.indexOf("bounds:")){let e=t.text.replace("bounds:","").split(" ");return a.min.x>=parseFloat(e[0])&&a.min.y>=parseFloat(e[1])&&a.min.z>=parseFloat(e[2])&&a.max.x<=parseFloat(e[3])&&a.max.y<=parseFloat(e[4])&&a.max.z<=parseFloat(e[5])}}let r=t.text.split(","),i=0;for(let e=0;e<r.length;e++)if(-1!=r[e].indexOf("x")){let t;t=-1!=r[e].indexOf(">")?r[e].replace("x",a.min.x.toString()):r[e].replace("x",a.max.x.toString()),this._evaluateComparison(t)&&i++}else if(-1!=r[e].indexOf("y")){let t;t=-1!=r[e].indexOf(">")?r[e].replace("y",a.min.y.toString()):r[e].replace("y",a.max.y.toString()),this._evaluateComparison(t)&&i++}else if(-1!=r[e].indexOf("z")){let t;t=-1!=r[e].indexOf(">")?r[e].replace("z",a.min.z.toString()):r[e].replace("z",a.max.z.toString()),this._evaluateComparison(t)&&i++}return!(!i||i!=r.length)}{let r;if(this._manager._propertyHash[e]&&(r=this._manager._propertyHash[e][t.propertyName]),null==r)return t.conditionType==a.unequal;i=parseFloat(r)}}if(t.conditionType==a.greaterOrEqualDate||t.conditionType==a.lessOrEqualDate){let r;if(this._manager._propertyHash[e]&&(r=this._manager._propertyHash[e][t.propertyName]),null==r)return!1;-1!=r.indexOf(" ")||isNaN(parseInt(r))||(r=parseInt(r));let i=new Date(r);if(isNaN(i.getDate()))return!1;let o=t.text;-1!=o.indexOf(" ")||isNaN(parseInt(o))||(o=parseInt(o));let s=new Date(o);if(t.conditionType==a.greaterOrEqualDate){if(i>=s)return!0}else if(t.conditionType==a.lessOrEqualDate&&i<=s)return!0;return!1}{let e=parseFloat(t.text);if(isNaN(e)||isNaN(i))return!1;if(t.conditionType==a.greaterOrEqual){if(i>=e)return!0}else if(t.conditionType==a.lessOrEqual){if(i<=e)return!0}else if(t.conditionType==a.unequal){if(i!=e)return!0}else if(i==e)return!0;return!1}}{let o;o=t.conditionType==a.contains?t.text.split(","):t.text;let n="";if(t.propertyType==r.nodeName)n=this._viewer.model.getNodeName(e);else if(t.propertyType==r.relationship)n=i;else if(t.propertyType==r.nodeChain)n=i||s.createChainText(this._viewer,e,this._viewer.model.getRootNode(),0);else if(t.propertyType==r.numChildren){let t=this._viewer.model.getNodeChildren(e);for(let e=0;e<t.length;e++)n+=this._viewer.model.getNodeName(t[e])}else if(t.propertyType==r.nodeType)n=Communicator.NodeType[this._viewer.model.getNodeType(e)];else if(t.propertyType==r.nodeColor)if(this._viewer.model.getNodeChildren(e).length>0)n="x";else{let t=await this._viewer.model.getNodesEffectiveFaceColor([e]);n=t.length>0?t[0].r+" "+t[0].g+" "+t[0].b:"x"}else n=t.propertyType==r.nodeId?e.toString():t.propertyType==r.ifcglobalid?this._viewer.model.getGenericIdFromBimId(e,e.toString()):null==this._manager._propertyHash[e]||null==this._manager._propertyHash[e][t.propertyName]?void 0:this._manager._propertyHash[e][t.propertyName];if(null==n&&(n=""),t.conditionType!=a.contains){let e,r;try{e=new RegExp(o,"gi")}catch(e){return!1}return r=!!n.match(e),t.conditionType==a.regex?r:!r}let l=0,c=0,d=0,h=0,p=0;for(let e=0;e<o.length;e++){let a,i;if('"'==o[e][0]||'"'==o[e][1])if(a=!0,'"'==o[e][0])i=o[e].substring(1,o[e].length-1);else{let t=o[e][0];i=o[e].substring(2,o[e].length-1),i=t+i}else i=o[e],a=!1;if(t.propertyType==r.nodeId&&(a=!0),""==i||1==i.length&&("+"==i[0]||"-"==i[0]))return;"+"==i[0]?(c++,a?n.toLowerCase()==i.substring(1).toLowerCase()&&l++:-1!=n.toLowerCase().indexOf(i.substring(1).toLowerCase())&&l++):"-"==i[0]?(d++,a?n.toLowerCase()!=i.substring(1).toLowerCase()&&h++:-1==n.toLowerCase().indexOf(i.substring(1).toLowerCase())&&h++):a?n.toLowerCase()==i.toLowerCase()&&p++:-1!=n.toLowerCase().indexOf(i.toLowerCase())&&p++}return c==l&&d==h&&(p>0||l+h==o.length)}}async _testNodeAgainstConditions(e,t,s){let n=0,l=!1;t.length>1&&!t[1].and&&(l=!0);for(let c=0;c<t.length;c++){let d;if(t[c].relationship)t[c].relationship==i.spaceBoundary?d=await this._checkSpaceBoundaryCondition(e,t[c]):t[c].relationship==i.containedIn?d=await this._checkContainedInCondition(e,t[c]):t[c].relationship==i.aggregate?d=await this._checkAggregateCondition(e,t[c]):t[c].relationship==i.nodeParent?d=await this._checkNodeParentCondition(e,t[c]):t[c].relationship==i.nodeChildren&&(d=await this._checkNodeChildrenCondition(e,t[c]));else if(t[c].propertyType==r.SmartSearch){if(!t[c].SmartSearch)if(t[c].SmartSearchID)t[c].SmartSearch=this._manager.getSmartSearchByID(t[c].SmartSearchID);else{let e=this._manager.getSmartSearchByName(t[c].text);t[c].SmartSearchID=e._id,t[c].SmartSearch=e}d=await this._testNodeAgainstConditions(e,t[c].SmartSearch._conditions,s),t[c].conditionType==a.unequal&&(d=!d)}else if(t[c].wildcardString){if(!t[c].wildcardArray){t[c].wildcardArray=[];for(let e in this._manager._allPropertiesHash)-1!=e.indexOf(t[c].wildcardString)&&-1==e.indexOf("/*")&&t[c].wildcardArray.push(e)}let r=new o;r.propertyType=t[c].propertyType,r.text=t[c].text,r.conditionType=t[c].conditionType;let i=0;for(let o=0;o<t[c].wildcardArray.length;o++)if(r.propertyName=t[c].wildcardArray[o],d=await this._checkCondition(e,r,s),1==d){if(r.conditionType==a.contains||r.conditionType==a.exists)break;i++}r.conditionType==a.notExists&&(d=i==t[c].wildcardArray.length)}else d=t[c].childFilter?await this._testNodeAgainstConditions(e,t[c].childFilter._conditions,s):await this._checkCondition(e,t[c],s);if(0==d){if(!l)break}else n++}return!!(!l&&n==t.length||l&&n>0)}async _gatherMatchingNodesRecursive(e,t,a,r,i){if(this._searchCounter++,this._searchCounter%1500==0&&await new Promise((e=>setTimeout(e,1))),this._manager.getSearchVisible()&&!this._viewer.model.getBranchVisibility(t))return;let o=this._viewer.model.getNodeName(t)+">";if(t!=r&&await this._testNodeAgainstConditions(t,e,i)&&(a.push(t),null!=this._manager.getKeepSearchingChildren()?!this._manager.getKeepSearchingChildren():!this._keepSearchingChildren))return;let s=this._viewer.model.getNodeChildren(t);for(let t=0;t<s.length;t++)await this._gatherMatchingNodesRecursive(e,s[t],a,r,i+o)}async autoColorAction(e){if(this._autoColors){let t=[],a=this._autoColorsProperty;if(a)if("Node Name"==a)for(let a=0;a<e.length;a++){let r=this._viewer.model.getNodeName(e[a]);null==t[r]&&(t[r]={ids:[]}),t[r].ids.push(e[a])}else{let r=a;for(let a=0;a<e.length;a++){let i=e[a];null!=this._manager._propertyHash[i][r]&&(null==t[this._manager._propertyHash[i][r]]&&(t[this._manager._propertyHash[i][r]]={ids:[]}),t[this._manager._propertyHash[i][r]].ids.push(e[a]))}}for(let e in t)this._autoColors[e]&&await this._viewer.model.setNodesFaceColor(t[e].ids,this._autoColors[e])}}}class l{constructor(e){this._viewer=e,this._SmartSearchs=[],this._modelHash=[],this._keepSearchingChildren=!0,this._searchVisible=!1,this._ignoreBodies=!1,this._filterBodies=!1}setIgnoreBodies(e){this._ignoreBodies=e}getIgnoreBodies(){return this._ignoreBodies}setFilterBodies(e){this._filterBodies=e}getFilterBodies(){return this._filterBodies}setSearchVisible(e){this._searchVisible=e}getSearchVisible(){return this._searchVisible}addSmartSearch(e){this._SmartSearchs.push(e)}async executeSearchActions(){this._viewer.pauseRendering(),await this._viewer.model.reset(),await this._viewer.model.unsetNodesFaceColor([this._viewer.model.getAbsoluteRootNode()]),await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[this._viewer.model.getAbsoluteRootNode()],!1),await this._viewer.selectionManager.clear();for(let e=0;e<this._SmartSearchs.length;e++)await this._SmartSearchs[e].performAction(null,!1);this._viewer.resumeRendering()}setSearches(e){this._SmartSearchs=e}setKeepSearchingChildren(e){this._keepSearchingChildren=e}getKeepSearchingChildren(){return this._keepSearchingChildren}getSmartSearchs(){return this._SmartSearchs}getSmartSearchByName(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t].getName()==e)return this._SmartSearchs[t]}getSmartSearchByID(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t]._id==e)return this._SmartSearchs[t]}getSmartSearchNum(){return this._SmartSearchs.length}getSmartSearch(e){return this._SmartSearchs[e]}getSmartSearchID(e){return this._SmartSearchs[e]._id}removeSmartSearch(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t]._id==e)return this._SmartSearchs.splice(t,1)}updateSmartSearch(e,t){this._SmartSearchs[e]=t}updateSmartSearchIsProp(e,t){for(let a=0;a<this._SmartSearchs.length;a++)this._SmartSearchs[a]._id==e&&this._SmartSearchs[a].setProp(t)}toJSON(){let e=[];for(let t=0;t<this._SmartSearchs.length;t++)e.push(this._SmartSearchs[t].toJSON());return e}fromJSON(e){this._SmartSearchs=[];for(let t=0;t<e.length;t++){let a=new n(this);a.fromJSON(e[t]),this.addSmartSearch(a)}return e}async evaluateProperties(e){let t=[];for(let a=0;a<this._SmartSearchs.length;a++)if(this._SmartSearchs[a].getProp()){let r=this._SmartSearchs[a],i=!1;if(null!=this._keepSearchingChildren?!this._keepSearchingChildren:!r._keepSearchingChildren){let t=e;for(;t=this._viewer.model.getNodeParent(t),t!=this._viewer.model.getRootNode();)if(await r.testOneNodeAgainstConditions(t)){i=!0;break}}if(i)continue;if(await r.testOneNodeAgainstConditions(e)){let a=await r.findAllPropertiesOnNode(e),i=r.getName();""==i&&(i=r.generateString()),t.push({name:i,properties:a})}}return t}async _getModelTreeIdsRecursive(e,t,a){if(a.length%1e3==0&&await new Promise((e=>setTimeout(e,1))),this._ignoreBodies&&this._viewer.model.getNodeType(e)==Communicator.NodeType.BodyInstance)return;t.push(this._viewer.model.getNodeProperties(e)),a.push(e);let r=this._viewer.model.getNodeChildren(e);for(let e=0;e<r.length;e++)await this._getModelTreeIdsRecursive(r[e],t,a)}addModel(e,t,a){for(let a=0;a<this._modelHash.length;a++)if(this._modelHash[a].id==e)return void(this._modelHash[a].nodeid=t);this._modelHash.push({id:e,nodeid:t,savedHash:a,ids:null,properties:null})}_updateHashes(e,t,a){for(let r=0;r<t.length;r++){this._propertyHash[e[r]]=t[r];let i=this._viewer.model.getNodeLayerId(e[r]);if(null!=i&&a.size>1)if(null==this._propertyHash[e[r]]&&(this._propertyHash[e[r]]=[]),3==this._viewer.model.getNodeType(e[r])){let t=this._viewer.model.getNodeParent(e[r]);null==this._propertyHash[t]&&(this._propertyHash[t]=[]),this._propertyHash[t].LAYER=a.get(i)}else this._propertyHash[e[r]].LAYER=a.get(i);for(let e in t[r])this._allPropertiesHash[e]=[],null==this._allPropertiesHashNum[e]?this._allPropertiesHashNum[e]=1:this._allPropertiesHashNum[e]++}for(let e in this._propertyHash)for(let t in this._propertyHash[e]){if(this._propertyHash[e][t]=this._propertyHash[e][t].replace(/,/g,""),"OWNERHISTORY/CreationDate"==t||"OWNERHISTORY/LastModifiedDate"==t){let a=new Date(0);a.setUTCSeconds(parseInt(this._propertyHash[e][t])),this._propertyHash[e][t]=a.toDateString()}this._allPropertiesHash[t][this._propertyHash[e][t]]=!0}}parseSavedPropertyHash(e){let t=e.allprops,a=e.nodeprops,r=e.related,i=[],o=[];for(let e=0;e<a.length;e++){let r=a[e];o.push(r.i);let s={},n=r.p;for(let e=0;e<n.length;e+=2)s[t[n[e]].name]=t[n[e]].values[n[e+1]];i.push(s)}let s=[],n=[],l=[];if(r)for(let e=0;e<r.length;e++){let t=r[e];t.e?s[parseInt(t.i)]=t.e:s[parseInt(t.i)]=[],t.f?n[parseInt(t.i)]=t.f:n[parseInt(t.i)]=[],t.g?l[parseInt(t.i)]=t.g:l[parseInt(t.i)]=[]}return{ids:o,props:i,relatedSpaceBoundary:s,relatedContainedIn:n,relatedAggregateIn:l}}gatherRelatedDataHashesRecursive(e,t){let a=this._viewer.model.getBimIdFromNode(e),r={i:e},i=this._viewer.model.getBimIdRelatingElements(e,a,Communicator.RelationshipType.SpaceBoundary),o=this._viewer.model.getBimIdRelatingElements(e,a,Communicator.RelationshipType.ContainedInSpatialStructure),s=this._viewer.model.getBimIdRelatingElements(e,a,Communicator.RelationshipType.Aggregates);i&&i.length>0&&(r.e=i),o&&o.length>0&&(r.f=o),s&&s.length>0&&(r.g=s),t.push(r);let n=this._viewer.model.getNodeChildren(e);for(let e=0;e<n.length;e++)this.gatherRelatedDataHashesRecursive(n[e],t)}exportPropertyHash(){let e=[],t=[],a=[];for(let t in this._allPropertiesHash){let r={name:t,values:Object.keys(this._allPropertiesHash[t])},i=[];for(let e=0;e<r.values.length;e++)i[r.values[e]]=e;r.ehash=i,e.push(r),a[t]=e.length-1}for(let r in this._propertyHash){let i=[];for(let t in this._propertyHash[r]){let o=e[a[t]];i.push(a[t],o.ehash[this._propertyHash[r][t]])}t.push({i:r,p:i})}for(let t=0;t<e.length;t++)e[t].ehash=void 0;return this.gatherRelatedDataHashesRecursive(this._viewer,this._viewer.model.getRootNode(),[]),{allprops:e,nodeprops:t}}_consolidateBodies(){let e=[];for(let t in this._propertyHash)3==this._viewer.model.getNodeType(parseInt(t))&&this._propertyHash[t]&&this._propertyHash[t].Volume&&(e[this._viewer.model.getNodeParent(parseInt(t))]=!0);for(let t in e){let e=this._viewer.model.getNodeChildren(parseInt(t)),a=0,r=0;for(let t=0;t<e.length;t++){let i=e[t];this._propertyHash[i]&&this._propertyHash[i].Volume&&(a+=parseFloat(this._propertyHash[i].Volume)),this._propertyHash[i]&&this._propertyHash[i]["Surface Area"]&&(r+=parseFloat(this._propertyHash[i]["Surface Area"]))}if(a+="mm³",r+="mm²",this._propertyHash[t].Volume=a,this._propertyHash[t]["Surface Area"]=r,this._viewer.model.getNodeName(parseInt(t)).startsWith("Product")){let e=this._viewer.model.getNodeParent(parseInt(t));this._propertyHash[e].Volume=a,this._propertyHash[e]["Surface Area"]=r}}}async initialize(){this._propertyHash=[],this._allPropertiesHash=[],this._allPropertiesHashNum=[],this._containedInSpatialStructureHash=[],this._aggregateHash=[],this._spaceBoundaryHash=[],this._totalNodes=0;let e=this._viewer.model.getLayers();if(0==this._modelHash.length){let t=[],a=[];await this._getModelTreeIdsRecursive(this._viewer.model.getRootNode(),t,a);let r=await Promise.all(t);this._updateHashes(a,r,e),this._consolidateBodies(),this._totalNodes=a.length}else for(let t=0;t<this._modelHash.length;t++){let a=this._modelHash[t],r=[],i=null,o=this._viewer.model.getNodeIdOffset(a.nodeid);if(a.ids){for(let e=0;e<a.ids.length;e++)r.push(a.ids[e]+o);i=a.properties}else{let e=[];if(a.savedHash){let e=this.parseSavedPropertyHash(a.savedHash);i=e.props,r=e.ids,this._containedInSpatialStructureHash=e.relatedContainedIn,this._aggregateHash=e.relatedAggregateIn,this._spaceBoundaryHash=e.relatedSpaceBoundary}else this._getModelTreeIdsRecursive(a.nodeid,e,r),i=await Promise.all(e);a.properties=i,a.ids=[];for(let e=0;e<r.length;e++)a.ids.push(r[e]-o)}this._totalNodes+=r.length,this._updateHashes(r,i,e)}}getTotalNodes(){return this._totalNodes-1}getAllOptionsForProperty(e){return this._allPropertiesHash[e]}getNumOptions(e){if(null!=this._allPropertiesHash[e])return Object.keys(this._allPropertiesHash[e]).length}getNumOptionsUsed(e){if(null!=this._allPropertiesHash[e])return this._allPropertiesHashNum[e]}getAllProperties(e=!1){let t=[],a=!1;!e&&this._allPropertiesHash.TYPE&&(a=!0);let r=!1;this._allPropertiesHash.LAYER&&(r=!0);let i=!1;this._allPropertiesHash["Surface Area"]&&(i=!0);let o=!1;this._allPropertiesHash.Volume&&(o=!0);for(let a in this._allPropertiesHash)"TYPE"==a&&!e||"LAYER"==a||"Surface Area"==a||"Volume"==a||t.push(a);t.sort(),t.unshift("---"),e||(t.unshift("IFC GlobalId"),t.unshift("Rel:IFC SpaceBoundary"),t.unshift("Rel:IFC Aggregate"),t.unshift("Rel:IFC ContainedIn"),a&&t.unshift("TYPE"),t.unshift("---")),t.unshift("Rel:Node Children"),t.unshift("Rel:Node Parent"),t.unshift("SmartSearch"),t.unshift("Bounding"),t.unshift("# Children"),r&&t.unshift("LAYER"),i&&t.unshift("Surface Area"),o&&t.unshift("Volume"),t.unshift("Node Color"),t.unshift("Node Type"),t.unshift("Node Chain"),t.unshift("Nodeid"),t.unshift("Node Name");for(let e=0;e<t.length;e++)if(-1!=t[e].indexOf("Materials and Finishes/")){t.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<t.length;e++)if(-1!=t[e].indexOf("Other/")){t.splice(e,0,"Other/*");break}return t}generateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}class c{constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._result=t,this._orgProperties=[],this._tableParams=[],this._tableParamsExpanded=[],this.expandedColorsHash=[];for(let e=0;e<this._result.getQuery().getNumConditions();e++){let t=this._result.getQuery().getCondition(e);-1==t.propertyName.indexOf("Node Chain")&&(t.conditionType==a.exists?this._orgProperties.push(t.propertyName):this._tableParams.push({prop:t.propertyName}))}0==this._orgProperties.length&&this._orgProperties.push("Node Name")}getExpandedColorsHash(){return this.expandedColorsHash}clearExpandedColorsHash(){this.expandedColorsHash=[]}getTableParams(){return this._tableParams}getOrgString(){let e="";if(1==this._orgProperties.length)return this._orgProperties[0];for(let t=0;t<this._orgProperties.length;t++)e+="["+this._orgProperties[t]+"]";return e}initializeExpanded(e){if(this._expandedCategory=e,null==e){let e=this._result.getItems(),t=[];for(let a=0;a<e.length;a++)t.push(e[a].id);this.expandedIds=t}else this.expandedIds=this.getCategoryHash()[e].ids;this._tableParamsExpanded=JSON.parse(JSON.stringify(this._tableParams)),0==this._tableParamsExpanded.length&&this._tableParamsExpanded.push({prop:"Node Name"})}getExpandedIds(){return this.expandedIds}getTableParamsExpanded(){return this._tableParamsExpanded}getExpandedCategory(){return this._expandedCategory}async _findPropValue(e,t){if("Node Name"==e)return t.name;if("Nodeid"==e)return t.id;if(-1==e.indexOf("Bounding-Z")){if("Node Name (No :Ext)"==e){let e,a=t.name.lastIndexOf(":");return e=a>-1?t.name.substring(0,a):t.name,e}if("Node Name (No -Ext)"==e){let e,a=t.name.lastIndexOf("-");return e=a>-1?t.name.substring(0,a):t.name,e}if("Node Parent"==e)return this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t.id));if("Node Type"==e)return Communicator.NodeType[this._viewer.model.getNodeType(t.id)];{let a=t.id;return this._manager._propertyHash[a][e]}}try{return(await this._viewer.model.getNodesBounding([t.id])).center().z}catch(e){return"EMPTY"}}async _findPropValue2(e,t){if(-1!=e.indexOf("Node Name"))return this._viewer.model.getNodeName(t);if(-1==e.indexOf("Bounding-Z"))return"Nodeid"==e?t:"Node Parent"==e?this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t)):"Node Type"==e?Communicator.NodeType[this._viewer.model.getNodeType(t)]:this._manager._propertyHash[t][e];try{return(await this._viewer.model.getNodesBounding([t])).center().z}catch(e){return"EMPTY"}}async generateTableHash(){let e=this._result.getItems();this._categoryHash=[];for(let t=0;t<e.length;t++){let a="";for(let r=0;r<this._orgProperties.length;r++){let i=this._orgProperties[r],o=await this._findPropValue(i,e[t]);1==this._orgProperties.length?a=null!=o?o:"":a+=null!=o?"["+o+"]":"[]"}null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(e[t].id)}}async _getTableParamData(e,t){let a,r,i=e.prop,o=!0,s=!0,n=!1,l=0;this.isNumberProp(i)||(s=!1);for(let e=0;e<t.length;e++){let r=await this._findPropValue2(i,t[e]);if(null!=r){let e=parseFloat(r);isNaN(e)?s=!1:(l+=e,n=!0)}e>0&&a!=r&&(o=!1),a=r}return r=n&&s?e.aggtype&&"sum"!=e.aggtype?o?parseFloat(a):"[Multiple]":l:o?null==a?"":a:"[Multiple]",{isSame:o,isNumber:n&&s,result:r}}async determineColumnTypes(){let e=[];for(let t=0;t<this._tableParams.length;t++){let a=!1;for(let e in this._categoryHash)if((await this._getTableParamData(this._tableParams[t],this._categoryHash[e].ids)).isNumber){a=!0;break}a&&this.isNumberProp(this._tableParams[t].prop)?e.push({isNumber:!0,unit:this.getAMTUnit(this._tableParams[t].prop)}):e.push({isNumber:!1,unit:""})}return e}async getExpandedTableData(){let e=[];for(let t=0;t<this.expandedIds.length;t++){let a={id:this.expandedIds[t]};for(let e=0;e<this._tableParamsExpanded.length;e++){let r=await this._getTableParamData(this._tableParamsExpanded[e],[this.expandedIds[t]]);a["tableParams"+e]=r.result}e.push(a)}return e}async getTableData(){let e=[];for(let t in this._categoryHash){let a={org:t,num:this._categoryHash[t].ids.length,color:"",id:t};for(let e=0;e<this._tableParams.length;e++){let r=await this._getTableParamData(this._tableParams[e],this._categoryHash[t].ids);a["tableParams"+e]=r.result}e.push(a)}return e}getTableProperty(){return this._tableProperty}setTableProperty(e){this._tableProperty=e}deleteOrgProperty(e){let t=this._orgProperties.indexOf(e);t>-1&&this._orgProperties.splice(t,1)}deleteTableParams(e){for(let t=0;t<this._tableParams.length;t++)if(this._tableParams[t].prop==e){this._tableParams.splice(t,1);break}}deleteTableParamsExpanded(e){for(let t=0;t<this._tableParamsExpanded.length;t++)if(this._tableParamsExpanded[t].prop==e){this._tableParamsExpanded.splice(t,1);break}}getCategoryHash(){return this._categoryHash}findCategoryFromSearch(){let e=this._result.getQuery(),t=this._result.getItems();if(this._categoryHash=[],this._tableProperty)if("/*"==this._tableProperty.slice(-2)&&(this._tableProperty="Node Name"),"Node Name"==this._tableProperty)for(let e=0;e<t.length;e++)null==this._categoryHash[t[e].name]&&(this._categoryHash[t[e].name]={ids:[]}),this._categoryHash[t[e].name].ids.push(t[e].id);else if("Node Name (No :Ext)"==this._tableProperty)for(let e=0;e<t.length;e++){let a,r=t[e].name.lastIndexOf(":");a=r>-1?t[e].name.substring(0,r):t[e].name,null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}else if("Node Name (No -Ext)"==this._tableProperty)for(let e=0;e<t.length;e++){let a,r=t[e].name.lastIndexOf("-");a=r>-1?t[e].name.substring(0,r):t[e].name,null==SmartSearchResultsUI._categoryHash[a]&&(SmartSearchResultsUI._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}else if("Node Parent"==this._tableProperty)for(let e=0;e<t.length;e++){let a=this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t[e].id));null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}else if("Node Type"==this._tableProperty)for(let e=0;e<t.length;e++){let a=Communicator.NodeType[this._viewer.model.getNodeType(t[e].id)];null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}else{let e=this._tableProperty;for(let a=0;a<t.length;a++){let r=t[a].id;null!=this._manager._propertyHash[r][e]&&(null==this._categoryHash[this._manager._propertyHash[r][e]]&&(this._categoryHash[this._manager._propertyHash[r][e]]={ids:[]}),this._categoryHash[this._manager._propertyHash[r][e]].ids.push(t[a].id))}}else{for(let a=0;a<e.getNumConditions();a++){let i=e.getCondition(a);if(i.propertyType==r.nodeName||i.wildcardString){for(let e=0;e<t.length;e++)null==this._categoryHash[t[e].name]&&(this._categoryHash[t[e].name]={ids:[]}),this._categoryHash[t[e].name].ids.push(t[e].id);return void(this._tableProperty="Node Name")}if(i.relationship==r.nodeParent){for(let e=0;e<t.length;e++){let a=this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t[e].id));null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}return void(this._tableProperty="Node Parent")}if(i.propertyType==r.nodeType){for(let e=0;e<t.length;e++){let a=Communicator.NodeType[this._viewer.model.getNodeType(t[e].id)];null==this._categoryHash[a]&&(this._categoryHash[a]={ids:[]}),this._categoryHash[a].ids.push(t[e].id)}return void(this._tableProperty="Node Type")}if(i.propertyType==r.property){let e=i.propertyName;for(let e=0;e<t.length;e++){let a=t[e].id;null!=this._manager._propertyHash[a][i.propertyName]&&(null==this._categoryHash[this._manager._propertyHash[a][i.propertyName]]&&(this._categoryHash[this._manager._propertyHash[a][i.propertyName]]={ids:[]}),this._categoryHash[this._manager._propertyHash[a][i.propertyName]].ids.push(t[e].id))}return void(this._tableProperty=e)}}this._tableProperty="Node Name",this.findCategoryFromSearch()}}calculateAMT(e,t,a){if("sum"==a){let a=0;for(let r=0;r<t.length;r++){let i=this._manager._propertyHash[t[r]][e];null!=i&&(a+=parseFloat(i))}return a}{let r=[];for(let a=0;a<t.length;a++){let i=SmartSearchResultsUI._manager._propertyHash[t[a]][e];null!=i&&r.push(parseFloat(i))}if(0===r.length)return 0;if("avg"==a)return r.reduce(((e,t)=>e+t),0)/r.length;if("max"==a)return Math.max(...r);if("min"==a)return Math.min(...r);if("med"==a){r.sort(((e,t)=>e-t));const e=Math.floor(r.length/2);return r.length%2==0?(r[e-1]+r[e])/2:r[e]}}}getAMTUnit(e){let t=this._manager._allPropertiesHash[e];if(null!=t)for(let e in t){if(-1!=e.indexOf("mm²"))return"mm²";if(-1!=e.indexOf("m²"))return"m²";if(-1!=e.indexOf("mm³"))return"mm³";if(-1!=e.indexOf("m³"))return"m³";if(-1!=e.indexOf("mm"))return"mm";if(-1!=e.indexOf("m"))return"m";if(-1!=e.indexOf("inch³"))return"inch³";if(-1!=e.indexOf("inch²"))return"inch²";break}}isNumberProp(e){let t=e.toLowerCase();if(-1!=t.indexOf("version")||-1!=t.indexOf("globalid")||-1!=t.indexOf("nodeid")||-1!=t.indexOf("name")||-1!=t.indexOf("date")||-1!=t.indexOf("persistentid"))return!1;if(-1!=t.indexOf("bounding-z"))return!0;let a=this._manager._allPropertiesHash[e];if(null!=a)for(let e in a){if(!isNaN(parseFloat(e)))return!0;break}return!1}getAllPropertiesExpanded(){let e=this.expandedIds,t=[],a=[];for(let e in this._manager._allPropertiesHash)t.push(e);for(let t=0;t<e.length;t++){let r=e[t];for(let e in this._manager._propertyHash[r])a[e]=!0}let r=[];for(let e=0;e<t.length;e++)null!=a[t[e]]&&r.push(t[e]);r.sort(),r.unshift("Bounding-Z"),r.unshift("Nodeid"),r.unshift("Node Parent"),r.unshift("Node Type"),r.unshift("Node Name (No -Ext)"),r.unshift("Node Name (No :Ext)"),r.unshift("Node Name");for(let e=0;e<r.length;e++)if(-1!=r[e].indexOf("Materials and Finishes/")){r.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<r.length;e++)if(-1!=r[e].indexOf("Other/")){r.splice(e,0,"Other/*");break}return r}getAllProperties(){let e=this._result.getItems(),t=[],a=[];for(let e in this._manager._allPropertiesHash)t.push(e);for(let t=0;t<e.length;t++){let r=e[t].id;for(let e in this._manager._propertyHash[r])a[e]=!0}let r=[];for(let e=0;e<t.length;e++)null!=a[t[e]]&&r.push(t[e]);r.sort(),r.unshift("Bounding-Z"),r.unshift("Nodeid"),r.unshift("Node Parent"),r.unshift("Node Type"),r.unshift("Node Name (No -Ext)"),r.unshift("Node Name (No :Ext)"),r.unshift("Node Name");for(let e=0;e<r.length;e++)if(-1!=r[e].indexOf("Materials and Finishes/")){r.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<r.length;e++)if(-1!=r[e].indexOf("Other/")){r.splice(e,0,"Other/*");break}return r}getCategoryTableData(e,t){let a=[],r=this._result.getQuery().getAutoColors();if(r)for(let e in this._categoryHash)r[e]||(r[e]=this._categoryHash[e].color);for(let i in this._categoryHash){let o=r?r[i]:null,s=i;this.isNumberProp(this.getTableProperty())&&(s=parseFloat(i));let n={name:s,num:this._categoryHash[i].ids.length,color:o?"rgba("+o.r+","+o.g+","+o.b+",1)":"",id:i};if("--EMPTY--"!=e){let a=this.calculateAMT(e,this._categoryHash[i].ids,t);n.amt=a}a.push(n)}return a}async calculateGradientDataExpanded(e){let t=await this.getExpandedTableData(),a=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<t.length;i++){let o=parseFloat(t[i][e]);isNaN(o)||(o<a&&(a=o),o>r&&(r=o))}let i=r-a;this.expandedColorsHash=[];for(let r=0;r<t.length;r++){let o=parseFloat(t[r][e]);if(!isNaN(o)){let e=(o-a)/i*255;this.expandedColorsHash[t[r].id]=new Communicator.Color(e,e,e)}}}async calculateGradientData(e){let t=await this.getTableData(),a=Number.MAX_VALUE,r=-Number.MAX_VALUE;for(let i=0;i<t.length;i++){let o;o="num"==e?parseInt(t[i].num):parseFloat(t[i][e]),isNaN(o)||(o<a&&(a=o),o>r&&(r=o))}let i=r-a;for(let r=0;r<t.length;r++){let o;if(o="num"==e?parseInt(t[r].num):parseFloat(t[r][e]),!isNaN(o)){let e=(o-a)/i*255;this._categoryHash[t[r].id].color=new Communicator.Color(e,e,e)}}}async caculateExpandedColorsGradient(e,t,a,r){let i=e,o=await this.getExpandedTableData(t,a,r),s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<o.length;e++){let t;t="prop1"==i?parseFloat(o[e].prop1):parseFloat(o[e].prop2),t<s&&(s=t),t>n&&(n=t)}let l=n-s,c=[];for(let e=0;e<o.length;e++){let t;t="prop1"==i?parseFloat(o[e].prop1):parseFloat(o[e].prop2);let a=(t-s)/l*256;c.push({id:o[e].id,colorsav:a,color:"rgba("+a+","+a+","+a+",1)"})}return c}convertColor(e){switch(e){case"red":return new Communicator.Color(255,0,0);case"green":return new Communicator.Color(0,255,0);case"blue":return new Communicator.Color(0,0,255);case"yellow":return new Communicator.Color(255,255,0);case"brown":return new Communicator.Color(150,75,0);case"black":return new Communicator.Color(0,0,0);case"white":return new Communicator.Color(255,255,255);case"orange":return new Communicator.Color(255,165,0);case"grey":return new Communicator.Color(128,128,128)}}}class d{static initialize(e,t){d._maindiv=e,d._manager=t,d._viewer=t._viewer,d._isPropertyView=!1,d._tablePropertyAMT="--EMPTY--",d._aggType="sum",d._tablePropertyExpanded1="--EMPTY--",d._tablePropertyExpanded2="--EMPTY--",d._table=null,d._selectionFromTable=!1,d._viewer.setCallbacks({selectionArray:function(e,t){!d._selectionFromTable&&d._table&&d._table.deselectRow()}}),d.display()}static async display(){let e="";e+='<div id = "SmartSearchReportsUIMain" style="position:absolute;width:100%;height:100%;font-size:12px">',e+='<div id = "SmartSearchReportsUIOptions" style="background:white;position:absolute;width:325px;height:100%"></div>',e+='<div id = "SmartSearchReportsUITabulator" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px"></div>',e+='<div id = "SmartSearchReportsUIOptionsExpanded" style="background:white;position:absolute;width:325px;height:100%;display:none"></div>',e+='<div id = "SmartSearchReportsUITabulatorExpanded" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px;display:none"></div>',e+="</div>",$("#"+d._maindiv).empty(),$("#"+d._maindiv).append('<div id = "SmartSearchReportsUIMain" style="position:absolute;width:100%;height:100%;font-size:12px"><div id = "SmartSearchReportsUIOptions" style="background:white;position:absolute;width:325px;height:100%"></div><div id = "SmartSearchReportsUITabulator" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px"></div><div id = "SmartSearchReportsUIOptionsExpanded" style="background:white;position:absolute;width:325px;height:100%;display:none"></div><div id = "SmartSearchReportsUITabulatorExpanded" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px;display:none"></div></div>')}static getAmountStrings(e){let t=[];t.push("--EMPTY--");for(let a=0;a<e.length;a++){let r=e[a].toLowerCase();if(-1!=r.indexOf("version")||-1!=r.indexOf("globalid")||-1!=r.indexOf("name")||-1!=r.indexOf("date")||-1!=r.indexOf("persistentid"))continue;let i=d._manager._allPropertiesHash[e[a]];if(null!=i)for(let r in i){isNaN(parseFloat(r))||t.push(e[a]);break}}return t}static _orgPropertySelected(){d._report._orgProperties.push($("#SmartSearchOrgPropSelect")[0].value),d._generateSettingsWindow()}static _tablePropertySelected(){d._report._tableParams.push({prop:$("#SmartSearchTablePropSelect")[0].value}),d._generateSettingsWindow()}static _tablePropertySelectedExpanded(){d._report._tableParamsExpanded.push({prop:$("#SmartSearchTablePropSelectExpanded")[0].value}),d._generateSettingsWindowExpanded()}static _propertySelected(){d._results.setTableProperty($("#SmartSearchPropSelect")[0].value),p._mainFilter.setAutoColors(null,null),d._generatePropertyView()}static _propertyExpandedSelected(e){0==e?d._tablePropertyExpanded0=$("#SmartSearchPropExpandedSelect0")[0].value:1==e&&(d._tablePropertyExpanded1=$("#SmartSearchPropExpandedSelect1")[0].value),d.generateExpandedResults()}static _propertyAggTypeSelected(){d._aggType=$("#SmartSearchPropAggType")[0].value,d._generatePropertyView()}static _propertyAMTSelected(){d._tablePropertyAMT=$("#SmartSearchPropSelectAMT")[0].value,d._generatePropertyView()}static applyColors(){for(let e in d._report.getCategoryHash())d._report.getCategoryHash()[e].color&&p._viewer.model.setNodesFaceColor(d._report.getCategoryHash()[e].ids,d._report.getCategoryHash()[e].color)}static _assignColorsMainGradient(){let e=d._table.getRows(),t=256/e.length;for(let a=0;a<e.length;a++){let r=t*e[a].getPosition();d._report.getCategoryHash()[e[a].getData().id].color=new Communicator.Color(r,r,r)}d._updateColorsInTable()}static _updateColorsInTableExpanded(){let e=[];for(let t in d._report.getExpandedColorsHash()){let a,r=d._report.getExpandedColorsHash()[t];a=r?{color:"rgba("+r.r+","+r.g+","+r.b+",1)",id:t}:{color:null,id:t},e.push(a)}d._table.updateData(e)}static _updateColorsInTable(){let e=[];for(let t in d._report.getCategoryHash()){let a,r=d._report.getCategoryHash()[t].color;a=r?{color:"rgba("+r.r+","+r.g+","+r.b+",1)",id:t}:{color:null,id:t},e.push(a)}d._table.updateData(e)}static _assignExpandedColorsGradient(e){let t=d._results.caculateExpandedColorsGradient(e,this._expandedNodeIds,this._tablePropertyExpanded0,this._tablePropertyExpanded1);d._table.updateData(t)}static applyExpandedColors(){let e=d._table.getRows();for(let t=0;t<e.length;t++){let a=e[t].getData().id;p._viewer.model.setNodesFaceColor([parseInt(a)],d._report.getExpandedColorsHash()[a])}}static async _assignColorsGradientExpanded(e){await d._report.calculateGradientDataExpanded(e),d._updateColorsInTableExpanded()}static async _assignColorsGradient(e){let t=e;"org"!=e||!(!d._report._orgProperties.length>1)&&d._report.isNumberProp(d._report._orgProperties[0])?(await d._report.calculateGradientData(t),d._updateColorsInTable()):d._assignColorsMainGradient()}static assignColorsRandom(){for(let e in d._report.getCategoryHash()){let t=new Communicator.Color(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()));d._report.getCategoryHash()[e].color=t}d._updateColorsInTable()}static _clearColors(){let e=[];for(let t in d._report.getCategoryHash()){d._report.getCategoryHash()[t].color=void 0;let a={color:null,id:t};e.push(a)}d._table.updateData(e)}static _clearColorsExpanded(){d._report.clearExpandedColorsHash();let e=d._table.getRows(),t=[];for(let a=0;a<e.length;a++){let r={color:null,id:e[a].getData().id};t.push(r)}d._table.updateData(t)}static generateReport(e){d._report=e,d._generateSettingsWindow()}static _deleteFromButton(e,t){let a=$(e).prev()[0].innerHTML;0==t?d._report.deleteOrgProperty(a):d._report.deleteTableParams(a),d._generateSettingsWindow()}static _deleteFromButtonExpanded(e){let t=$(e).prev()[0].innerHTML;d._report.deleteTableParamsExpanded(t),d._generateSettingsWindowExpanded()}static _setColumnAggregator(e,t){if(-1!=e.indexOf("tableParams")){let a=parseInt(e.split("tableParams")[1]);d._report.getTableParams()[a].aggtype=t,d._generateTable(!1)}}static _generateOrgButton(e,t){let a="";return a+='<button class="rectangular-button">',a+="<span>"+e+'</span><span onclick = "hcSmartSearch.SmartSearchReportsUI._deleteFromButton(this,'+t+')" class="x">&times;</span>',a+="</button>",a}static _generateExpandedButton(e){let t="";return t+='<button class="rectangular-button">',t+="<span>"+e+'</span><span onclick = "hcSmartSearch.SmartSearchReportsUI._deleteFromButtonExpanded(this)" class="x">&times;</span>',t+="</button>",t}static async _generateTable(e=!0){e&&await d._report.generateTableHash();let t=[{label:"<i class='fas fa-user'></i> Single",action:async function(e,t){d._setColumnAggregator(t.getDefinition().field,"single")}},{label:"<i class='fas fa-user'></i> Sum",action:async function(e,t){d._setColumnAggregator(t.getDefinition().field,"sum")}},{separator:!0},{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],a=[{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],r=[{label:"<i class='fas fa-user'></i> View Category",action:async function(e,t){d._report.initializeExpanded(t.getData().id),d._generateSettingsWindowExpanded(),d._generateExpandedTable()}},{label:"<i class='fas fa-user'></i> View All",action:async function(e,t){d._report.initializeExpanded(),d._generateSettingsWindowExpanded(),d._generateExpandedTable()}}];$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>');let i=[],o={title:d._report.getOrgString(),field:"org",sorter:"string",headerMenu:a};1==d._report._orgProperties.length&&d._report.isNumberProp(o.title)&&(o.sorter="number"),i.push(o),i.push({title:"#",field:"num",width:65,bottomCalc:"sum",headerMenu:a});let s=await d._report.determineColumnTypes();for(let e=0;e<d._report._tableParams.length;e++){let a=d._report._tableParams[e].prop;s[e].isNumber&&(null!=s[e].unit&&(a+="("+s[e].unit+")"),d._report._tableParams[e].aggtype&&"sum"!=d._report._tableParams[e].aggtype||(a+=" Σ"));let r={title:a,field:"tableParams"+e,headerMenu:t};s[e].isNumber&&(r.sorter="number"),s[e].isNumber&&(d._report._tableParams[e].aggtype&&"sum"!=d._report._tableParams[e].aggtype||(r.bottomCalc="sum")),i.push(r)}i.push({title:"Color",field:"color",headerSort:!1,field:"color",editor:"list",width:45,formatter:"color",editorParams:{values:["empty","red","green","blue","yellow","brown","orange","grey","black","white"]}}),i.push({title:"ID",field:"id",width:20,visible:!1}),d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:16,selectable:!0,selectableRangeMode:"click",layout:"fitColumns",columns:i,rowContextMenu:r}),d._table.on("tableBuilt",(async function(){let e=await d._report.getTableData();d._table.setData(e)})),d._table.on("rowSelectionChanged",(async function(e,t){d._selectionFromTable=!0;let a=d._table.getSelectedData();d._viewer.selectionManager.clear();let r=[];for(let e=0;e<a.length;e++){let t=d._report.getCategoryHash()[a[e].id].ids;for(let e=0;e<t.length;e++)r.push(new Communicator.Selection.SelectionItem(t[e]))}d._viewer.selectionManager.add(r),d._selectionFromTable=!1})),d._table.on("cellEdited",(function(e){if("color"==e.getField()){let t,a=e.getRow().getData();t="empty"!=a.color?d._report.convertColor(a.color):null,d._report.getCategoryHash()[a.id].color=t;let r=d._table.getSelectedData();if(r.length>1)for(let e=0;e<r.length;e++)d._report.getCategoryHash()[r[e].id].color=t;d._updateColorsInTable()}}))}static async _generateSettingsWindow(){let e=await d._report.getAllProperties();e.unshift("Choose Property"),$("#SmartSearchReportsUIOptions").empty();let t='<div style="height:55px;">';t+='<span style="top:0px;position:relative"><span style="font-family:courier">Organize by:</span><select id="SmartSearchOrgPropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._orgPropertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let a=0;a<e.length;a++)t+='<option value="'+e[a]+'">'+e[a]+"</option>\n";t+="</select></span>";for(let e=0;e<d._report._orgProperties.length;e++)t+=d._generateOrgButton(d._report._orgProperties[e],0);t+='<br><br><span style="top:0px;position:relative"><span style="font-family:courier">Params:</span><select id="SmartSearchTablePropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._tablePropertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let a=0;a<e.length;a++)t+='<option value="'+e[a]+'">'+e[a]+"</option>\n";t+="</select></span>";for(let e=0;e<d._report._tableParams.length;e++)t+=d._generateOrgButton(d._report._tableParams[e].prop,1);t+='<button class="SmartSearchSearchButton" type="button" style="right:5px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateTable()">Generate</button>',t+='<button class="SmartSearchSearchButton" type="button" style="right:70px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyColors()">Apply Colors</button>',t+="</div>",$("#SmartSearchReportsUIOptions").append(t)}static async _generateExpandedTable(){let e=[{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradientExpanded(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColorsExpanded()}}];$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>');let t=[];for(let a=0;a<d._report.getTableParamsExpanded().length;a++){let r=d._report.getTableParamsExpanded()[a].prop;if(d._report.isNumberProp(d._report.getTableParamsExpanded()[a].prop)){let e=d._report.getAMTUnit(d._report.getTableParamsExpanded()[a].prop);e&&(r+="("+e+")")}let i={title:r,field:"tableParams"+a};d._report.isNumberProp(d._report.getTableParamsExpanded()[a].prop)&&(i.sorter="number",i.headerMenu=e),t.push(i)}t.push({title:"Color",field:"color",headerSort:!1,field:"color",width:45,formatter:"color"}),t.push({title:"ID",field:"id",width:20,visible:!1}),d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:16,layout:"fitColumns",selectable:!0,selectableRangeMode:"click",columns:t}),d._table.on("tableBuilt",(async function(){let e=await d._report.getExpandedTableData();d._table.setData(e)})),d._table.on("rowClick",(async function(e,t){let a=t.getData(),r=d._report.getCategoryHash()[a.id].ids;if(d._viewer.selectionManager.clear(),1==r.length)d._viewer.selectionManager.selectNode(r[0],Communicator.SelectionMode.Set);else{let e=[];for(let t=0;t<r.length;t++)e.push(new Communicator.Selection.SelectionItem(r[t]));d._viewer.selectionManager.add(e)}})),d._table.on("rowSelectionChanged",(async function(e,t){d._selectionFromTable=!0;let a=d._table.getSelectedData();d._viewer.selectionManager.clear();let r=[];if(1==a.length)d._viewer.selectionManager.selectNode(a[0].id,Communicator.SelectionMode.Set);else{for(let e=0;e<a.length;e++)r.push(new Communicator.Selection.SelectionItem(a[e].id));d._viewer.selectionManager.add(r)}d._selectionFromTable=!1}))}static async _generateSettingsWindowExpanded(e){let t=await d._report.getAllPropertiesExpanded();t.unshift("Choose Property"),$("#SmartSearchReportsUIOptions").empty();let a='<div style="height:55px;">';a+='<span style="font-weight:700">Expanded Category:'+(null!=d._report.getExpandedCategory()?d._report.getExpandedCategory():"All")+"</span><br><br>",a+='<span style="top:0px;position:relative"><span style="font-family:courier">Params:</span><select id="SmartSearchTablePropSelectExpanded" onchange=\'hcSmartSearch.SmartSearchReportsUI._tablePropertySelectedExpanded();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<t.length;e++)a+='<option value="'+t[e]+'">'+t[e]+"</option>\n";a+="</select></span>";for(let e=0;e<d._report.getTableParamsExpanded().length;e++)a+=d._generateExpandedButton(d._report.getTableParamsExpanded()[e].prop);a+='<button class="SmartSearchSearchButton" type="button" style="right:5px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateExpandedTable()">Generate</button>',a+='<button class="SmartSearchSearchButton" type="button" style="right:70px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyExpandedColors()">Apply Colors</button>',a+='<button class="SmartSearchSearchButton" type="button" style="left:0px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateSettingsWindow();hcSmartSearch.SmartSearchReportsUI._generateTable()">Full Report</button>',a+="</div>",$("#SmartSearchReportsUIOptions").append(a)}static async _generatePropertyView(e=!1){p._mainFilter.getAutoColorProperty()&&d._report.setTableProperty(p._mainFilter.getAutoColorProperty());let t=d._report.getAllProperties();if(!e){let e=!1;if(d._report.getTableProperty())for(let a=0;a<t.length;a++)if(t[a]==d._report.getTableProperty()){e=!0;break}e||d._report.setTableProperty(null),d._report.findCategoryFromSearch()}$("#SmartSearchReportsUIOptions").empty();let a=d.getAmountStrings(t),r='<div style="height:55px;"><span style="top:0px;position:relative"><span style="font-family:courier">Prop:</span><select id="SmartSearchPropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<t.length;e++)d._report.getTableProperty()==t[e]?r+='<option value="'+t[e]+'" selected>'+t[e]+"</option>\n":r+='<option value="'+t[e]+'">'+t[e]+"</option>\n";r+="</select></span>",r+='<span style="top:24px;left:0px;position:absolute"><span style="font-family:courier">AMT :</span><select id="SmartSearchPropSelectAMT" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyAMTSelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<a.length;e++)d._tablePropertyAMT==a[e]?r+='<option value="'+a[e]+'" selected>'+a[e]+"</option>\n":r+='<option value="'+a[e]+'">'+a[e]+"</option>\n";r+="</select></span>",r+='<span style="top:24px;left:186px;position:absolute"><span style="font-family:courier"></span><select id="SmartSearchPropAggType" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyAggTypeSelected();\' class="SmartSearchPropertyAggTypeSelect" value="">';let i,o=["sum","avg","max","min","med"];for(let e=0;e<o.length;e++)d._aggType==o[e]?r+='<option value="'+o[e]+'" selected>'+o[e]+"</option>\n":r+='<option value="'+o[e]+'">'+o[e]+"</option>\n";r+="</select></span>",r+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyColors()">Apply Colors</button>',r+="</div>",$("#SmartSearchReportsUIOptions").append(r),$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>'),-1!=d._report.getTableProperty().indexOf("Date")&&(i=function(e,t,a,r,i,o,s){let n=new Date(e),l=new Date(t);return n>l?1:n<l?-1:0});let s=[{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],n=d._report.getTableProperty();if(d._report.isNumberProp(d._report.getTableProperty())){let e=d._report.getAMTUnit(d._report.getTableProperty());e&&(n="("+e+")")}let l=[{title:n,field:"name",sorter:i,headerMenu:s},{title:"#",field:"num",width:65,bottomCalc:"sum",headerMenu:s},{title:"Color",field:"color",headerSort:!1,field:"color",editor:"list",width:45,formatter:"color",editorParams:{values:["red","green","blue","yellow","brown","orange","grey","black","white"]}},{title:"ID",field:"id",width:20,visible:!1}];if("--EMPTY--"!=d._tablePropertyAMT){let e=d._report.getAMTUnit(d._tablePropertyAMT),t="";t=e?d._aggType+"("+e+")":d._aggType,l.splice(1,0,{headerMenu:s,title:t,field:"amt",width:120,bottomCalc:"med"!=d._aggType?d._aggType:void 0})}let c=[{label:"<i class='fas fa-user'></i> View Category",action:async function(e,t){let a=d._report.getCategoryHash()[t.getData().id].ids;if("/*"==d._report.getTableProperty().slice(-2)){let e=t.getData().id.split("/");d._tablePropertyExpanded0=d._report.getTableProperty().slice(0,-2)+"/"+e[0]}else d._tablePropertyExpanded0=d._report.getTableProperty();d._tablePropertyExpanded1=d._tablePropertyAMT,d.generateExpandedResults(a)}},{label:"<i class='fas fa-user'></i> View All",action:async function(e,t){let a=p._founditems.getItems(),r=[];for(let e=0;e<a.length;e++)r.push(a[e].id);d._tablePropertyExpanded0=d._report.getTableProperty(),d._tablePropertyExpanded1=d._tablePropertyAMT,d.generateExpandedResults(r)}}];d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:15,selectable:0,layout:"fitColumns",columns:l,rowContextMenu:c}),d._table.on("rowClick",(async function(e,t){let a=t.getData(),r=d._report.getCategoryHash()[a.id].ids;if(d._viewer.selectionManager.clear(),1==r.length)d._viewer.selectionManager.selectNode(r[0],Communicator.SelectionMode.Set);else{let e=[];for(let t=0;t<r.length;t++)e.push(new Communicator.Selection.SelectionItem(r[t]));d._viewer.selectionManager.add(e)}})),d._table.on("tableBuilt",(function(){let e=d._report.getCategoryTableData(d._tablePropertyAMT,d._aggType);d._table.setData(e)})),d._table.on("cellEdited",(function(e){if("color"==e.getField()){let t=p._mainFilter.getAutoColors();t||(t=[],p._mainFilter.setAutoColors(t,d._report.getTableProperty()));let a=e.getRow().getData();t[a.id]=d._report.convertColor(a.color)}d._table.redraw()}))}static generateExpandedResults(e=null){let t;e?(d._expandedNodeIds=e,t=e):t=d._expandedNodeIds,this._expandedNodeIds=t,-1!=d._tablePropertyExpanded0.indexOf("Node Name")&&(d._tablePropertyExpanded0="Node Type"),$("#"+d._maindiv+"_searchitems").empty(),$("#"+d._maindiv+"_searchitems").css("overflow","inherit"),$("#"+d._maindiv+"_found").empty(),$("#SmartSearchReportsUIFirstRow").css("display","none");let a=d._results.getAllProperties();a.shift(),a.shift();let r='<div style="height:35px;">';r+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:-5px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchReportsUI._generatePropertyView(true)\'>Property View</button>',r+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:17px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyExpandedColors()">Apply Colors</button>',r+='<div style="height:25px;"><span style="top:-5px;position:relative"><span style="font-family:courier">Prop1:</span><select id="SmartSearchPropExpandedSelect0" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyExpandedSelected(0);\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<a.length;e++)d._tablePropertyExpanded0==a[e]?r+='<option value="'+a[e]+'" selected>'+a[e]+"</option>\n":r+='<option value="'+a[e]+'">'+a[e]+"</option>\n";r+="</select></span>",r+='<span style="top:15px;left:0px;position:absolute"><span style="font-family:courier">Prop2:</span><select id="SmartSearchPropExpandedSelect1" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyExpandedSelected(1);\' class="SmartSearchPropertyResultsSelect" value="">',a.unshift("--EMPTY--");for(let e=0;e<a.length;e++)d._tablePropertyExpanded1==a[e]?r+='<option value="'+a[e]+'" selected>'+a[e]+"</option>\n":r+='<option value="'+a[e]+'">'+a[e]+"</option>\n";r+="</select></span>",r+="</div>",$("#"+d._maindiv+"_searchitems").append(r),$("#"+d._maindiv+"_searchitems").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>'),d._tablePropertyExpanded0;let i,o,s=function(e,t,a,r,i,o,s){let n=new Date(e),l=new Date(t);return"Invalid Date"==n||"Invalid Date"==l?-1:n>l?1:n<l?-1:0},n=[{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignExpandedColorsGradient(t.getDefinition().field)}}],l=[{title:"Name",field:"name"},{title:"ID",field:"id",visible:!1},{title:"Color",field:"color",headerSort:!1,field:"color",width:45,formatter:"color"}],c="";if(d._results.isNumberProp(d._tablePropertyExpanded0)){let e=d._results.getAMTUnit(d._tablePropertyExpanded0);e?(c="("+e+")",i="sum"):c=d._tablePropertyExpanded0}else c=d._tablePropertyExpanded0;if(l.splice(1,0,{headerMenu:n,title:c,field:"prop1",bottomCalc:i,sorter:-1!=d._tablePropertyExpanded0.indexOf("Date")?s:void 0}),"--EMPTY--"!=d._tablePropertyExpanded1){let e="";if(d._results.isNumberProp(d._tablePropertyExpanded1)){let t=d._results.getAMTUnit(d._tablePropertyExpanded1);t?(e="("+t+")",o="sum"):e=d._tablePropertyExpanded1}else e=d._tablePropertyExpanded1;l.splice(2,0,{headerMenu:n,title:e,field:"prop2",bottomCalc:o,sorter:-1!=d._tablePropertyExpanded1.indexOf("Date")?s:void 0})}d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:15,selectable:!0,selectableRangeMode:"click",layout:"fitColumns",columns:l}),d._table.on("rowSelectionChanged",(async function(e,t){var a=d._table.getSelectedData();d._viewer.selectionManager.clear();let r=[];if(1==a.length)d._viewer.selectionManager.selectNode(a[0].id,Communicator.SelectionMode.Set);else{for(let e=0;e<a.length;e++)r.push(new Communicator.Selection.SelectionItem(a[e].id));d._viewer.selectionManager.add(r)}})),d._table.on("tableBuilt",(function(){let e=d._results.getExpandedTableData(t,d._tablePropertyExpanded0,d._tablePropertyExpanded1);d._table.setData(e)}))}}class h{static _enableReport=!1;static initialize(e,t){h._maindiv=e,h._manager=t,h._viewer=t._viewer,h._viewer.setCallbacks({selectionArray:function(e,t){h.generateSearchResults(p._founditems)}})}static setPopulateReportCallback(e){h._populateReportCallback=e}static setEnableReport(e){h._enableReport=e}static async display(){let e="";e+='<div id = id="'+h._maindiv+'_firstrow" style="position:relative;width:100%;height:15px;top:-8px">',e+='<div style="position:absolute; left:3px;top:5px; font-size:14px;background-color:white" id="'+h._maindiv+'_found"></div>',e+=h._generateDropdown(),e+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchEditorUI.selectAll(this)\'>Select</button>',h._enableReport&&(e+='<button id="SmartSearchToggleViewButton" class="SmartSearchSearchButton" type="button" style="right:90px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchResultsUI._populateReport()\'>Create Report</button>'),e+="</div>",e+='<div id="'+h._maindiv+'_searchitems" class="SmartSearchSearchItems">',e+="</div>",e+='<div style="position:absolute; right:20px;bottom:0px; font-size:12px;background-color:white" id="'+h._maindiv+'_found"></div>',$("#"+h._maindiv).empty(),$("#"+h._maindiv).append(e);const t=document.querySelector("#SmartSearchResultsUIDropdown"),a=document.querySelector("#SmartSearchResultsUIDropdownContent");t.addEventListener("click",(function(){if($(a).hasClass("SmartSearchDropdowShow"))$(t).append(a),$(a).parent().offset();else{$("body").append(a);let e=$(t).offset(),r=e.top,i=e.left,o=$(a).height(),s=$(a).width();r+o>$(window).height()&&(r=$(window).height()-o-10),i+s>$(window).width()&&(i=$(window).width()-s-30),$(a).css("top",r+"px"),$(a).css("left",i+"px")}a.classList.toggle("SmartSearchDropdowShow")})),window.addEventListener("click",(function(e){e.target.matches(".SmartSearchDropdow-button")||a.classList.contains("SmartSearchDropdowShow")&&a.classList.remove("SmartSearchDropdowShow")}))}static _populateReport(){if(null!=h._populateReportCallback)h._populateReportCallback();else{let e=new hcSmartSearch.SmartSearchReport(this._manager,p._founditems);d.generateReport(e)}}static async generateSearchResults(e){if(h._results=e,$("#"+h._maindiv+"_firstrow").css("display","block"),$("#"+h._maindiv+"_searchitems").css("overflow","auto"),$("#"+h._maindiv+"_found").empty(),null==e)return void $("#"+h._maindiv+"_searchitems").empty();let t=e.getItems();1==t.length?$("#"+h._maindiv+"_found").append(t.length+" item found / "+p._founditems.getTotalSearchCount()+" searched"):$("#"+h._maindiv+"_found").append(t.length+" items found / "+p._founditems.getTotalSearchCount()+" searched");let a="",r=!0,i=!1,o=t.length;t.length>2e3&&(o=2e3,i=!0);for(let e=0;e<o;e++){if(e%500==0&&await new Promise((e=>setTimeout(e,1))),r=!r,h._viewer.selectionManager.isSelected(Communicator.Selection.SelectionItem.create(t[e].id))){let i=h._viewer.model.getNodeParent(t[e].id);h._viewer.selectionManager.isSelected(Communicator.Selection.SelectionItem.create(i))?a+=r?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselectedIndirect">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselectedIndirect2">':a+=r?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselected">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselected2">'}else a+=r?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItem1">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItem2">';a+='<div class="SmartSearchSearchItemText">'+p._htmlEncode(t[e].name)+"</div>",a+='<div class="SmartSearchSearchItemChainText">'+p._htmlEncode(t[e].chaintext)+"</div>",a+="</div>"}i&&(a+='<div style="left:3px;" >More...</div>'),$("#"+h._maindiv+"_searchitems").empty(),$("#"+h._maindiv+"_searchitems").append(a),h.adjust()}static adjust(){if(0==$("#"+h._maindiv+"_searchitems").length)return;let e=$("#"+p._maindiv).height()-($("#"+h._maindiv+"_searchitems").offset().top-$("#"+p._maindiv).parent().offset().top);$("#"+h._maindiv+"_searchitems").css({height:e+"px"});let t=e+$("#"+p._maindiv+"_conditions").height()+3;p._showFirstRow&&(t+=$("#"+p._maindiv+"_firstrow").height())}static _select(e){p.ctrlPressed?h._viewer.selectionManager.selectNode(parseInt(e),Communicator.SelectionMode.Toggle):h._viewer.selectionManager.selectNode(parseInt(e),Communicator.SelectionMode.Set),h.generateSearchResults(p._founditems)}static _generateDropdown(){let e="";return e+='<button id="SmartSearchResultsUIDropdown" style="right:56px;top:3px;position:absolute;" class="SmartSearchSearchButton SmartSearchDropdow-button">...</button>',e+='<ul  id="SmartSearchResultsUIDropdownContent" style="position:absolute;z-index:10000" class="SmartSearchDropdow-content">',e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.selectAll(this)'>Select</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().isolateAll(this)'>Isolate</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(true)'>Show</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(false)'>Hide</li>",e+="<li >---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,0,0))'>Red</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,255,0))'>Green</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,0,255))'>Blue</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,255,0))'>Yellow</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(128,128,128))'>Grey</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(0.7)'>Transparent</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(1)'>Opaque</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(false)'>Not Selectable</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(true)'>Selectable</li>",e+="</ul>","<button id=\"SmartSearchResultsUIDropdown\" style=\"right:56px;top:3px;position:absolute;\" class=\"SmartSearchSearchButton SmartSearchDropdow-button\">...</button><ul  id=\"SmartSearchResultsUIDropdownContent\" style=\"position:absolute;z-index:10000\" class=\"SmartSearchDropdow-content\"><li onclick='hcSmartSearch.SmartSearchEditorUI.selectAll(this)'>Select</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().isolateAll(this)'>Isolate</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(true)'>Show</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(false)'>Hide</li><li >---</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,0,0))'>Red</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,255,0))'>Green</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,0,255))'>Blue</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,255,0))'>Yellow</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(128,128,128))'>Grey</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(0.7)'>Transparent</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(1)'>Opaque</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(false)'>Not Selectable</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(true)'>Selectable</li></ul>"}}class p{static _chainSkip=0;static _showFirstRow=!0;static _showPropertyStats=!0;static _hideIFCProperties=!1;static _searchResultsCallback=null;static _transparencyMode=1;static _htmlEncode(e){return(e=$.trim(e)).replace(/[&"'\<\>]/g,(function(e){switch(e){case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;";case"<":return"&lt;";default:return"&gt;"}}))}static async initialize(e,t,a){p.ctrlPressed=!1,$(document).on("keyup keydown",(function(e){p.shiftPressed=e.shiftKey,p.ctrlPressed=e.ctrlKey})),p._maindiv=e,p._manager=t,p._viewer=t._viewer,p._mainFilter=new hcSmartSearch.SmartSearch(p._manager,a),p._mainFilter.tempId=0,new ResizeObserver((function(){p.adjust()})).observe($("#"+p._maindiv)[0]),p._searchResultsCallback||h.initialize(p._maindiv+"_resultscontainer",t),await p.display()}static setHideIFCProperties(e){p._hideIFCProperties=e}static setChainSkip(e){p._chainSkip=e}static showFirstRow(e){p._showFirstRow=e}static showPropertyStats(e){p._showPropertyStats=e}static setSearchResultsCallback(e){p._searchResultsCallback=e}static _generateDropdown(){let e="";return e+='<button style="right:57px;top:3px;position:absolute;" class="SmartSearchSearchButton SmartSearchDropdow-button">...</button>',e+='<ul style="position:absolute;z-index:10000" class="SmartSearchDropdow-content">',e+='<li id="'+p._maindiv+'searchChildren"onclick=\'hcSmartSearch.SmartSearchEditorUI._setSearchChildren(this)\'><span style="left:-5px;position:absolute;">&#x2714</span>Search Children</li>',e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._setSearchVisible(this)'>Search Visible</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._setFilterBodies(this)'>Filter Bodies</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._limitSelection(this)'>Limit to Selection</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._limitSelectionShow(this)'>Show Limit Nodes</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._toggleLighting()'>Toggle Lighting</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesFaceColor([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],Communicator.Color.white())'>Set Model to White</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesVisibility([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],false)'>Hide Model</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],0.75)'>Set Model Transparent (Low)</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],0.15)'>Set Model Transparent (High)</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],1)'>Set Model Opaque</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._transparencyMode ? hcSmartSearch.SmartSearchEditorUI._transparencyMode = 0 : hcSmartSearch.SmartSearchEditorUI._transparencyMode = 1; hcSmartSearch.SmartSearchEditorUI._viewer.view.setTransparencyMode(hcSmartSearch.SmartSearchEditorUI._transparencyMode)'>Toggle Transparency Mode</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],true)'>Set Model Unselectabe</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],false)'>Set Model Selectable</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.resetModel()'>Reset Model</li>",e+="</ul>",e}static _toggleLighting(){p._viewer.view.setLightingEnabled(!p._viewer.view.getLightingEnabled())}static async display(){await p._manager.initialize();let e="";if(e+='<div class = "SmartSearchMain" id="'+p._maindiv+'_main">',p._showFirstRow&&(e+='<div id = "SmartSearchEditorUIFirstRow">',e+='<div style="position:relative;height:20px;"></div>',e+=p._generateDropdown(),e+='<button class="SmartSearchSearchButtonImportant" type="button" style="right:5px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchEditorUI.search()\'>Search</button>',e+='<hr class="SmartSearchEditorUIDivider">',e+="</div>"),e+='<div id="'+p._maindiv+'_conditions" class="SmartSearchSearchtoolsConditions">',e+=await p._generateConditions(),e+="</div>",p._searchResultsCallback||(e+="<hr>",e+='<div id="'+p._maindiv+'_resultscontainer"</div>'),e+="</div>",$("#"+p._maindiv).empty(),$("#"+p._maindiv).append(e),p._searchResultsCallback||h.display(),p._showFirstRow){const e=document.querySelector(".SmartSearchDropdow-button"),t=document.querySelector(".SmartSearchDropdow-content");e.addEventListener("click",(function(){if($(t).hasClass("SmartSearchDropdowShow"))$(e).append(t),$(t).parent().offset();else{$("body").append(t);let a=$(e).offset(),r=a.top,i=a.left,o=$(t).height(),s=$(t).width();r+o>$(window).height()&&(r=$(window).height()-o-10),i+s>$(window).width()&&(i=$(window).width()-s-30),$(t).css("top",r+"px"),$(t).css("left",i+"px")}t.classList.toggle("SmartSearchDropdowShow")})),window.addEventListener("click",(function(e){e.target.matches(".SmartSearchDropdow-button")||t.classList.contains("SmartSearchDropdowShow")&&t.classList.remove("SmartSearchDropdowShow")}))}p._generateSearchResults(),p._addFilterFromUI(!1,0),p._showFirstRow&&p._setDefaultSettingsUI()}static getFilter(){return p._mainFilter}static adjust(){p._searchResultsCallback||h.adjust()}static flush(){$("#"+p._maindiv).empty()}static async search(e=!1){p.updateFilterFromUI(),p.clearSearchResults(),$("#SmartSearchEditorUIFirstRow").css("opacity",.5),$("#SmartSearchEditorUIFirstRow").css("pointer-events","none"),p._searchResultsCallback||$("#"+h._maindiv+"_found").append("Searching...");let t=await p._mainFilter.apply();$("#SmartSearchEditorUIFirstRow").css("opacity",""),$("#SmartSearchEditorUIFirstRow").css("pointer-events","");let a=p._mainFilter.getStartNode();p._founditems=new hcSmartSearch.SmartSearchResult(this._manager,p._mainFilter),p._founditems.generateItems(t,a,p._chainSkip),p._generateSearchResults(),e&&p._mainFilter.performAction(t)}static _getSmartSearchFromTempId(e){if(0==e)return p._mainFilter;for(let t=0;t<p._mainFilter.getNumConditions();t++){let a=p._mainFilter.getCondition(t);if(a.childFilter&&a.childFilter.tempId==e)return a.childFilter}}static async _updateSearch(){(p._founditems||p._mainFilter.getNumConditions())&&await p.search()}static resetModel(){this._viewer.model.reset(),this._viewer.model.unsetNodesFaceColor([this._viewer.model.getAbsoluteRootNode()]),this._viewer.selectionManager.clear()}static getFoundItems(){return p._founditems}static selectAll(){p.ctrlPressed||p._viewer.selectionManager.clear(),this._founditems.selectAll(),p._generateSearchResults()}static updateFilterFromUI(e){let t;t=e||p._mainFilter;for(let e=0;e<t.getNumConditions();e++){let a=t.getCondition(e);if(a.childFilter)this.updateFilterFromUI(a.childFilter);else{a.conditionType=hcSmartSearch.SmartSearchCondition.convertStringConditionToEnum($("#"+p._maindiv+"_propertyChoiceSelect"+e+"-"+t.tempId)[0].value),a.propertyType=hcSmartSearch.SmartSearchCondition.convertStringPropertyTypeToEnum($("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value);let r=!1;if(a.propertyType==hcSmartSearch.SmartSearchPropertyType.relationship&&(r=!0,a.relationship=hcSmartSearch.SmartSearchCondition.convertStringToRelationshipType($("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value),a.propertyType=hcSmartSearch.SmartSearchPropertyType.nodeName,a.propertyName="Node Name"),null!=$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0]&&(!a.propertyType==hcSmartSearch.SmartSearchPropertyType.SmartSearch?a.text=p._htmlEncode($("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0].value):a.text=$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0].value),r||(a.propertyName=$("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value),p._showPropertyStats&&a.propertyName.endsWith(")")){let e=a.propertyName.lastIndexOf("(")-1;a.propertyName=a.propertyName.substring(0,e)}}1==e?a.and="and"==$("#"+p._maindiv+"_andOrchoiceSelect"+e+"-"+t.tempId)[0].value:e>1&&(a.and="and"==$("#"+p._maindiv+"_andOrchoiceSelect1-"+t.tempId)[0].value)}}static async refreshUI(){$("#"+p._maindiv+"_conditions").empty(),$("#"+p._maindiv+"_conditions").append(await p._generateConditions()),p.adjust()}static async _andorchangedFromUI(){p.updateFilterFromUI(),await p.refreshUI()}static async _convertToChildfilter(){let e=p._mainFilter,t=new hcSmartSearch.SmartSearch(p._manager,p._mainFilter.getStartNode());for(let a=0;a<e.getNumConditions();a++){let r=e.getCondition(a);r.childFilter||(t.addCondition(r),e.removeCondition(a),a--)}if(t.getNumConditions()){let a=new hcSmartSearch.SmartSearchCondition;a.propertyName="Node Name",a.setChildFilter(t),e.addCondition(a),await p.refreshUI()}}static async _addFilterFromUI(e,t){let a;p.clearSearchResults(),p.updateFilterFromUI(),a=p._getSmartSearchFromTempId(t);let r=null;if(e&&(r=new hcSmartSearch.SmartSearch(p._manager,p._mainFilter.getStartNode()),r.addCondition(new hcSmartSearch.SmartSearchCondition)),a.getNumConditions()<=1){let e=new hcSmartSearch.SmartSearchCondition;e.propertyName="Node Name",e.setChildFilter(r),a.addCondition(e)}else{let e=a.getCondition(a.getNumConditions()-1),t=new hcSmartSearch.SmartSearchCondition;t.propertyName="Node Name",t.setChildFilter(r),t.setAndOr(e.getAndOr()),a.addCondition(t)}await p.refreshUI()}static _deleteFilter(e,t){p.clearSearchResults(),p.updateFilterFromUI(),p._getSmartSearchFromTempId(t).removeCondition(e),p.refreshUI()}static _setDefaultSettingsUI(){let e="Search Children";p._manager.getKeepSearchingChildren()&&(e='<span style="left:-5px;position:absolute;">&#x2714</span>'+e),$("#"+p._maindiv+"searchChildren").html(e)}static _setSearchChildren(e){p._manager.setKeepSearchingChildren(!p._manager.getKeepSearchingChildren());let t="Search Children";p._manager.getKeepSearchingChildren()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _setSearchVisible(e){p._manager.setSearchVisible(!p._manager.getSearchVisible());let t="Search Visible";p._manager.getSearchVisible()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _setFilterBodies(e){p._manager.setFilterBodies(!p._manager.getFilterBodies());let t="Filter Bodies";p._manager.getFilterBodies()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _limitSelectionShow(){let e=p._mainFilter.getLimitSelectionList();p._founditems=new hcSmartSearch.SmartSearchResult(this._manager,p._mainFilter),p._founditems.generateItems(e,p._viewer.model.getRootNode(),0),p.selectAll()}static _limitSelection(e){if(0==p._mainFilter.getLimitSelectionList().length){let e=[],t=p._viewer.selectionManager.getResults();for(let a=0;a<t.length;a++)e.push(t[a].getNodeId());p._mainFilter.limitToNodes(e)}else p._mainFilter.limitToNodes([]);let t="Limit Selection";0!=p._mainFilter.getLimitSelectionList().length&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static clearSearchResults(){p._founditems=void 0,p._generateSearchResults()}static _generateSearchResults(){p._searchResultsCallback?p._searchResultsCallback(p._founditems):h.generateSearchResults(p._founditems)}static _generateAndOrChoiceSelect(e,t,a){if(0==t||t>1)return 0==t?e.childFilter?'<span style="top:7px;left:6px;position:relative;font-size:14px; margin-top:2px;height:20px;width:50px;max-width:50px;min-width:50px">Where:</span>':'<span style="top:7px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;width:50px;max-width:50px;min-width:50px">Where:</span>':'<span style="top:5px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;max-width:50px;min-width:50px">'+(e.and?"and":"or")+"</span>";{let r='<span style="top:5px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;max-width:50px;min-width:50px">';return r+='<select class="SmartSearchSearchSelect" onchange=\'hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI()\' id="'+p._maindiv+"_andOrchoiceSelect"+t+"-"+a.tempId+'" value="">\n',e.and?(r+='<option value="and" selected>and</option>\n',r+='<option value="or">or</option>\n'):(r+='<option value="and">and</option>\n',r+='<option value="or" selected>or</option>\n'),r+="</select></span>\n",r}}static _generateChoiceSelect(e,t,a){let r,i='<select onchange=\'hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI()\' class="SmartSearchAndOrSelect" id="'+p._maindiv+"_propertyChoiceSelect"+t+"-"+a.tempId+'" value="">\n';r="SmartSearch"==e.propertyName?["=","≠"]:"Bounding"==e.propertyName?["evaluate"]:"COG"==e.propertyName?["contains","evaluate","exists"]:["contains","exists","!exists","regex","!regex",">=","<=",">=(Date)","<=(Date)","=","≠"];for(let t=0;t<r.length;t++)r[t]==hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(e.conditionType)?i+='<option selected value="'+r[t]+'">'+r[t]+"</option>\n":i+='<option value="'+r[t]+'">'+r[t]+"</option>\n";return i+="</select>\n",i}static _clearInputField(e,t){$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t)[0]&&($("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t)[0].value="")}static _generatePropertyTypeSelect(e,t,a){let r="<select onchange='hcSmartSearch.SmartSearchEditorUI._clearInputField("+t+","+a.tempId+');hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI();\' class="SmartSearchPropertyTypeSelect" id="'+p._maindiv+"_propertyTypeSelect"+t+"-"+a.tempId+'" value="">\n',i=p._manager.getAllProperties(p._hideIFCProperties);if(p._showPropertyStats)for(let e=0;e<i.length;e++){p._showPropertyStats;let t=p._manager.getNumOptions(i[e]);if(t){let a=p._manager.getNumOptionsUsed(i[e]);i[e]=i[e]+" ("+t+"/"+a+")"}}let o=e.propertyName;if(p._showPropertyStats){let e=p._manager.getNumOptions(o);e&&(o=o+" ("+e+"/"+p._manager.getNumOptionsUsed(o)+")")}for(let e=0;e<i.length;e++)o==i[e]?r+='<option value="'+i[e]+'" selected>'+i[e]+"</option>\n":r+='<option value="'+i[e]+'">'+i[e]+"</option>\n";return r+="</select>\n",r}static async _updateBoundingDatalist(e){let t=[],a=hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getResults();for(let e=0;e<a.length;e++)t.push(a[e].getNodeId());if(t.length>0){let a=await hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodesBounding(t),r="bounds:"+a.min.x+" "+a.min.y+" "+a.min.z+" "+a.max.x+" "+a.max.y+" "+a.max.z;$(e).next().html('<option value="'+r+'"></option>')}else $(e).next().html('<option value=""></option>')}static async _updateColorDatalist(e){if(hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getLast()){let t=hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getLast().getNodeId(),a=hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodeChildren(t);a.length>0&&(t=a[0]);let r=await hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodesEffectiveFaceColor([t]);$(e).next().html('<option value="'+r[0].r+" "+r[0].g+" "+r[0].b+'"></option>')}else $(e).next().html('<option value=""></option>')}static async _generateInput(e,t,a){let r="";r="Bounding"==e.propertyName?'<input type="search" onfocus="hcSmartSearch.SmartSearchEditorUI._updateBoundingDatalist(this)" class = "valueinput" list="datalist'+t+"-"+a.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+a.tempId+'" value="'+e.text+'">\n':"Node Color"==e.propertyName?'<input type="search" onfocus="hcSmartSearch.SmartSearchEditorUI._updateColorDatalist(this)" class = "valueinput" list="datalist'+t+"-"+a.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+a.tempId+'" value="'+e.text+'">\n':'<input type="search" class = "valueinput" list="datalist'+t+"-"+a.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+a.tempId+'" value="'+p._htmlEncode(e.text)+'">\n',r+='<datalist id="datalist'+t+"-"+a.tempId+'">\n';let i=[];if("Node Type"==e.propertyName)for(const e in Communicator.NodeType)isNaN(parseFloat(Communicator.NodeType[e]))&&i.push(Communicator.NodeType[e]);else if("SmartSearch"==e.propertyName){let e=p._manager.getSmartSearchs();for(let t=0;t<e.length;t++)i.push(e[t].getName())}else{let t=p._manager.getAllOptionsForProperty(e.propertyName);for(let e in t)i.push(e)}i.sort();for(let t=0;t<i.length;t++)e.propertyName==i[t]?r+='<option value="'+i[t]+'" selected></option>\n':r+='<option value="'+i[t]+'"></option>\n';return r+="</datalist>\n",r}static _generateTrashBin(){let e='<div title = "Delete condition" class="icon-trash" style="float: left;">';return e+='<div class="trash-lid"></div>',e+='<div class="trash-container"></div>',e+='<div class="trash-line-1"></div>',e+='<div class="trash-line-2"></div>',e+='<div class="trash-line-3"></div>',e+="</div>",'<div title = "Delete condition" class="icon-trash" style="float: left;"><div class="trash-lid"></div><div class="trash-container"></div><div class="trash-line-1"></div><div class="trash-line-2"></div><div class="trash-line-3"></div></div>'}static async _generateConditions(e,t){let a,r="";e?a=e:(p.tempId=0,a=p._mainFilter),a.tempId=p.tempId,e&&(r+='<div class = "SmartSearchChildCondition" style = "position:relative;left:65px;top:-10px">');for(let t=0;t<a.getNumConditions();t++){let i=a.getCondition(t);if(i.childFilter)p.tempId++,r+="<div>",r+='<div style="position:relative;width:10px; height:10px;float:left;top:10px;left:-1px" onclick=\'hcSmartSearch.SmartSearchEditorUI._deleteFilter('+t+","+a.tempId+")'>",r+=p._generateTrashBin(),r+="</div>",r+=p._generateAndOrChoiceSelect(i,t,a),r+=await this._generateConditions(i.childFilter,t),r+="</div>";else{i.relationship&&(r+='<div class="SmartSearchRelationshipTag" style="left:64px;position:relative">Relationship:'+hcSmartSearch.SmartSearchCondition.convertEnumRelationshipTypeToString(i.relationship)+"</div>"),r+='<div style="height:30px;margin-top:-3px">',r+='<div style="position:relative;width:10px; height:10px;float:left;top:10px;left:-1px" onclick=\'hcSmartSearch.SmartSearchEditorUI._deleteFilter('+t+","+a.tempId+")'>",r+=p._generateTrashBin(),r+="</div>",r+=p._generateAndOrChoiceSelect(i,t,a);let o=66;e&&(o*=2),r+=1==t?'<div style="display:flex;position:relative;top:-11px;left:64px;margin-right: 1em;width:calc(100%  - '+o+'px)">':'<div style="display:flex;position:relative;top:-8px;left:64px;margin-right: 1em;width:calc(100%  - '+o+'px)">',r+=p._generatePropertyTypeSelect(i,t,a),r+=p._generateChoiceSelect(i,t,a),"exists"!=hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(i.conditionType)&&"!exists"!=hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(i.conditionType)?r+=await p._generateInput(i,t,a):r+='<div style="position:relative;left:5px;top:0px;width:275px"></div>',r+="</div>",r+="</div>"}}return r+='<button title = "Add new condition" class="SmartSearchSearchButton" type="button" style="margin-top:2px;left:2px;bottom:2px;position:relative;" onclick=\'hcSmartSearch.SmartSearchEditorUI._addFilterFromUI(false,'+a.tempId+")'>Add condition</button>",r+=e?"</div>":'<button title="Add new condition group: hold down Shift to convert existing conditions to group" class="SmartSearchSearchButton" type="button" style="left:4px;bottom:2px;position:relative;" onclick=\'!hcSmartSearch.SmartSearchEditorUI.shiftPressed ? hcSmartSearch.SmartSearchEditorUI._addFilterFromUI(true,'+a.tempId+") : hcSmartSearch.SmartSearchEditorUI._convertToChildfilter(true,"+a.tempId+")'>Add condition group</button>",r}}class m{static _updatedCallback=null;static _showButtonRow=!0;static initialize(e,t,a){m._manager=t,m._viewer=t._viewer,m._table=null,m._uidiv=e,m._showButtonRow&&($("#"+m._uidiv).append('<button title = "Add search to SmartSearch Manager" class="SmartSearchSearchButton" id="SmartSearchManagerAddCurrentFilter" type="button" style="top:2px">Add</button>'),$("#"+m._uidiv).append('<button title = "Execute all queries" class="SmartSearchSearchButton" id="SmartSearchManagerExecute" type="button" style="top:2px;margin-left:2px;">Execute</button>'),a&&($("#"+m._uidiv).append('<button class="SmartSearchSearchButton" id="SmartSearchManagerExport" type="button" style="position:absolute;right:0px;top:2px">Export</button>'),$("#"+m._uidiv).append('<button class="SmartSearchSearchButton" id="SmartSearchManagerUpload" type="button" style="position:absolute;right:52px;top:2px">Load</button><input style="display:none" type="file" id="inputupload">'),$("#SmartSearchManagerExport").click((function(){m.exportToFile("SmartSearchfilters.json")})),$("#SmartSearchManagerUpload").click((function(e){e.preventDefault(),$("#inputupload").trigger("click")})),$("#inputupload").change((function(){let e=$("#inputupload")[0].files;e.length>0&&m.load(e[0])}))),$("#SmartSearchManagerAddCurrentFilter").click((function(){m._addCurrentFilter()})),$("#SmartSearchManagerExecute").click((function(){m._executeAllFilters()}))),$("#"+this._uidiv).append('<div id="'+m._uidiv+'Tabulator" class = "SmartSearchManagerTabulator"></div>'),m.refreshUI()}static setUpdatedCallback(e){m._updatedCallback=e}static async load(e){let t=new FileReader;t.onload=async function(e){let t=JSON.parse(e.target.result);m._manager.fromJSON(t),m.refreshUI()},t.readAsText(e)}static async _executeAllFilters(){m._manager.executeSearchActions()}static async _addCurrentFilter(){p.updateFilterFromUI();let e=p.getFilter().toJSON(),t=new hcSmartSearch.SmartSearch(m._manager);t.fromJSON(e),t.clearActions(),t._id=m._manager.generateGUID(),t.setName(""),m._manager.addSmartSearch(t,!1);let a={};a.id=t._id,a.description=t.getName(),await m._table.addRow(a),m._updatedCallback&&m._updatedCallback()}static formatTooltip(e,t){let a=t.getData().id;return m._manager.getSmartSearchByID(a).generateString()}static editCheck(e){return m._editable}static async refreshUI(){if(m._table)await m._table.clearData();else{let e=[{label:"<i class='fas fa-user'></i> Select",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.selectAll()}},{label:"<i class='fas fa-user'></i> Isolate",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().isolateAll()}},{label:"<i class='fas fa-user'></i> Show",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().makeVisible(!0)}},{label:"<i class='fas fa-user'></i> Hide",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().makeVisible(!1)}},{separator:!0},{label:"<i class='fas fa-user'></i> Red",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(255,0,0))}},{label:"<i class='fas fa-user'></i> Green",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(0,255,0))}},{label:"<i class='fas fa-user'></i> Blue",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(0,0,255))}},{label:"<i class='fas fa-user'></i> Yellow",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(255,255,0))}},{label:"<i class='fas fa-user'></i> Grey",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(128,128,128))}},{label:"<i class='fas fa-user'></i> Transparent",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().setOpacity(.25)}},{label:"<i class='fas fa-user'></i> Opaque",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().setOpacity(1)}},{separator:!0},{label:"<i class='fas fa-user'></i> View",action:async function(e,t){let a=t.getData(),r=m._manager.getSmartSearchByID(a.id).toJSON();p.getFilter().fromJSON(r),p.clearSearchResults(),await p.refreshUI()}},{label:"<i class='fas fa-user'></i> Edit Name",action:async function(e,t){m._editable=!0}},{label:"<i class='fas fa-user'></i> Update",action:async function(e,t){m._handleSmartSearchUpdate(t)}},{label:"<i class='fas fa-user'></i> Delete",action:async function(e,t){m._manager.removeSmartSearch(t.getData().id),t.delete(),m._updatedCallback&&m._updatedCallback()}}],t=function(e,t,a){if(null==e.getValue())return e.getValue();switch(e.getValue()){case"red":return'<div style="background:red;color:red;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"green":return'<div style="background:green;color:green;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"blue":return'<div style="background:blue;color:blue;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"yellow":return'<div style="background:yellow;color:yellow;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"grey":return'<div style="background:grey;color:grey;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';default:return e.getValue()}},a=function(e,t,a,r){switch(t){case"red":return'<span style="background:red;color:red">XXXXXXXXX</span>';case"green":return'<span style="background:green;color:green">XXXXXXXXX</span>';case"blue":return'<span style="background:blue;color:blue">XXXXXXXXX</span>';case"yellow":return'<span style="background:yellow;color:yellow">XXXXXXXXX</span>';case"grey":return'<span style="background:grey;color:grey">XXXXXXXXX</span>';case"":return"None";default:return t}},r=["","Isolate","Show","Hide","Select","Auto Color","red","green","blue","yellow","grey","Transparent","Opaque","Not Selectable","Selectable","Fit Nodes","Fit World"];m._table=new Tabulator("#"+m._uidiv+"Tabulator",{data:[],selectable:0,movableRows:!0,layout:"fitColumns",rowContextMenu:e,columns:[{title:"Name",headerSort:!1,field:"description",formatter:"textarea",editor:"input",editable:m.editCheck,tooltip:m.formatTooltip},{title:"ID",field:"id",width:20,visible:!1},{title:"Action1",headerSort:!1,field:"action0",editor:"list",width:47,formatter:t,editorParams:{values:r,itemFormatter:a}},{title:"Action2",headerSort:!1,field:"action1",editor:"list",width:47,formatter:t,editorParams:{values:r,itemFormatter:a}},{title:"Action3",headerSort:!1,field:"action2",editor:"list",width:47,formatter:t,editorParams:{values:r,itemFormatter:a}},{title:"Prop",headerSort:!1,field:"prop",width:20,hozAlign:"center",formatter:"tickCross",sorter:"boolean",editor:!0,editorParams:{tristate:!1}}]}),m._table.on("rowClick",(async function(e,t){let a=t.getData(),r=m._manager.getSmartSearchByID(a.id),i=r.toJSON();p.getFilter().fromJSON(i),p.clearSearchResults(),await p.refreshUI(),r.hasAction()?await p.search(!0):await p.search()})),m._table.on("rowDblClick",(function(e,t){m._editable=!0})),m._table.on("rowMoved",(function(e){let t=m._table.getRows(),a=[];for(let e=0;e<t.length;e++){let r=t[e].getData();a.push(m._manager.getSmartSearchByID(r.id))}m._manager.setSearches(a)})),m._table.on("cellEdited",(function(e){"description"==e.getField()?(m._handleSmartSearchNameEdit(e.getRow()),m._editable=!1):"prop"==e.getField()?m._handleSmartSearchIsPropEdit(e.getRow()):"action0"==e.getField()?m._handleSmartSearchIsActionEdit(e.getRow(),0):"action1"==e.getField()?m._handleSmartSearchIsActionEdit(e.getRow(),1):"action2"==e.getField()&&m._handleSmartSearchIsActionEdit(e.getRow(),2),m._table.redraw()}))}for(let e=0;e<m._manager.getSmartSearchNum();e++){let t,a=m._manager.getSmartSearch(e);t=""==a.getName()?a.generateString():a.getName();let r={};t=t.replace(/&quot;/g,'"'),r.id=m._manager.getSmartSearchID(e),r.description=t,r.action0=a.getAction(0),r.action1=a.getAction(1),r.action2=a.getAction(2),r.prop=m._manager.getSmartSearch(e).getProp(),await m._table.addRow(r)}}static async _updateEditor(e){let t=m._manager.getSmartSearchByID(e).toJSON();p.getFilter().fromJSON(t),await p.refreshUI()}static async _handleSmartSearchNameEdit(e){let t=e.getData(),a=m._manager.getSmartSearchByID(t.id);a.setName(t.description),""==t.description&&e.update({description:a.getName()}),m._updatedCallback&&m._updatedCallback()}static async _handleSmartSearchIsPropEdit(e){let t=e.getData();m._manager.updateSmartSearchIsProp(t.id,t.prop),m._updatedCallback&&m._updatedCallback()}static async _handleSmartSearchIsActionEdit(e,t){let a=e.getData(),r=m._manager.getSmartSearchByID(a.id);0==t?r.setAction(a.action0,0):1==t?r.setAction(a.action1,1):r.setAction(a.action2,2),m._updatedCallback&&m._updatedCallback()}static _handleSmartSearchUpdate(e){let t=e.getData(),a=m._manager.getSmartSearchByID(t.id);p.updateFilterFromUI();let r=p.getFilter().toJSON(),i=new hcSmartSearch.SmartSearch(m._manager);i.fromJSON(r),a.updateConditions(i._conditions),a.setAutoColors(i.getAutoColors(),i.getAutoColorProperty()),a.setName(""),e.update({description:a.getName()}),m._updatedCallback&&m._updatedCallback()}static exportToFile(e){let t=JSON.stringify(m._manager.toJSON()),a=document.createElement("a");a.setAttribute("download",e),a.href=function(e){let t=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(t)}(t),document.body.appendChild(a),window.requestAnimationFrame((function(){let e=new MouseEvent("click");a.dispatchEvent(e),document.body.removeChild(a)}))}}class u{static initialize(e,t){u._table=null,u._manager=t,u._viewer=t._viewer,u._uidiv=e,u._viewer.setCallbacks({selectionArray:function(e,t){u._itemSelected()}}),$("#"+this._uidiv).append('<div id="'+u._uidiv+'Tabulator" class="SmartSearchPropertiesTabulator"></div>'),u._refreshUI()}static async _refreshUI(){u._table?await u._table.clearData():u._table=new Tabulator("#"+u._uidiv+"Tabulator",{data:[],dataTree:!0,dataTreeStartExpanded:!0,selectable:1,layout:"fitColumns",columns:[{title:"Name",field:"name"},{title:"Value",field:"value"},{title:"ID",field:"id",width:20,visible:!1}]})}static async _itemSelected(){let e=u._viewer.selectionManager.getResults();if(await u._table.clearData(),e.length>0){let t=e[0].getNodeId(),a=await u._manager.evaluateProperties(t),r=0;for(let e=0;e<a.length;e++){let t=a[e].properties;if(0==t.length){let t={};t.id=r++,t.name=a[e].name,t.value="true",await u._table.addRow(t)}else if(1==t.length){let i={};i.id=r++,i.name=a[e].name,i.value=t[0].name+":"+t[0].value,await u._table.addRow(i)}else{let i={};i.id=r++,i.name=a[e].name;let o=[];for(let e=0;e<t.length;e++){let a={};a.id=r++,a.name=t[e].name,a.value=t[e].value,o.push(a)}i._children=o,await u._table.addRow(i)}}}}}function g(){return"1.1.0"}hcSmartSearch=t})();