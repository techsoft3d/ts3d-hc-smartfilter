var hcSmartSearch;(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{SmartSearch:()=>n,SmartSearchCondition:()=>o,SmartSearchEditorUI:()=>p,SmartSearchManager:()=>l,SmartSearchManagerUI:()=>m,SmartSearchOperatorType:()=>r,SmartSearchPropertiesUI:()=>u,SmartSearchPropertyType:()=>a,SmartSearchRelationshipType:()=>i,SmartSearchReport:()=>c,SmartSearchReportsUI:()=>d,SmartSearchResult:()=>s,SmartSearchResultsUI:()=>h,getVersion:()=>g});const r={contains:0,exists:1,notExists:2,greaterOrEqual:3,lessOrEqual:4,equals:5,unequal:6,greaterOrEqualDate:7,lessOrEqualDate:8,evaluate:9,regex:10,notregex:11},a={nodeName:0,nodeId:1,nodeChain:2,nodeType:3,nodeColor:4,relationship:5,property:6,SmartSearch:7,numChildren:8,ifcglobalid:9,bounding:10},i={none:0,nodeParent:1,nodeChildren:2,containedIn:3,spaceBoundary:4,aggregate:5};class o{static convertEnumConditionToString(e){switch(e){case r.contains:return"contains";case r.exists:return"exists";case r.notExists:return"!exists";case r.greaterOrEqual:return">=";case r.lessOrEqual:return"<=";case r.greaterOrEqualDate:return">=(Date)";case r.lessOrEqualDate:return"<=(Date)";case r.equals:return"=";case r.evaluate:return"evaluate";case r.unequal:return"≠";case r.regex:return"regex";case r.notregex:return"!regex"}}static convertStringConditionToEnum(e){switch(e){case"contains":return r.contains;case"exists":return r.exists;case"!exists":return r.notExists;case">=":return r.greaterOrEqual;case"<=":return r.lessOrEqual;case"=":return r.equals;case"≠":return r.unequal;case">=(Date)":return r.greaterOrEqualDate;case"<=(Date)":return r.lessOrEqualDate;case"evaluate":return r.evaluate;case"regex":return r.regex;case"!regex":return r.notregex}}static convertStringPropertyTypeToEnum(e){if(e.indexOf("SmartSearch")>-1)return a.SmartSearch;switch(e){case"Node Name":return a.nodeName;case"Nodeid":return a.nodeId;case"Node Chain":return a.nodeChain;case"Node Type":return a.nodeType;case"Node Color":return a.nodeColor;case"Rel:IFC ContainedIn":case"Rel:IFC SpaceBoundary":case"Rel:IFC Aggregate":case"Rel:Node Parent":case"Rel:Node Children":case"Rel:Node Children":return a.relationship;case"SmartSearch":return a.SmartSearch;case"# Children":return a.numChildren;case"IFC GlobalId":return a.ifcglobalid;case"Bounding":return a.bounding;default:return a.property}}static convertStringToRelationshipType(e){switch(e){case"Rel:IFC ContainedIn":return i.containedIn;case"Rel:IFC SpaceBoundary":return i.spaceBoundary;case"Rel:IFC Aggregate":return i.aggregate;case"Rel:Node Parent":return i.nodeParent;case"Rel:Node Children":return i.nodeChildren;default:return!1}}static convertEnumRelationshipTypeToString(e){switch(e){case i.containedIn:return"IFC ContainedIn";case i.spaceBoundary:return"IFC SpaceBoundary";case i.aggregate:return"IFC Aggregate";case i.nodeParent:return"Node Parent";case i.nodeChildren:return"Node Children"}}constructor(){this.and=!0,this.conditionType=r.contains,this.propertyType=a.nodeName,this.propertyName="",this.text="",this.childFilter=null,this.SmartSearchID=null,this.relationship=!1}toJSON(e){if(this.propertyType==a.SmartSearch&&!this.SmartSearchFitlerID){let t=e.getSmartSearchByName(this.text);t&&(this.SmartSearchID=t._id)}return{and:this.and,conditionType:this.conditionType,propertyType:this.propertyType,propertyName:JSON.parse(JSON.stringify(this.propertyName)),text:this.text,childFilter:this.childFilter,SmartSearchID:this.SmartSearchID,relationship:this.relationship}}fromJSON(e){this.and=e.and,this.conditionType=e.conditionType,this.propertyType=e.propertyType,this.propertyName=e.propertyName,this.text=e.text,this.childFilter=e.childFilter,this.SmartSearchID=e.SmartSearchID,this.relationship=null!=e.relationship&&e.relationship}setSmartSearchID(e){this.SmartSearchFitlerID=e}getSmartSearchID(){return this.SmartSearchID}setAndOr(e){this.and=e}getAndOr(){return this.and}setOperator(e){this.conditionType=e}getConditionType(){return this.conditionType}setPropertyName(e){this.propertyName=e}getPropertyName(){return this.propertyName}setPropertyType(e){this.propertyType=e}getPropertyType(){return this.propertyType}setPropertyValue(e){this.text=e}setText(e){this.text=e}getText(){return this.text}setChildFilter(e){this.childFilter=e}getChildFilter(){return this.childFilter}}class s{static createChainText(e,t,r,a){let i=t,o=[];for(;;){let t=e.model.getNodeParent(i);if(null==t||t==r)break;o.push(e.model.getNodeName(t)),i=t}let s="";for(let e=o.length-1-a;e>=0;e--)s+=e>0?o[e]+"->":o[e];return s}constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._query=t}getTotalSearchCount(){return this._query.getSearchCounter()}getQuery(){return this._query}generateItems(e,t,r){this._items=[];for(let a=0;a<e.length;a++){let i=s.createChainText(this._viewer,e[a],t,r),o={name:this._viewer.model.getNodeName(e[a]),id:e[a],chaintext:i};this._items.push(o)}}getItems(){return this._items}makeVisible(e){let t=this._itemsToSelections();this._viewer.model.setNodesVisibility(t,e)}async setOpacity(e){let t=this._itemsToSelections();this._viewer.model.setNodesOpacity(t,e)}async setSelectable(e){let t=this._itemsToSelections();this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,t,!e)}async colorize(e){let t=this._itemsToSelections();await this._viewer.model.setNodesFaceColor(t,e)}isolateAll(){let e=this._itemsToSelections();this._viewer.view.isolateNodes(e)}selectAll(){let e=[];for(let t=0;t<this._items.length;t++)e.push(new Communicator.Selection.SelectionItem(parseInt(this._items[t].id)));this._viewer.selectionManager.add(e)}_itemsToSelections(){let e=[];for(let t=0;t<this._items.length;t++)e.push(parseInt(this._items[t].id));return e}}class n{constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._limitselectionlist=[],this._conditions=[],this._name="",this._action=["","",""],this._keepSearchingChildren=!1,this._prop=!1,this._autoColors=null,this._id=e.generateGUID(),this._searchCounter=0,this._autoColorsProperty=null,this._startnode=t||this._viewer.model.getRootNode()}getAction(e=0){return this._action[e]}setAction(e,t=0){this._action[t]=e}hasAction(){return""!=this._action[0]||""!=this._action[1]||""!=this._action[2]}clearActions(){this._action=["","",""]}setAutoColors(e=null,t=null){this._autoColors=e,this._autoColorsProperty=t}getAutoColors(){return this._autoColors}getAutoColorProperty(){return this._autoColorsProperty}async performAction(e,t=!0){if(""==this._action[0]&&""==this._action[1]&&""==this._action[2])return;let r;r=e||await this.execute();for(let e=0;e<3;e++){let a=[];if(t||"Isolate"==this._action[e]||"Show"==this._action[e])a=r;else for(let e=0;e<r.length;e++)this._viewer.model.getBranchVisibility(r[e])&&a.push(r[e]);switch(this._action[e]){case"red":await this._viewer.model.setNodesFaceColor(a,new Communicator.Color(255,0,0));break;case"green":await this._viewer.model.setNodesFaceColor(a,new Communicator.Color(0,255,0));break;case"blue":await this._viewer.model.setNodesFaceColor(a,new Communicator.Color(0,0,255));break;case"yellow":await this._viewer.model.setNodesFaceColor(a,new Communicator.Color(255,255,0));break;case"grey":await this._viewer.model.setNodesFaceColor(a,new Communicator.Color(128,128,128));break;case"Transparent":await this._viewer.model.setNodesOpacity(a,.3);break;case"Opaque":await this._viewer.model.setNodesOpacity(a,1);break;case"Isolate":await this._viewer.view.isolateNodes(a,0,!1);break;case"Show":await this._viewer.model.setNodesVisibility(a,!0);break;case"Hide":await this._viewer.model.setNodesVisibility(a,!1);break;case"Auto Color":await this.autoColorAction(a);break;case"Not Selectable":await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,a,!0);break;case"Selectable":await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,a,!1);break;case"Fit Nodes":await this._viewer.view.fitNodes(a,0);break;case"Fit World":await this._viewer.view.fitWorld(0);break;case"Select":let e=[];for(let t=0;t<a.length;t++)e.push(new Communicator.Selection.SelectionItem(a[t]));await this._viewer.selectionManager.add(e)}}}setKeepSearchingChildren(e){this._keepSearchingChildren=e}getKeepSearchingChildren(){return this._keepSearchingChildren}updateConditions(e){this._conditions=e}setProp(e){this._prop=e}getProp(){return this._prop}setName(e){this._name=e,""==this._name&&(this._name=this.generateString())}getName(){return this._name}getNumConditions(){return this._conditions.length}getCondition(e){return this._conditions[e]}addCondition(e){this._conditions.push(e)}removeCondition(e){if(1==this._conditions.length&&this._conditions[0].childFilter){let e=this._conditions[0].childFilter;this._conditions.splice(0,1);for(let t=0;t<e._conditions.length;t++)this._conditions.unshift(e._conditions[t])}else this._conditions.splice(e,1)}fromJSON(e){this._conditions=[];for(let t=0;t<e.conditions.length;t++){let r=new o;r.fromJSON(e.conditions[t]),this._conditions.push(r)}for(let e=0;e<this._conditions.length;e++)if(this._conditions[e].childFilter){let t=new n(this._manager,this._conditions[e].childFilter.startnode);t.fromJSON(this._conditions[e].childFilter),this._conditions[e].childFilter=t}if(this._name=e.name,null==e.prop?this._prop=!1:this._prop=e.prop,null==e.action?this._action=["","",""]:this._action=JSON.parse(JSON.stringify(e.action)),null==e.keepSearchingChildren?this._keepSearchingChildren=!1:this._keepSearchingChildren=e.keepSearchingChildren,e.id&&(this._id=e.id),e.autoColors){this._autoColorsProperty=e.autoColorsProperty,this._autoColors=[];for(let t=0;t<e.autoColors.length;t++)this._autoColors[e.autoColors[t].name]=new Communicator.Color(e.autoColors[t].r,e.autoColors[t].g,e.autoColors[t].b)}}toJSON(){let e=[];for(let t=0;t<this._conditions.length;t++){let r=this._conditions[t].toJSON(this._manager);this._conditions[t].childFilter&&(r.childFilter=this._conditions[t].childFilter.toJSON()),e.push(r)}let t=null;if(this._autoColors){t=[];for(let e in this._autoColors){let r=this._autoColors[e];r&&t.push({name:e,r:r.r,g:r.g,b:r.b})}}return{autoColorsProperty:this._autoColorsProperty,autoColors:t,action:this._action,conditions:e,name:this._name,id:this._id,keepSearchingChildren:this._keepSearchingChildren,prop:this._prop}}limitToNodes(e){this._limitselectionlist=[],this._searchCounter=0;for(let t=0;t<e.length;t++)this._limitselectionlist.push(e[t])}getLimitSelectionList(){return this._limitselectionlist}getStartNode(){return this._startnode}getSearchCounter(){return 0==this._limitselectionlist.length?this._searchCounter-1:this._searchCounter}async execute(){this._selectionBounds=null,this._searchCounter=0;let e=this._conditions,t=this._limitselectionlist;for(let t=0;t<e.length;t++)e[t].text=e[t].text.replace(/&quot;/g,'"'),"/*"==e[t].propertyName.slice(-2)?e[t].wildcardString=e[t].propertyName.slice(0,-2):e[t].wildcardString=null,e[t].wildcardArray=null;let r=[];if(0==t.length)this._startnode==this._viewer.model.getRootNode()?await this._gatherMatchingNodesRecursive(e,this._startnode,r,this._startnode,""):await this._gatherMatchingNodesRecursive(e,this._startnode,r,this._viewer.model.getNodeParent(this._startnode),"");else for(let a=0;a<t.length;a++)await this._gatherMatchingNodesRecursive(e,t[a],r,this._viewer.model.getNodeParent(t[a]),"");if(this._manager.getFilterBodies()){let e=[],t=[];for(let a=0;a<r.length;a++)if(this._viewer.model.getNodeType(r[a])!=Communicator.NodeType.BodyInstance)t[r[a]]||(e.push(r[a]),t[r[a]]=!0);else{let i=this._viewer.model.getNodeParent(r[a]);t[i]||(e.push(i),t[i]=!0)}return e}return r}async testOneNodeAgainstConditions(e){let t=this._conditions;for(let e=0;e<t.length;e++)t[e].text=t[e].text.replace(/&quot;/g,'"');return await this._testNodeAgainstConditions(e,this._conditions,"")}async findAllPropertiesOnNode(e,t,r,i){let o,s,n;t?(o=t,s=r,n=i):(o=this._conditions,s=[],n=[]);for(let t=0;t<o.length;t++)if(o[t].childFilter)await this.findAllPropertiesOnNode(e,o[t].childFilter._conditions,s,n);else if(o[t].propertyType==a.property){let r=this._manager._propertyHash[e];r[o[t].propertyName]&&!n[o[t].propertyName]&&(n[o[t].propertyName]=!0,s.push({name:o[t].propertyName,value:r[o[t].propertyName]}))}return s}generateString(){let e="";for(let t=0;t<this._conditions.length;t++)t>0&&(e+=" "+(this._conditions[t].and?"and":"or")+" "),this._conditions[t].childFilter?e+="("+this._conditions[t].childFilter.generateString()+") ":(this._conditions[t].relationship&&(e+="Rel:"+o.convertEnumRelationshipTypeToString(this._conditions[t].relationship)+"("),this._conditions[t].propertyType==a.SmartSearch&&(e+="("),e+=this._conditions[t].propertyName+" "+o.convertEnumConditionToString(this._conditions[t].conditionType)+" "+this._conditions[t].text,this._conditions[t].propertyType==a.SmartSearch&&(e+=")"),this._conditions[t].relationship&&(e+=")"));return e=e.replace(/&quot;/g,'"'),e}async _checkSpaceBoundaryCondition(e,t){let a,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._spaceBoundaryHash[e]?a=this._manager._spaceBoundaryHash[e]:(a=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.SpaceBoundary),this._manager._spaceBoundaryHash[e]=a),a.length>0){let r=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<a.length;e++)if(await this._testNodeAgainstConditions(parseInt(a[e])+r,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==r.notExists)return!0;return!1}async _checkNodeParentCondition(e,t){let r=this._viewer.model.getNodeParent(e),a=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;return t.relationship=!1,await this._testNodeAgainstConditions(r+a,i,"")?(t.relationship=o,!0):(t.relationship=o,!1)}async _checkNodeChildrenCondition(e,t){let r=this._viewer.model.getNodeChildren(e);if(r.length>0){let a=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<r.length;e++)if(await this._testNodeAgainstConditions(r[e]+a,i,""))return t.relationship=o,!0;t.relationship=o}return!1}async _checkAggregateCondition(e,t){let a,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._aggregateHash[e]?a=this._manager._aggregateHash[e]:(a=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.Aggregates),this._manager._aggregateHash[e]=a),a.length>0){let r=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<a.length;e++)if(await this._testNodeAgainstConditions(parseInt(a[e])+r,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==r.notExists)return!0;return!1}async _checkContainedInCondition(e,t){let a,i=this._viewer.model.getBimIdFromNode(e);if(this._manager._containedInSpatialStructureHash[e]?a=this._manager._containedInSpatialStructureHash[e]:(a=this._viewer.model.getBimIdRelatingElements(e,i,Communicator.RelationshipType.ContainedInSpatialStructure),this._manager._containedInSpatialStructureHash[e]=a),a.length>0){let r=this._viewer.model.getNodeIdOffset(e),i=[];i.push(t);let o=t.relationship;t.relationship=!1;for(let e=0;e<a.length;e++)if(await this._testNodeAgainstConditions(parseInt(a[e])+r,i,""))return t.relationship=o,!0;t.relationship=o}else if(t.conditionType==r.notExists)return!0;return!1}_evaluateComparison(e){const t=e.match(/^\s*(-?\d+(?:\.\d+)?)\s*([<>]=?)\s*(-?\d+(?:\.\d+)?)\s*$/);if(!t)return!1;const r=parseFloat(t[1]),a=t[2],i=parseFloat(t[3]);switch(a){case"<":return r<i;case">":return r>i;case"<=":return r<=i;case">=":return r>=i;default:return!1}}_extractCoordinates(e){const t=e.match(/x:([\d,\-]+(\.\d+)?)\s*y:([\d,\-]+(\.\d+)?)\s*z:([\d,\-]+(\.\d+)?)/);if(t){const e=parseFloat(t[1].replace(",","")),r=parseFloat(t[3].replace(",","")),a=parseFloat(t[5].replace(",",""));return new Communicator.Point3(e,r,a)}}async _checkCondition(e,t,i){if(t.conditionType!=r.contains&&t.conditionType!=r.regex&&t.conditionType!=r.notregex){if(t.conditionType==r.exists||t.conditionType==r.notExists){let i=!1,o=!1;return t.conditionType==r.notExists&&(o=!0),t.propertyType==a.property?this._manager._propertyHash[e]&&null!=this._manager._propertyHash[e][t.propertyName]&&(i=!0):t.propertyType==a.nodeName?""!=this._viewer.model.getNodeName(e)&&(i=!0):t.propertyType==a.nodeId||t.propertyType==a.nodeType?i=!0:t.propertyType==a.ifcglobalid?null!=this._viewer.model.getGenericIdFromBimId(e,e.toString())&&(i=!0):t.propertyType==a.nodeColor&&0==this._viewer.model.getNodeChildren(e).length&&(await this._viewer.model.getNodesEffectiveFaceColor([e]))[0]&&(i=!0),o?!i:i}let i;if(t.propertyType==a.nodeName)i=parseFloat(this._viewer.model.getNodeName(e));else if(t.propertyType==a.nodeId)i=e;else if(t.propertyType==a.numChildren)i=this._viewer.model.getNodeChildren(e).length;else{if(t.conditionType==r.evaluate){let r;if("COG"==t.propertyName){let a=this._manager._propertyHash[e][t.propertyName];if(!a)return!1;let i=this._extractCoordinates(a);r=new Communicator.Box(i,i)}else{try{r=await this._viewer.model.getNodesBounding([e])}catch(e){return!1}if(-1!=t.text.indexOf("bounds:")){let e=t.text.replace("bounds:","").split(" ");return r.min.x>=parseFloat(e[0])&&r.min.y>=parseFloat(e[1])&&r.min.z>=parseFloat(e[2])&&r.max.x<=parseFloat(e[3])&&r.max.y<=parseFloat(e[4])&&r.max.z<=parseFloat(e[5])}}let a=t.text.split(","),i=0;for(let e=0;e<a.length;e++)if(-1!=a[e].indexOf("x")){let t;t=-1!=a[e].indexOf(">")?a[e].replace("x",r.min.x.toString()):a[e].replace("x",r.max.x.toString()),this._evaluateComparison(t)&&i++}else if(-1!=a[e].indexOf("y")){let t;t=-1!=a[e].indexOf(">")?a[e].replace("y",r.min.y.toString()):a[e].replace("y",r.max.y.toString()),this._evaluateComparison(t)&&i++}else if(-1!=a[e].indexOf("z")){let t;t=-1!=a[e].indexOf(">")?a[e].replace("z",r.min.z.toString()):a[e].replace("z",r.max.z.toString()),this._evaluateComparison(t)&&i++}return!(!i||i!=a.length)}{let a;if(this._manager._propertyHash[e]&&(a=this._manager._propertyHash[e][t.propertyName]),null==a)return t.conditionType==r.unequal;i=parseFloat(a)}}if(t.conditionType==r.greaterOrEqualDate||t.conditionType==r.lessOrEqualDate){let a;if(this._manager._propertyHash[e]&&(a=this._manager._propertyHash[e][t.propertyName]),null==a)return!1;-1!=a.indexOf(" ")||isNaN(parseInt(a))||(a=parseInt(a));let i=new Date(a);if(isNaN(i.getDate()))return!1;let o=t.text;-1!=o.indexOf(" ")||isNaN(parseInt(o))||(o=parseInt(o));let s=new Date(o);if(t.conditionType==r.greaterOrEqualDate){if(i>=s)return!0}else if(t.conditionType==r.lessOrEqualDate&&i<=s)return!0;return!1}{let e=parseFloat(t.text);if(isNaN(e)||isNaN(i))return!1;if(t.conditionType==r.greaterOrEqual){if(i>=e)return!0}else if(t.conditionType==r.lessOrEqual){if(i<=e)return!0}else if(t.conditionType==r.unequal){if(i!=e)return!0}else if(i==e)return!0;return!1}}{let o;o=t.conditionType==r.contains?t.text.split(","):t.text;let n="";if(t.propertyType==a.nodeName)n=this._viewer.model.getNodeName(e);else if(t.propertyType==a.relationship)n=i;else if(t.propertyType==a.nodeChain)n=i||s.createChainText(this._viewer,e,this._viewer.model.getRootNode(),0);else if(t.propertyType==a.numChildren){let t=this._viewer.model.getNodeChildren(e);for(let e=0;e<t.length;e++)n+=this._viewer.model.getNodeName(t[e])}else if(t.propertyType==a.nodeType)n=Communicator.NodeType[this._viewer.model.getNodeType(e)];else if(t.propertyType==a.nodeColor)if(this._viewer.model.getNodeChildren(e).length>0)n="x";else{let t=await this._viewer.model.getNodesEffectiveFaceColor([e]);n=t.length>0?t[0].r+" "+t[0].g+" "+t[0].b:"x"}else n=t.propertyType==a.nodeId?e.toString():t.propertyType==a.ifcglobalid?this._viewer.model.getGenericIdFromBimId(e,e.toString()):null==this._manager._propertyHash[e]||null==this._manager._propertyHash[e][t.propertyName]?void 0:this._manager._propertyHash[e][t.propertyName];if(null==n&&(n=""),t.conditionType!=r.contains){let e,a;try{e=new RegExp(o,"gi")}catch(e){return!1}return a=!!n.match(e),t.conditionType==r.regex?a:!a}let l=0,c=0,d=0,h=0,p=0;for(let e=0;e<o.length;e++){let r,i;if('"'==o[e][0]||'"'==o[e][1])if(r=!0,'"'==o[e][0])i=o[e].substring(1,o[e].length-1);else{let t=o[e][0];i=o[e].substring(2,o[e].length-1),i=t+i}else i=o[e],r=!1;if(t.propertyType==a.nodeId&&(r=!0),""==i||1==i.length&&("+"==i[0]||"-"==i[0]))return;"+"==i[0]?(c++,r?n.toLowerCase()==i.substring(1).toLowerCase()&&l++:-1!=n.toLowerCase().indexOf(i.substring(1).toLowerCase())&&l++):"-"==i[0]?(d++,r?n.toLowerCase()!=i.substring(1).toLowerCase()&&h++:-1==n.toLowerCase().indexOf(i.substring(1).toLowerCase())&&h++):r?n.toLowerCase()==i.toLowerCase()&&p++:-1!=n.toLowerCase().indexOf(i.toLowerCase())&&p++}return c==l&&d==h&&(p>0||l+h==o.length)}}async _testNodeAgainstConditions(e,t,s){let n=0,l=!1;t.length>1&&!t[1].and&&(l=!0);for(let c=0;c<t.length;c++){let d;if(t[c].relationship)t[c].relationship==i.spaceBoundary?d=await this._checkSpaceBoundaryCondition(e,t[c]):t[c].relationship==i.containedIn?d=await this._checkContainedInCondition(e,t[c]):t[c].relationship==i.aggregate?d=await this._checkAggregateCondition(e,t[c]):t[c].relationship==i.nodeParent?d=await this._checkNodeParentCondition(e,t[c]):t[c].relationship==i.nodeChildren&&(d=await this._checkNodeChildrenCondition(e,t[c]));else if(t[c].propertyType==a.SmartSearch){if(!t[c].SmartSearch)if(t[c].SmartSearchID)t[c].SmartSearch=this._manager.getSmartSearchByID(t[c].SmartSearchID);else{let e=this._manager.getSmartSearchByName(t[c].text);t[c].SmartSearchID=e._id,t[c].SmartSearch=e}d=await this._testNodeAgainstConditions(e,t[c].SmartSearch._conditions,s),t[c].conditionType==r.unequal&&(d=!d)}else if(t[c].wildcardString){if(!t[c].wildcardArray){t[c].wildcardArray=[];for(let e in this._manager._allPropertiesHash)-1!=e.indexOf(t[c].wildcardString)&&-1==e.indexOf("/*")&&t[c].wildcardArray.push(e)}let a=new o;a.propertyType=t[c].propertyType,a.text=t[c].text,a.conditionType=t[c].conditionType;let i=0;for(let o=0;o<t[c].wildcardArray.length;o++)if(a.propertyName=t[c].wildcardArray[o],d=await this._checkCondition(e,a,s),1==d){if(a.conditionType==r.contains||a.conditionType==r.exists)break;i++}a.conditionType==r.notExists&&(d=i==t[c].wildcardArray.length)}else d=t[c].childFilter?await this._testNodeAgainstConditions(e,t[c].childFilter._conditions,s):await this._checkCondition(e,t[c],s);if(0==d){if(!l)break}else n++}return!!(!l&&n==t.length||l&&n>0)}async _gatherMatchingNodesRecursive(e,t,r,a,i){if(this._searchCounter++,this._searchCounter%1500==0&&await new Promise((e=>setTimeout(e,1))),this._manager.getSearchVisible()&&!this._viewer.model.getBranchVisibility(t))return;let o=this._viewer.model.getNodeName(t)+">";if(t!=a&&await this._testNodeAgainstConditions(t,e,i)&&(r.push(t),null!=this._manager.getKeepSearchingChildren()?!this._manager.getKeepSearchingChildren():!this._keepSearchingChildren))return;let s=this._viewer.model.getNodeChildren(t);for(let t=0;t<s.length;t++)await this._gatherMatchingNodesRecursive(e,s[t],r,a,i+o)}async autoColorAction(e){if(this._autoColors){let t=[],r=this._autoColorsProperty;if(r)if("Node Name"==r)for(let r=0;r<e.length;r++){let a=this._viewer.model.getNodeName(e[r]);null==t[a]&&(t[a]={ids:[]}),t[a].ids.push(e[r])}else{let a=r;for(let r=0;r<e.length;r++){let i=e[r];null!=this._manager._propertyHash[i][a]&&(null==t[this._manager._propertyHash[i][a]]&&(t[this._manager._propertyHash[i][a]]={ids:[]}),t[this._manager._propertyHash[i][a]].ids.push(e[r]))}}for(let e in t)this._autoColors[e]&&await this._viewer.model.setNodesFaceColor(t[e].ids,this._autoColors[e])}}}class l{constructor(e){this._viewer=e,this._SmartSearchs=[],this._modelHash=[],this._keepSearchingChildren=!0,this._searchVisible=!1,this._ignoreBodies=!1,this._filterBodies=!1}getVersion(){return"2.0.0"}setIgnoreBodies(e){this._ignoreBodies=e}getIgnoreBodies(){return this._ignoreBodies}setFilterBodies(e){this._filterBodies=e}getFilterBodies(){return this._filterBodies}setSearchVisible(e){this._searchVisible=e}getSearchVisible(){return this._searchVisible}addSmartSearch(e){this._SmartSearchs.push(e)}async executeSearchActions(){this._viewer.pauseRendering(),await this._viewer.model.reset(),await this._viewer.model.unsetNodesFaceColor([this._viewer.model.getAbsoluteRootNode()]),await this._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[this._viewer.model.getAbsoluteRootNode()],!1),await this._viewer.selectionManager.clear();for(let e=0;e<this._SmartSearchs.length;e++)await this._SmartSearchs[e].performAction(null,!1);this._viewer.resumeRendering()}setSearches(e){this._SmartSearchs=e}setKeepSearchingChildren(e){this._keepSearchingChildren=e}getKeepSearchingChildren(){return this._keepSearchingChildren}getSmartSearchs(){return this._SmartSearchs}getSmartSearchByName(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t].getName()==e)return this._SmartSearchs[t]}getSmartSearchByID(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t]._id==e)return this._SmartSearchs[t]}getSmartSearchNum(){return this._SmartSearchs.length}getSmartSearch(e){return this._SmartSearchs[e]}getSmartSearchID(e){return this._SmartSearchs[e]._id}removeSmartSearch(e){for(let t=0;t<this._SmartSearchs.length;t++)if(this._SmartSearchs[t]._id==e)return this._SmartSearchs.splice(t,1)}updateSmartSearch(e,t){this._SmartSearchs[e]=t}updateSmartSearchIsProp(e,t){for(let r=0;r<this._SmartSearchs.length;r++)this._SmartSearchs[r]._id==e&&this._SmartSearchs[r].setProp(t)}toJSON(){let e=[];for(let t=0;t<this._SmartSearchs.length;t++)e.push(this._SmartSearchs[t].toJSON());return e}fromJSON(e){this._SmartSearchs=[];for(let t=0;t<e.length;t++){let r=new n(this);r.fromJSON(e[t]),this.addSmartSearch(r)}return e}async evaluateProperties(e){let t=[];for(let r=0;r<this._SmartSearchs.length;r++)if(this._SmartSearchs[r].getProp()){let a=this._SmartSearchs[r],i=!1;if(null!=this._keepSearchingChildren?!this._keepSearchingChildren:!a._keepSearchingChildren){let t=e;for(;t=this._viewer.model.getNodeParent(t),t!=this._viewer.model.getRootNode();)if(await a.testOneNodeAgainstConditions(t)){i=!0;break}}if(i)continue;if(await a.testOneNodeAgainstConditions(e)){let r=await a.findAllPropertiesOnNode(e),i=a.getName();""==i&&(i=a.generateString()),t.push({name:i,properties:r})}}return t}async _getModelTreeIdsRecursive(e,t,r){if(r.length%1e3==0&&await new Promise((e=>setTimeout(e,1))),this._ignoreBodies&&this._viewer.model.getNodeType(e)==Communicator.NodeType.BodyInstance)return;t.push(this._viewer.model.getNodeProperties(e)),r.push(e);let a=this._viewer.model.getNodeChildren(e);for(let e=0;e<a.length;e++)await this._getModelTreeIdsRecursive(a[e],t,r)}addModel(e,t,r){for(let r=0;r<this._modelHash.length;r++)if(this._modelHash[r].id==e)return void(this._modelHash[r].nodeid=t);this._modelHash.push({id:e,nodeid:t,savedHash:r,ids:null,properties:null})}_updateHashes(e,t,r){for(let a=0;a<t.length;a++){this._propertyHash[e[a]]=t[a];let i=this._viewer.model.getNodeLayerId(e[a]);if(null!=i&&r.size>1)if(null==this._propertyHash[e[a]]&&(this._propertyHash[e[a]]=[]),3==this._viewer.model.getNodeType(e[a])){let t=this._viewer.model.getNodeParent(e[a]);null==this._propertyHash[t]&&(this._propertyHash[t]=[]),this._propertyHash[t].LAYER=r.get(i)}else this._propertyHash[e[a]].LAYER=r.get(i);for(let e in t[a])this._allPropertiesHash[e]=[],null==this._allPropertiesHashNum[e]?this._allPropertiesHashNum[e]=1:this._allPropertiesHashNum[e]++}for(let e in this._propertyHash)for(let t in this._propertyHash[e]){if(this._propertyHash[e][t]=this._propertyHash[e][t].replace(/,/g,""),"OWNERHISTORY/CreationDate"==t||"OWNERHISTORY/LastModifiedDate"==t){let r=new Date(0);r.setUTCSeconds(parseInt(this._propertyHash[e][t])),this._propertyHash[e][t]=r.toDateString()}this._allPropertiesHash[t][this._propertyHash[e][t]]=!0}}parseSavedPropertyHash(e){let t=e.allprops,r=e.nodeprops,a=e.related,i=[],o=[];for(let e=0;e<r.length;e++){let a=r[e];o.push(a.i);let s={},n=a.p;for(let e=0;e<n.length;e+=2)s[t[n[e]].name]=t[n[e]].values[n[e+1]];i.push(s)}let s=[],n=[],l=[];if(a)for(let e=0;e<a.length;e++){let t=a[e];t.e?s[parseInt(t.i)]=t.e:s[parseInt(t.i)]=[],t.f?n[parseInt(t.i)]=t.f:n[parseInt(t.i)]=[],t.g?l[parseInt(t.i)]=t.g:l[parseInt(t.i)]=[]}return{ids:o,props:i,relatedSpaceBoundary:s,relatedContainedIn:n,relatedAggregateIn:l}}gatherRelatedDataHashesRecursive(e,t){let r=this._viewer.model.getBimIdFromNode(e),a={i:e},i=this._viewer.model.getBimIdRelatingElements(e,r,Communicator.RelationshipType.SpaceBoundary),o=this._viewer.model.getBimIdRelatingElements(e,r,Communicator.RelationshipType.ContainedInSpatialStructure),s=this._viewer.model.getBimIdRelatingElements(e,r,Communicator.RelationshipType.Aggregates);i&&i.length>0&&(a.e=i),o&&o.length>0&&(a.f=o),s&&s.length>0&&(a.g=s),t.push(a);let n=this._viewer.model.getNodeChildren(e);for(let e=0;e<n.length;e++)this.gatherRelatedDataHashesRecursive(n[e],t)}exportPropertyHash(){let e=[],t=[],r=[];for(let t in this._allPropertiesHash){let a={name:t,values:Object.keys(this._allPropertiesHash[t])},i=[];for(let e=0;e<a.values.length;e++)i[a.values[e]]=e;a.ehash=i,e.push(a),r[t]=e.length-1}for(let a in this._propertyHash){let i=[];for(let t in this._propertyHash[a]){let o=e[r[t]];i.push(r[t],o.ehash[this._propertyHash[a][t]])}t.push({i:a,p:i})}for(let t=0;t<e.length;t++)e[t].ehash=void 0;return this.gatherRelatedDataHashesRecursive(this._viewer,this._viewer.model.getRootNode(),[]),{allprops:e,nodeprops:t}}_consolidateBodies(){let e=[];for(let t in this._propertyHash)3==this._viewer.model.getNodeType(parseInt(t))&&this._propertyHash[t]&&this._propertyHash[t].Volume&&(e[this._viewer.model.getNodeParent(parseInt(t))]=!0);for(let t in e){let e=this._viewer.model.getNodeChildren(parseInt(t)),r=0,a=0;for(let t=0;t<e.length;t++){let i=e[t];this._propertyHash[i]&&this._propertyHash[i].Volume&&(r+=parseFloat(this._propertyHash[i].Volume)),this._propertyHash[i]&&this._propertyHash[i]["Surface Area"]&&(a+=parseFloat(this._propertyHash[i]["Surface Area"]))}if(r+="mm³",a+="mm²",this._propertyHash[t].Volume=r,this._propertyHash[t]["Surface Area"]=a,this._viewer.model.getNodeName(parseInt(t)).startsWith("Product")){let e=this._viewer.model.getNodeParent(parseInt(t));this._propertyHash[e].Volume=r,this._propertyHash[e]["Surface Area"]=a}}}async initialize(){this._propertyHash=[],this._allPropertiesHash=[],this._allPropertiesHashNum=[],this._containedInSpatialStructureHash=[],this._aggregateHash=[],this._spaceBoundaryHash=[],this._totalNodes=0;let e=this._viewer.model.getLayers();if(0==this._modelHash.length){let t=[],r=[];await this._getModelTreeIdsRecursive(this._viewer.model.getRootNode(),t,r);let a=await Promise.all(t);this._updateHashes(r,a,e),this._consolidateBodies(),this._totalNodes=r.length}else for(let t=0;t<this._modelHash.length;t++){let r=this._modelHash[t],a=[],i=null,o=this._viewer.model.getNodeIdOffset(r.nodeid);if(r.ids){for(let e=0;e<r.ids.length;e++)a.push(r.ids[e]+o);i=r.properties}else{let e=[];if(r.savedHash){let e=this.parseSavedPropertyHash(r.savedHash);i=e.props,a=e.ids,this._containedInSpatialStructureHash=e.relatedContainedIn,this._aggregateHash=e.relatedAggregateIn,this._spaceBoundaryHash=e.relatedSpaceBoundary}else this._getModelTreeIdsRecursive(r.nodeid,e,a),i=await Promise.all(e);r.properties=i,r.ids=[];for(let e=0;e<a.length;e++)r.ids.push(a[e]-o)}this._totalNodes+=a.length,this._updateHashes(a,i,e)}}getTotalNodes(){return this._totalNodes-1}getAllOptionsForProperty(e){return this._allPropertiesHash[e]}getNumOptions(e){if(null!=this._allPropertiesHash[e])return Object.keys(this._allPropertiesHash[e]).length}getNumOptionsUsed(e){if(null!=this._allPropertiesHash[e])return this._allPropertiesHashNum[e]}getAllProperties(e=!1){let t=[],r=!1;!e&&this._allPropertiesHash.TYPE&&(r=!0);let a=!1;this._allPropertiesHash.LAYER&&(a=!0);let i=!1;this._allPropertiesHash["Surface Area"]&&(i=!0);let o=!1;this._allPropertiesHash.Volume&&(o=!0);for(let r in this._allPropertiesHash)"TYPE"==r&&!e||"LAYER"==r||"Surface Area"==r||"Volume"==r||t.push(r);t.sort(),t.unshift("---"),e||(t.unshift("IFC GlobalId"),t.unshift("Rel:IFC SpaceBoundary"),t.unshift("Rel:IFC Aggregate"),t.unshift("Rel:IFC ContainedIn"),r&&t.unshift("TYPE"),t.unshift("---")),t.unshift("Rel:Node Children"),t.unshift("Rel:Node Parent"),t.unshift("SmartSearch"),t.unshift("Bounding"),t.unshift("# Children"),a&&t.unshift("LAYER"),i&&t.unshift("Surface Area"),o&&t.unshift("Volume"),t.unshift("Node Color"),t.unshift("Node Type"),t.unshift("Node Chain"),t.unshift("Nodeid"),t.unshift("Node Name");for(let e=0;e<t.length;e++)if(-1!=t[e].indexOf("Materials and Finishes/")){t.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<t.length;e++)if(-1!=t[e].indexOf("Other/")){t.splice(e,0,"Other/*");break}return t}generateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}}class c{constructor(e,t){this._manager=e,this._viewer=this._manager._viewer,this._result=t,this._orgProperties=[],this._tableParams=[],this._tableParamsExpanded=[],this.expandedColorsHash=[];for(let e=0;e<this._result.getQuery().getNumConditions();e++){let t=this._result.getQuery().getCondition(e);-1==t.propertyName.indexOf("Node Chain")&&(t.conditionType==r.exists?this._orgProperties.push(t.propertyName):this._tableParams.push({prop:t.propertyName}))}0==this._orgProperties.length&&this._orgProperties.push("Node Name")}getExpandedColorsHash(){return this.expandedColorsHash}clearExpandedColorsHash(){this.expandedColorsHash=[]}getTableParams(){return this._tableParams}getOrgString(){let e="";if(1==this._orgProperties.length)return this._orgProperties[0];for(let t=0;t<this._orgProperties.length;t++)e+="["+this._orgProperties[t]+"]";return e}initializeExpanded(e){if(this._expandedCategory=e,null==e){let e=this._result.getItems(),t=[];for(let r=0;r<e.length;r++)t.push(e[r].id);this.expandedIds=t}else this.expandedIds=this.getCategoryHash()[e].ids;this._tableParamsExpanded=JSON.parse(JSON.stringify(this._tableParams)),0==this._tableParamsExpanded.length&&this._tableParamsExpanded.push({prop:"Node Name"})}getExpandedIds(){return this.expandedIds}getTableParamsExpanded(){return this._tableParamsExpanded}getExpandedCategory(){return this._expandedCategory}async _findPropValue(e,t){if("Node Name"==e)return t.name;if("Nodeid"==e)return t.id;if(-1==e.indexOf("Bounding-Z")){if("Node Name (No :Ext)"==e){let e,r=t.name.lastIndexOf(":");return e=r>-1?t.name.substring(0,r):t.name,e}if("Node Name (No -Ext)"==e){let e,r=t.name.lastIndexOf("-");return e=r>-1?t.name.substring(0,r):t.name,e}if("Node Parent"==e)return this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t.id));if("Node Type"==e)return Communicator.NodeType[this._viewer.model.getNodeType(t.id)];{let r=t.id;return this._manager._propertyHash[r][e]}}try{return(await this._viewer.model.getNodesBounding([t.id])).center().z}catch(e){return"EMPTY"}}async _findPropValue2(e,t){if(-1!=e.indexOf("Node Name"))return this._viewer.model.getNodeName(t);if(-1==e.indexOf("Bounding-Z"))return"Nodeid"==e?t:"Node Parent"==e?this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t)):"Node Type"==e?Communicator.NodeType[this._viewer.model.getNodeType(t)]:this._manager._propertyHash[t][e];try{return(await this._viewer.model.getNodesBounding([t])).center().z}catch(e){return"EMPTY"}}async generateTableHash(){let e=this._result.getItems();this._categoryHash=[];for(let t=0;t<e.length;t++){let r="";for(let a=0;a<this._orgProperties.length;a++){let i=this._orgProperties[a],o=await this._findPropValue(i,e[t]);1==this._orgProperties.length?r=null!=o?o:"":r+=null!=o?"["+o+"]":"[]"}null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(e[t].id)}}async _getTableParamData(e,t){let r,a,i=e.prop,o=!0,s=!0,n=!1,l=0;this.isNumberProp(i)||(s=!1);for(let e=0;e<t.length;e++){let a=await this._findPropValue2(i,t[e]);if(null!=a){let e=parseFloat(a);isNaN(e)?s=!1:(l+=e,n=!0)}e>0&&r!=a&&(o=!1),r=a}return a=n&&s?e.aggtype&&"sum"!=e.aggtype?o?parseFloat(r):"[Multiple]":l:o?null==r?"":r:"[Multiple]",{isSame:o,isNumber:n&&s,result:a}}async determineColumnTypes(){let e=[];for(let t=0;t<this._tableParams.length;t++){let r=!1;for(let e in this._categoryHash)if((await this._getTableParamData(this._tableParams[t],this._categoryHash[e].ids)).isNumber){r=!0;break}r&&this.isNumberProp(this._tableParams[t].prop)?e.push({isNumber:!0,unit:this.getAMTUnit(this._tableParams[t].prop)}):e.push({isNumber:!1,unit:""})}return e}async getExpandedTableData(){let e=[];for(let t=0;t<this.expandedIds.length;t++){let r={id:this.expandedIds[t]};for(let e=0;e<this._tableParamsExpanded.length;e++){let a=await this._getTableParamData(this._tableParamsExpanded[e],[this.expandedIds[t]]);r["tableParams"+e]=a.result}e.push(r)}return e}async getTableData(){let e=[];for(let t in this._categoryHash){let r={org:t,num:this._categoryHash[t].ids.length,color:"",id:t};for(let e=0;e<this._tableParams.length;e++){let a=await this._getTableParamData(this._tableParams[e],this._categoryHash[t].ids);r["tableParams"+e]=a.result}e.push(r)}return e}getTableProperty(){return this._tableProperty}setTableProperty(e){this._tableProperty=e}deleteOrgProperty(e){let t=this._orgProperties.indexOf(e);t>-1&&this._orgProperties.splice(t,1)}deleteTableParams(e){for(let t=0;t<this._tableParams.length;t++)if(this._tableParams[t].prop==e){this._tableParams.splice(t,1);break}}deleteTableParamsExpanded(e){for(let t=0;t<this._tableParamsExpanded.length;t++)if(this._tableParamsExpanded[t].prop==e){this._tableParamsExpanded.splice(t,1);break}}getCategoryHash(){return this._categoryHash}findCategoryFromSearch(){let e=this._result.getQuery(),t=this._result.getItems();if(this._categoryHash=[],this._tableProperty)if("/*"==this._tableProperty.slice(-2)&&(this._tableProperty="Node Name"),"Node Name"==this._tableProperty)for(let e=0;e<t.length;e++)null==this._categoryHash[t[e].name]&&(this._categoryHash[t[e].name]={ids:[]}),this._categoryHash[t[e].name].ids.push(t[e].id);else if("Node Name (No :Ext)"==this._tableProperty)for(let e=0;e<t.length;e++){let r,a=t[e].name.lastIndexOf(":");r=a>-1?t[e].name.substring(0,a):t[e].name,null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}else if("Node Name (No -Ext)"==this._tableProperty)for(let e=0;e<t.length;e++){let r,a=t[e].name.lastIndexOf("-");r=a>-1?t[e].name.substring(0,a):t[e].name,null==SmartSearchResultsUI._categoryHash[r]&&(SmartSearchResultsUI._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}else if("Node Parent"==this._tableProperty)for(let e=0;e<t.length;e++){let r=this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t[e].id));null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}else if("Node Type"==this._tableProperty)for(let e=0;e<t.length;e++){let r=Communicator.NodeType[this._viewer.model.getNodeType(t[e].id)];null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}else{let e=this._tableProperty;for(let r=0;r<t.length;r++){let a=t[r].id;null!=this._manager._propertyHash[a][e]&&(null==this._categoryHash[this._manager._propertyHash[a][e]]&&(this._categoryHash[this._manager._propertyHash[a][e]]={ids:[]}),this._categoryHash[this._manager._propertyHash[a][e]].ids.push(t[r].id))}}else{for(let r=0;r<e.getNumConditions();r++){let i=e.getCondition(r);if(i.propertyType==a.nodeName||i.wildcardString){for(let e=0;e<t.length;e++)null==this._categoryHash[t[e].name]&&(this._categoryHash[t[e].name]={ids:[]}),this._categoryHash[t[e].name].ids.push(t[e].id);return void(this._tableProperty="Node Name")}if(i.relationship==a.nodeParent){for(let e=0;e<t.length;e++){let r=this._viewer.model.getNodeName(this._viewer.model.getNodeParent(t[e].id));null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}return void(this._tableProperty="Node Parent")}if(i.propertyType==a.nodeType){for(let e=0;e<t.length;e++){let r=Communicator.NodeType[this._viewer.model.getNodeType(t[e].id)];null==this._categoryHash[r]&&(this._categoryHash[r]={ids:[]}),this._categoryHash[r].ids.push(t[e].id)}return void(this._tableProperty="Node Type")}if(i.propertyType==a.property){let e=i.propertyName;for(let e=0;e<t.length;e++){let r=t[e].id;null!=this._manager._propertyHash[r][i.propertyName]&&(null==this._categoryHash[this._manager._propertyHash[r][i.propertyName]]&&(this._categoryHash[this._manager._propertyHash[r][i.propertyName]]={ids:[]}),this._categoryHash[this._manager._propertyHash[r][i.propertyName]].ids.push(t[e].id))}return void(this._tableProperty=e)}}this._tableProperty="Node Name",this.findCategoryFromSearch()}}calculateAMT(e,t,r){if("sum"==r){let r=0;for(let a=0;a<t.length;a++){let i=this._manager._propertyHash[t[a]][e];null!=i&&(r+=parseFloat(i))}return r}{let a=[];for(let r=0;r<t.length;r++){let i=SmartSearchResultsUI._manager._propertyHash[t[r]][e];null!=i&&a.push(parseFloat(i))}if(0===a.length)return 0;if("avg"==r)return a.reduce(((e,t)=>e+t),0)/a.length;if("max"==r)return Math.max(...a);if("min"==r)return Math.min(...a);if("med"==r){a.sort(((e,t)=>e-t));const e=Math.floor(a.length/2);return a.length%2==0?(a[e-1]+a[e])/2:a[e]}}}getAMTUnit(e){let t=this._manager._allPropertiesHash[e];if(null!=t)for(let e in t){if(-1!=e.indexOf("mm²"))return"mm²";if(-1!=e.indexOf("m²"))return"m²";if(-1!=e.indexOf("mm³"))return"mm³";if(-1!=e.indexOf("m³"))return"m³";if(-1!=e.indexOf("mm"))return"mm";if(-1!=e.indexOf("m"))return"m";if(-1!=e.indexOf("inch³"))return"inch³";if(-1!=e.indexOf("inch²"))return"inch²";break}}isNumberProp(e){let t=e.toLowerCase();if(-1!=t.indexOf("version")||-1!=t.indexOf("globalid")||-1!=t.indexOf("nodeid")||-1!=t.indexOf("name")||-1!=t.indexOf("date")||-1!=t.indexOf("persistentid"))return!1;if(-1!=t.indexOf("bounding-z"))return!0;let r=this._manager._allPropertiesHash[e];if(null!=r)for(let e in r){if(!isNaN(parseFloat(e)))return!0;break}return!1}getAllPropertiesExpanded(){let e=this.expandedIds,t=[],r=[];for(let e in this._manager._allPropertiesHash)t.push(e);for(let t=0;t<e.length;t++){let a=e[t];for(let e in this._manager._propertyHash[a])r[e]=!0}let a=[];for(let e=0;e<t.length;e++)null!=r[t[e]]&&a.push(t[e]);a.sort(),a.unshift("Bounding-Z"),a.unshift("Nodeid"),a.unshift("Node Parent"),a.unshift("Node Type"),a.unshift("Node Name (No -Ext)"),a.unshift("Node Name (No :Ext)"),a.unshift("Node Name");for(let e=0;e<a.length;e++)if(-1!=a[e].indexOf("Materials and Finishes/")){a.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<a.length;e++)if(-1!=a[e].indexOf("Other/")){a.splice(e,0,"Other/*");break}return a}getAllProperties(){let e=this._result.getItems(),t=[],r=[];for(let e in this._manager._allPropertiesHash)t.push(e);for(let t=0;t<e.length;t++){let a=e[t].id;for(let e in this._manager._propertyHash[a])r[e]=!0}let a=[];for(let e=0;e<t.length;e++)null!=r[t[e]]&&a.push(t[e]);a.sort(),a.unshift("Bounding-Z"),a.unshift("Nodeid"),a.unshift("Node Parent"),a.unshift("Node Type"),a.unshift("Node Name (No -Ext)"),a.unshift("Node Name (No :Ext)"),a.unshift("Node Name");for(let e=0;e<a.length;e++)if(-1!=a[e].indexOf("Materials and Finishes/")){a.splice(e,0,"Materials and Finishes/*");break}for(let e=0;e<a.length;e++)if(-1!=a[e].indexOf("Other/")){a.splice(e,0,"Other/*");break}return a}getCategoryTableData(e,t){let r=[],a=this._result.getQuery().getAutoColors();if(a)for(let e in this._categoryHash)a[e]||(a[e]=this._categoryHash[e].color);for(let i in this._categoryHash){let o=a?a[i]:null,s=i;this.isNumberProp(this.getTableProperty())&&(s=parseFloat(i));let n={name:s,num:this._categoryHash[i].ids.length,color:o?"rgba("+o.r+","+o.g+","+o.b+",1)":"",id:i};if("--EMPTY--"!=e){let r=this.calculateAMT(e,this._categoryHash[i].ids,t);n.amt=r}r.push(n)}return r}async calculateGradientDataExpanded(e){let t=await this.getExpandedTableData(),r=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let i=0;i<t.length;i++){let o=parseFloat(t[i][e]);isNaN(o)||(o<r&&(r=o),o>a&&(a=o))}let i=a-r;this.expandedColorsHash=[];for(let a=0;a<t.length;a++){let o=parseFloat(t[a][e]);if(!isNaN(o)){let e=(o-r)/i*255;this.expandedColorsHash[t[a].id]=new Communicator.Color(e,e,e)}}}async calculateGradientData(e){let t=await this.getTableData(),r=Number.MAX_VALUE,a=-Number.MAX_VALUE;for(let i=0;i<t.length;i++){let o;o="num"==e?parseInt(t[i].num):parseFloat(t[i][e]),isNaN(o)||(o<r&&(r=o),o>a&&(a=o))}let i=a-r;for(let a=0;a<t.length;a++){let o;if(o="num"==e?parseInt(t[a].num):parseFloat(t[a][e]),!isNaN(o)){let e=(o-r)/i*255;this._categoryHash[t[a].id].color=new Communicator.Color(e,e,e)}}}async caculateExpandedColorsGradient(e,t,r,a){let i=e,o=await this.getExpandedTableData(t,r,a),s=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let e=0;e<o.length;e++){let t;t="prop1"==i?parseFloat(o[e].prop1):parseFloat(o[e].prop2),t<s&&(s=t),t>n&&(n=t)}let l=n-s,c=[];for(let e=0;e<o.length;e++){let t;t="prop1"==i?parseFloat(o[e].prop1):parseFloat(o[e].prop2);let r=(t-s)/l*256;c.push({id:o[e].id,colorsav:r,color:"rgba("+r+","+r+","+r+",1)"})}return c}convertColor(e){switch(e){case"red":return new Communicator.Color(255,0,0);case"green":return new Communicator.Color(0,255,0);case"blue":return new Communicator.Color(0,0,255);case"yellow":return new Communicator.Color(255,255,0);case"brown":return new Communicator.Color(150,75,0);case"black":return new Communicator.Color(0,0,0);case"white":return new Communicator.Color(255,255,255);case"orange":return new Communicator.Color(255,165,0);case"grey":return new Communicator.Color(128,128,128)}}}class d{static initialize(e,t){d._maindiv=e,d._manager=t,d._viewer=t._viewer,d._isPropertyView=!1,d._tablePropertyAMT="--EMPTY--",d._aggType="sum",d._tablePropertyExpanded1="--EMPTY--",d._tablePropertyExpanded2="--EMPTY--",d._table=null,d._selectionFromTable=!1,d._viewer.setCallbacks({selectionArray:function(e,t){!d._selectionFromTable&&d._table&&d._table.deselectRow()}}),d.display()}static async display(){let e="";e+='<div id = "SmartSearchReportsUIMain" style="position:absolute;width:100%;height:100%;font-size:12px">',e+='<div id = "SmartSearchReportsUIOptions" style="background:white;position:absolute;width:325px;height:100%"></div>',e+='<div id = "SmartSearchReportsUITabulator" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px"></div>',e+='<div id = "SmartSearchReportsUIOptionsExpanded" style="background:white;position:absolute;width:325px;height:100%;display:none"></div>',e+='<div id = "SmartSearchReportsUITabulatorExpanded" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px;display:none"></div>',e+="</div>",$("#"+d._maindiv).empty(),$("#"+d._maindiv).append('<div id = "SmartSearchReportsUIMain" style="position:absolute;width:100%;height:100%;font-size:12px"><div id = "SmartSearchReportsUIOptions" style="background:white;position:absolute;width:325px;height:100%"></div><div id = "SmartSearchReportsUITabulator" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px"></div><div id = "SmartSearchReportsUIOptionsExpanded" style="background:white;position:absolute;width:325px;height:100%;display:none"></div><div id = "SmartSearchReportsUITabulatorExpanded" style="position:absolute;left:325px;width:calc(100% - 325px);height:100%;font-size:12px;display:none"></div></div>')}static getAmountStrings(e){let t=[];t.push("--EMPTY--");for(let r=0;r<e.length;r++){let a=e[r].toLowerCase();if(-1!=a.indexOf("version")||-1!=a.indexOf("globalid")||-1!=a.indexOf("name")||-1!=a.indexOf("date")||-1!=a.indexOf("persistentid"))continue;let i=d._manager._allPropertiesHash[e[r]];if(null!=i)for(let a in i){isNaN(parseFloat(a))||t.push(e[r]);break}}return t}static _orgPropertySelected(){d._report._orgProperties.push($("#SmartSearchOrgPropSelect")[0].value),d._generateSettingsWindow()}static _tablePropertySelected(){d._report._tableParams.push({prop:$("#SmartSearchTablePropSelect")[0].value}),d._generateSettingsWindow()}static _tablePropertySelectedExpanded(){d._report._tableParamsExpanded.push({prop:$("#SmartSearchTablePropSelectExpanded")[0].value}),d._generateSettingsWindowExpanded()}static _propertySelected(){d._results.setTableProperty($("#SmartSearchPropSelect")[0].value),p._currentSearch.setAutoColors(null,null),d._generatePropertyView()}static _propertyExpandedSelected(e){0==e?d._tablePropertyExpanded0=$("#SmartSearchPropExpandedSelect0")[0].value:1==e&&(d._tablePropertyExpanded1=$("#SmartSearchPropExpandedSelect1")[0].value),d.generateExpandedResults()}static _propertyAggTypeSelected(){d._aggType=$("#SmartSearchPropAggType")[0].value,d._generatePropertyView()}static _propertyAMTSelected(){d._tablePropertyAMT=$("#SmartSearchPropSelectAMT")[0].value,d._generatePropertyView()}static applyColors(){for(let e in d._report.getCategoryHash())d._report.getCategoryHash()[e].color&&p._viewer.model.setNodesFaceColor(d._report.getCategoryHash()[e].ids,d._report.getCategoryHash()[e].color)}static _assignColorsMainGradient(){let e=d._table.getRows(),t=256/e.length;for(let r=0;r<e.length;r++){let a=t*e[r].getPosition();d._report.getCategoryHash()[e[r].getData().id].color=new Communicator.Color(a,a,a)}d._updateColorsInTable()}static _updateColorsInTableExpanded(){let e=[];for(let t in d._report.getExpandedColorsHash()){let r,a=d._report.getExpandedColorsHash()[t];r=a?{color:"rgba("+a.r+","+a.g+","+a.b+",1)",id:t}:{color:null,id:t},e.push(r)}d._table.updateData(e)}static _updateColorsInTable(){let e=[];for(let t in d._report.getCategoryHash()){let r,a=d._report.getCategoryHash()[t].color;r=a?{color:"rgba("+a.r+","+a.g+","+a.b+",1)",id:t}:{color:null,id:t},e.push(r)}d._table.updateData(e)}static _assignExpandedColorsGradient(e){let t=d._results.caculateExpandedColorsGradient(e,this._expandedNodeIds,this._tablePropertyExpanded0,this._tablePropertyExpanded1);d._table.updateData(t)}static applyExpandedColors(){let e=d._table.getRows();for(let t=0;t<e.length;t++){let r=e[t].getData().id;p._viewer.model.setNodesFaceColor([parseInt(r)],d._report.getExpandedColorsHash()[r])}}static async _assignColorsGradientExpanded(e){await d._report.calculateGradientDataExpanded(e),d._updateColorsInTableExpanded()}static async _assignColorsGradient(e){let t=e;"org"!=e||!(!d._report._orgProperties.length>1)&&d._report.isNumberProp(d._report._orgProperties[0])?(await d._report.calculateGradientData(t),d._updateColorsInTable()):d._assignColorsMainGradient()}static assignColorsRandom(){for(let e in d._report.getCategoryHash()){let t=new Communicator.Color(Math.floor(256*Math.random()),Math.floor(256*Math.random()),Math.floor(256*Math.random()));d._report.getCategoryHash()[e].color=t}d._updateColorsInTable()}static _clearColors(){let e=[];for(let t in d._report.getCategoryHash()){d._report.getCategoryHash()[t].color=void 0;let r={color:null,id:t};e.push(r)}d._table.updateData(e)}static _clearColorsExpanded(){d._report.clearExpandedColorsHash();let e=d._table.getRows(),t=[];for(let r=0;r<e.length;r++){let a={color:null,id:e[r].getData().id};t.push(a)}d._table.updateData(t)}static generateReport(e){d._report=e,d._generateSettingsWindow()}static _deleteFromButton(e,t){let r=$(e).prev()[0].innerHTML;0==t?d._report.deleteOrgProperty(r):d._report.deleteTableParams(r),d._generateSettingsWindow()}static _deleteFromButtonExpanded(e){let t=$(e).prev()[0].innerHTML;d._report.deleteTableParamsExpanded(t),d._generateSettingsWindowExpanded()}static _setColumnAggregator(e,t){if(-1!=e.indexOf("tableParams")){let r=parseInt(e.split("tableParams")[1]);d._report.getTableParams()[r].aggtype=t,d._generateTable(!1)}}static _generateOrgButton(e,t){let r="";return r+='<button class="rectangular-button">',r+="<span>"+e+'</span><span onclick = "hcSmartSearch.SmartSearchReportsUI._deleteFromButton(this,'+t+')" class="x">&times;</span>',r+="</button>",r}static _generateExpandedButton(e){let t="";return t+='<button class="rectangular-button">',t+="<span>"+e+'</span><span onclick = "hcSmartSearch.SmartSearchReportsUI._deleteFromButtonExpanded(this)" class="x">&times;</span>',t+="</button>",t}static async _generateTable(e=!0){e&&await d._report.generateTableHash();let t=[{label:"<i class='fas fa-user'></i> Single",action:async function(e,t){d._setColumnAggregator(t.getDefinition().field,"single")}},{label:"<i class='fas fa-user'></i> Sum",action:async function(e,t){d._setColumnAggregator(t.getDefinition().field,"sum")}},{separator:!0},{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],r=[{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],a=[{label:"<i class='fas fa-user'></i> View Category",action:async function(e,t){d._report.initializeExpanded(t.getData().id),d._generateSettingsWindowExpanded(),d._generateExpandedTable()}},{label:"<i class='fas fa-user'></i> View All",action:async function(e,t){d._report.initializeExpanded(),d._generateSettingsWindowExpanded(),d._generateExpandedTable()}}];$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>');let i=[],o={title:d._report.getOrgString(),field:"org",sorter:"string",headerMenu:r};1==d._report._orgProperties.length&&d._report.isNumberProp(o.title)&&(o.sorter="number"),i.push(o),i.push({title:"#",field:"num",width:65,bottomCalc:"sum",headerMenu:r});let s=await d._report.determineColumnTypes();for(let e=0;e<d._report._tableParams.length;e++){let r=d._report._tableParams[e].prop;s[e].isNumber&&(null!=s[e].unit&&(r+="("+s[e].unit+")"),d._report._tableParams[e].aggtype&&"sum"!=d._report._tableParams[e].aggtype||(r+=" Σ"));let a={title:r,field:"tableParams"+e,headerMenu:t};s[e].isNumber&&(a.sorter="number"),s[e].isNumber&&(d._report._tableParams[e].aggtype&&"sum"!=d._report._tableParams[e].aggtype||(a.bottomCalc="sum")),i.push(a)}i.push({title:"Color",field:"color",headerSort:!1,field:"color",editor:"list",width:45,formatter:"color",editorParams:{values:["empty","red","green","blue","yellow","brown","orange","grey","black","white"]}}),i.push({title:"ID",field:"id",width:20,visible:!1}),d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:16,selectable:!0,selectableRangeMode:"click",layout:"fitColumns",columns:i,rowContextMenu:a}),d._table.on("tableBuilt",(async function(){let e=await d._report.getTableData();d._table.setData(e)})),d._table.on("rowSelectionChanged",(async function(e,t){d._selectionFromTable=!0;let r=d._table.getSelectedData();d._viewer.selectionManager.clear();let a=[];for(let e=0;e<r.length;e++){let t=d._report.getCategoryHash()[r[e].id].ids;for(let e=0;e<t.length;e++)a.push(new Communicator.Selection.SelectionItem(t[e]))}d._viewer.selectionManager.add(a),d._selectionFromTable=!1})),d._table.on("cellEdited",(function(e){if("color"==e.getField()){let t,r=e.getRow().getData();t="empty"!=r.color?d._report.convertColor(r.color):null,d._report.getCategoryHash()[r.id].color=t;let a=d._table.getSelectedData();if(a.length>1)for(let e=0;e<a.length;e++)d._report.getCategoryHash()[a[e].id].color=t;d._updateColorsInTable()}}))}static async _generateSettingsWindow(){let e=await d._report.getAllProperties();e.unshift("Choose Property"),$("#SmartSearchReportsUIOptions").empty();let t='<div style="height:55px;">';t+='<span style="top:0px;position:relative"><span style="font-family:courier">Organize by:</span><select id="SmartSearchOrgPropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._orgPropertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let r=0;r<e.length;r++)t+='<option value="'+e[r]+'">'+e[r]+"</option>\n";t+="</select></span>";for(let e=0;e<d._report._orgProperties.length;e++)t+=d._generateOrgButton(d._report._orgProperties[e],0);t+='<br><br><span style="top:0px;position:relative"><span style="font-family:courier">Params:</span><select id="SmartSearchTablePropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._tablePropertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let r=0;r<e.length;r++)t+='<option value="'+e[r]+'">'+e[r]+"</option>\n";t+="</select></span>";for(let e=0;e<d._report._tableParams.length;e++)t+=d._generateOrgButton(d._report._tableParams[e].prop,1);t+='<button class="SmartSearchSearchButton" type="button" style="right:5px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateTable()">Generate</button>',t+='<button class="SmartSearchSearchButton" type="button" style="right:70px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyColors()">Apply Colors</button>',t+="</div>",$("#SmartSearchReportsUIOptions").append(t)}static async _generateExpandedTable(){let e=[{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradientExpanded(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColorsExpanded()}}];$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>');let t=[];for(let r=0;r<d._report.getTableParamsExpanded().length;r++){let a=d._report.getTableParamsExpanded()[r].prop;if(d._report.isNumberProp(d._report.getTableParamsExpanded()[r].prop)){let e=d._report.getAMTUnit(d._report.getTableParamsExpanded()[r].prop);e&&(a+="("+e+")")}let i={title:a,field:"tableParams"+r};d._report.isNumberProp(d._report.getTableParamsExpanded()[r].prop)&&(i.sorter="number",i.headerMenu=e),t.push(i)}t.push({title:"Color",field:"color",headerSort:!1,field:"color",width:45,formatter:"color"}),t.push({title:"ID",field:"id",width:20,visible:!1}),d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:16,layout:"fitColumns",selectable:!0,selectableRangeMode:"click",columns:t}),d._table.on("tableBuilt",(async function(){let e=await d._report.getExpandedTableData();d._table.setData(e)})),d._table.on("rowClick",(async function(e,t){let r=t.getData(),a=d._report.getCategoryHash()[r.id].ids;if(d._viewer.selectionManager.clear(),1==a.length)d._viewer.selectionManager.selectNode(a[0],Communicator.SelectionMode.Set);else{let e=[];for(let t=0;t<a.length;t++)e.push(new Communicator.Selection.SelectionItem(a[t]));d._viewer.selectionManager.add(e)}})),d._table.on("rowSelectionChanged",(async function(e,t){d._selectionFromTable=!0;let r=d._table.getSelectedData();d._viewer.selectionManager.clear();let a=[];if(1==r.length)d._viewer.selectionManager.selectNode(r[0].id,Communicator.SelectionMode.Set);else{for(let e=0;e<r.length;e++)a.push(new Communicator.Selection.SelectionItem(r[e].id));d._viewer.selectionManager.add(a)}d._selectionFromTable=!1}))}static async _generateSettingsWindowExpanded(e){let t=await d._report.getAllPropertiesExpanded();t.unshift("Choose Property"),$("#SmartSearchReportsUIOptions").empty();let r='<div style="height:55px;">';r+='<span style="font-weight:700">Expanded Category:'+(null!=d._report.getExpandedCategory()?d._report.getExpandedCategory():"All")+"</span><br><br>",r+='<span style="top:0px;position:relative"><span style="font-family:courier">Params:</span><select id="SmartSearchTablePropSelectExpanded" onchange=\'hcSmartSearch.SmartSearchReportsUI._tablePropertySelectedExpanded();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<t.length;e++)r+='<option value="'+t[e]+'">'+t[e]+"</option>\n";r+="</select></span>";for(let e=0;e<d._report.getTableParamsExpanded().length;e++)r+=d._generateExpandedButton(d._report.getTableParamsExpanded()[e].prop);r+='<button class="SmartSearchSearchButton" type="button" style="right:5px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateExpandedTable()">Generate</button>',r+='<button class="SmartSearchSearchButton" type="button" style="right:70px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyExpandedColors()">Apply Colors</button>',r+='<button class="SmartSearchSearchButton" type="button" style="left:0px;bottom:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI._generateSettingsWindow();hcSmartSearch.SmartSearchReportsUI._generateTable()">Full Report</button>',r+="</div>",$("#SmartSearchReportsUIOptions").append(r)}static async _generatePropertyView(e=!1){p._currentSearch.getAutoColorProperty()&&d._report.setTableProperty(p._currentSearch.getAutoColorProperty());let t=d._report.getAllProperties();if(!e){let e=!1;if(d._report.getTableProperty())for(let r=0;r<t.length;r++)if(t[r]==d._report.getTableProperty()){e=!0;break}e||d._report.setTableProperty(null),d._report.findCategoryFromSearch()}$("#SmartSearchReportsUIOptions").empty();let r=d.getAmountStrings(t),a='<div style="height:55px;"><span style="top:0px;position:relative"><span style="font-family:courier">Prop:</span><select id="SmartSearchPropSelect" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertySelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<t.length;e++)d._report.getTableProperty()==t[e]?a+='<option value="'+t[e]+'" selected>'+t[e]+"</option>\n":a+='<option value="'+t[e]+'">'+t[e]+"</option>\n";a+="</select></span>",a+='<span style="top:24px;left:0px;position:absolute"><span style="font-family:courier">AMT :</span><select id="SmartSearchPropSelectAMT" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyAMTSelected();\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<r.length;e++)d._tablePropertyAMT==r[e]?a+='<option value="'+r[e]+'" selected>'+r[e]+"</option>\n":a+='<option value="'+r[e]+'">'+r[e]+"</option>\n";a+="</select></span>",a+='<span style="top:24px;left:186px;position:absolute"><span style="font-family:courier"></span><select id="SmartSearchPropAggType" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyAggTypeSelected();\' class="SmartSearchPropertyAggTypeSelect" value="">';let i,o=["sum","avg","max","min","med"];for(let e=0;e<o.length;e++)d._aggType==o[e]?a+='<option value="'+o[e]+'" selected>'+o[e]+"</option>\n":a+='<option value="'+o[e]+'">'+o[e]+"</option>\n";a+="</select></span>",a+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:3px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyColors()">Apply Colors</button>',a+="</div>",$("#SmartSearchReportsUIOptions").append(a),$("#SmartSearchReportsUITabulator").empty(),$("#SmartSearchReportsUITabulator").css("overflow","inherit"),$("#SmartSearchReportsUITabulator").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>'),-1!=d._report.getTableProperty().indexOf("Date")&&(i=function(e,t,r,a,i,o,s){let n=new Date(e),l=new Date(t);return n>l?1:n<l?-1:0});let s=[{label:"<i class='fas fa-user'></i> Assign Random Colors",action:async function(e,t){d.assignColorsRandom()}},{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignColorsGradient(t.getDefinition().field)}},{label:"<i class='fas fa-user'></i> Clear Colors",action:async function(e,t){d._clearColors()}}],n=d._report.getTableProperty();if(d._report.isNumberProp(d._report.getTableProperty())){let e=d._report.getAMTUnit(d._report.getTableProperty());e&&(n="("+e+")")}let l=[{title:n,field:"name",sorter:i,headerMenu:s},{title:"#",field:"num",width:65,bottomCalc:"sum",headerMenu:s},{title:"Color",field:"color",headerSort:!1,field:"color",editor:"list",width:45,formatter:"color",editorParams:{values:["red","green","blue","yellow","brown","orange","grey","black","white"]}},{title:"ID",field:"id",width:20,visible:!1}];if("--EMPTY--"!=d._tablePropertyAMT){let e=d._report.getAMTUnit(d._tablePropertyAMT),t="";t=e?d._aggType+"("+e+")":d._aggType,l.splice(1,0,{headerMenu:s,title:t,field:"amt",width:120,bottomCalc:"med"!=d._aggType?d._aggType:void 0})}let c=[{label:"<i class='fas fa-user'></i> View Category",action:async function(e,t){let r=d._report.getCategoryHash()[t.getData().id].ids;if("/*"==d._report.getTableProperty().slice(-2)){let e=t.getData().id.split("/");d._tablePropertyExpanded0=d._report.getTableProperty().slice(0,-2)+"/"+e[0]}else d._tablePropertyExpanded0=d._report.getTableProperty();d._tablePropertyExpanded1=d._tablePropertyAMT,d.generateExpandedResults(r)}},{label:"<i class='fas fa-user'></i> View All",action:async function(e,t){let r=p._founditems.getItems(),a=[];for(let e=0;e<r.length;e++)a.push(r[e].id);d._tablePropertyExpanded0=d._report.getTableProperty(),d._tablePropertyExpanded1=d._tablePropertyAMT,d.generateExpandedResults(a)}}];d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:15,selectable:0,layout:"fitColumns",columns:l,rowContextMenu:c}),d._table.on("rowClick",(async function(e,t){let r=t.getData(),a=d._report.getCategoryHash()[r.id].ids;if(d._viewer.selectionManager.clear(),1==a.length)d._viewer.selectionManager.selectNode(a[0],Communicator.SelectionMode.Set);else{let e=[];for(let t=0;t<a.length;t++)e.push(new Communicator.Selection.SelectionItem(a[t]));d._viewer.selectionManager.add(e)}})),d._table.on("tableBuilt",(function(){let e=d._report.getCategoryTableData(d._tablePropertyAMT,d._aggType);d._table.setData(e)})),d._table.on("cellEdited",(function(e){if("color"==e.getField()){let t=p._currentSearch.getAutoColors();t||(t=[],p._currentSearch.setAutoColors(t,d._report.getTableProperty()));let r=e.getRow().getData();t[r.id]=d._report.convertColor(r.color)}d._table.redraw()}))}static generateExpandedResults(e=null){let t;e?(d._expandedNodeIds=e,t=e):t=d._expandedNodeIds,this._expandedNodeIds=t,-1!=d._tablePropertyExpanded0.indexOf("Node Name")&&(d._tablePropertyExpanded0="Node Type"),$("#"+d._maindiv+"_searchitems").empty(),$("#"+d._maindiv+"_searchitems").css("overflow","inherit"),$("#"+d._maindiv+"_found").empty(),$("#SmartSearchReportsUIFirstRow").css("display","none");let r=d._results.getAllProperties();r.shift(),r.shift();let a='<div style="height:35px;">';a+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:-5px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchReportsUI._generatePropertyView(true)\'>Property View</button>',a+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:17px;position:absolute;" onclick="hcSmartSearch.SmartSearchReportsUI.applyExpandedColors()">Apply Colors</button>',a+='<div style="height:25px;"><span style="top:-5px;position:relative"><span style="font-family:courier">Prop1:</span><select id="SmartSearchPropExpandedSelect0" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyExpandedSelected(0);\' class="SmartSearchPropertyResultsSelect" value="">';for(let e=0;e<r.length;e++)d._tablePropertyExpanded0==r[e]?a+='<option value="'+r[e]+'" selected>'+r[e]+"</option>\n":a+='<option value="'+r[e]+'">'+r[e]+"</option>\n";a+="</select></span>",a+='<span style="top:15px;left:0px;position:absolute"><span style="font-family:courier">Prop2:</span><select id="SmartSearchPropExpandedSelect1" onchange=\'hcSmartSearch.SmartSearchReportsUI._propertyExpandedSelected(1);\' class="SmartSearchPropertyResultsSelect" value="">',r.unshift("--EMPTY--");for(let e=0;e<r.length;e++)d._tablePropertyExpanded1==r[e]?a+='<option value="'+r[e]+'" selected>'+r[e]+"</option>\n":a+='<option value="'+r[e]+'">'+r[e]+"</option>\n";a+="</select></span>",a+="</div>",$("#"+d._maindiv+"_searchitems").append(a),$("#"+d._maindiv+"_searchitems").append('<div class = "SmartSearchReportsUITabulator" id = "SmartSearchReportsUITabulator"></div>'),d._tablePropertyExpanded0;let i,o,s=function(e,t,r,a,i,o,s){let n=new Date(e),l=new Date(t);return"Invalid Date"==n||"Invalid Date"==l?-1:n>l?1:n<l?-1:0},n=[{label:"<i class='fas fa-user'></i> Assign Gradient",action:async function(e,t){d._assignExpandedColorsGradient(t.getDefinition().field)}}],l=[{title:"Name",field:"name"},{title:"ID",field:"id",visible:!1},{title:"Color",field:"color",headerSort:!1,field:"color",width:45,formatter:"color"}],c="";if(d._results.isNumberProp(d._tablePropertyExpanded0)){let e=d._results.getAMTUnit(d._tablePropertyExpanded0);e?(c="("+e+")",i="sum"):c=d._tablePropertyExpanded0}else c=d._tablePropertyExpanded0;if(l.splice(1,0,{headerMenu:n,title:c,field:"prop1",bottomCalc:i,sorter:-1!=d._tablePropertyExpanded0.indexOf("Date")?s:void 0}),"--EMPTY--"!=d._tablePropertyExpanded1){let e="";if(d._results.isNumberProp(d._tablePropertyExpanded1)){let t=d._results.getAMTUnit(d._tablePropertyExpanded1);t?(e="("+t+")",o="sum"):e=d._tablePropertyExpanded1}else e=d._tablePropertyExpanded1;l.splice(2,0,{headerMenu:n,title:e,field:"prop2",bottomCalc:o,sorter:-1!=d._tablePropertyExpanded1.indexOf("Date")?s:void 0})}d._table=new Tabulator("#SmartSearchReportsUITabulator",{rowHeight:15,selectable:!0,selectableRangeMode:"click",layout:"fitColumns",columns:l}),d._table.on("rowSelectionChanged",(async function(e,t){var r=d._table.getSelectedData();d._viewer.selectionManager.clear();let a=[];if(1==r.length)d._viewer.selectionManager.selectNode(r[0].id,Communicator.SelectionMode.Set);else{for(let e=0;e<r.length;e++)a.push(new Communicator.Selection.SelectionItem(r[e].id));d._viewer.selectionManager.add(a)}})),d._table.on("tableBuilt",(function(){let e=d._results.getExpandedTableData(t,d._tablePropertyExpanded0,d._tablePropertyExpanded1);d._table.setData(e)}))}}class h{static _enableReport=!1;static initialize(e,t){h._maindiv=e,h._manager=t,h._viewer=t._viewer,h._viewer.setCallbacks({selectionArray:function(e,t){h.generateSearchResults(p._founditems)}})}static setPopulateReportCallback(e){h._populateReportCallback=e}static setEnableReport(e){h._enableReport=e}static async display(){let e="";e+='<div id = id="'+h._maindiv+'_firstrow" style="position:relative;width:100%;height:15px;top:-8px">',e+='<div style="position:absolute; left:3px;top:5px; font-size:14px;background-color:white" id="'+h._maindiv+'_found"></div>',e+=h._generateDropdown(),e+='<button class="SmartSearchSearchButton" type="button" style="right:5px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchEditorUI.selectAll(this)\'>Select</button>',h._enableReport&&(e+='<button id="SmartSearchToggleViewButton" class="SmartSearchSearchButton" type="button" style="right:90px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchResultsUI._populateReport()\'>Create Report</button>'),e+="</div>",e+='<div id="'+h._maindiv+'_searchitems" class="SmartSearchSearchItems">',e+="</div>",e+='<div style="position:absolute; right:20px;bottom:0px; font-size:12px;background-color:white" id="'+h._maindiv+'_found"></div>',$("#"+h._maindiv).empty(),$("#"+h._maindiv).append(e);const t=document.querySelector("#SmartSearchResultsUIDropdown"),r=document.querySelector("#SmartSearchResultsUIDropdownContent");t.addEventListener("click",(function(){if($(r).hasClass("SmartSearchDropdowShow"))$(t).append(r),$(r).parent().offset();else{$("body").append(r);let e=$(t).offset(),a=e.top,i=e.left,o=$(r).height(),s=$(r).width();a+o>$(window).height()&&(a=$(window).height()-o-10),i+s>$(window).width()&&(i=$(window).width()-s-30),$(r).css("top",a+"px"),$(r).css("left",i+"px")}r.classList.toggle("SmartSearchDropdowShow")})),window.addEventListener("click",(function(e){e.target.matches(".SmartSearchDropdow-button")||r.classList.contains("SmartSearchDropdowShow")&&r.classList.remove("SmartSearchDropdowShow")}))}static _populateReport(){if(null!=h._populateReportCallback)h._populateReportCallback();else{let e=new hcSmartSearch.SmartSearchReport(this._manager,p._founditems);d.generateReport(e)}}static async generateSearchResults(e){if(h._results=e,$("#"+h._maindiv+"_firstrow").css("display","block"),$("#"+h._maindiv+"_searchitems").css("overflow","auto"),$("#"+h._maindiv+"_found").empty(),null==e)return void $("#"+h._maindiv+"_searchitems").empty();let t=e.getItems();1==t.length?$("#"+h._maindiv+"_found").append(t.length+" item found / "+p._founditems.getTotalSearchCount()+" searched"):$("#"+h._maindiv+"_found").append(t.length+" items found / "+p._founditems.getTotalSearchCount()+" searched");let r="",a=!0,i=!1,o=t.length;t.length>2e3&&(o=2e3,i=!0);for(let e=0;e<o;e++){if(e%500==0&&await new Promise((e=>setTimeout(e,1))),a=!a,h._viewer.selectionManager.isSelected(Communicator.Selection.SelectionItem.create(t[e].id))){let i=h._viewer.model.getNodeParent(t[e].id);h._viewer.selectionManager.isSelected(Communicator.Selection.SelectionItem.create(i))?r+=a?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselectedIndirect">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselectedIndirect2">':r+=a?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselected">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItemselected2">'}else r+=a?"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItem1">':"<div onclick='hcSmartSearch.SmartSearchResultsUI._select(\""+t[e].id+'")\' class="SmartSearchSearchItem2">';r+='<div class="SmartSearchSearchItemText">'+p._htmlEncode(t[e].name)+"</div>",r+='<div class="SmartSearchSearchItemChainText">'+p._htmlEncode(t[e].chaintext)+"</div>",r+="</div>"}i&&(r+='<div style="left:3px;" >More...</div>'),$("#"+h._maindiv+"_searchitems").empty(),$("#"+h._maindiv+"_searchitems").append(r),h.adjust()}static adjust(){if(0==$("#"+h._maindiv+"_searchitems").length)return;let e=$("#"+p._maindiv).height()-($("#"+h._maindiv+"_searchitems").offset().top-$("#"+p._maindiv).parent().offset().top);$("#"+h._maindiv+"_searchitems").css({height:e+"px"});let t=e+$("#"+p._maindiv+"_conditions").height()+3;p._showFirstRow&&(t+=$("#"+p._maindiv+"_firstrow").height())}static _select(e){p.ctrlPressed?h._viewer.selectionManager.selectNode(parseInt(e),Communicator.SelectionMode.Toggle):h._viewer.selectionManager.selectNode(parseInt(e),Communicator.SelectionMode.Set),h.generateSearchResults(p._founditems)}static _generateDropdown(){let e="";return e+='<button id="SmartSearchResultsUIDropdown" style="right:56px;top:3px;position:absolute;" class="SmartSearchSearchButton SmartSearchDropdow-button">...</button>',e+='<ul  id="SmartSearchResultsUIDropdownContent" style="position:absolute;z-index:10000" class="SmartSearchDropdow-content">',e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.selectAll(this)'>Select</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().isolateAll(this)'>Isolate</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(true)'>Show</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(false)'>Hide</li>",e+="<li >---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,0,0))'>Red</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,255,0))'>Green</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,0,255))'>Blue</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,255,0))'>Yellow</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(128,128,128))'>Grey</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(0.7)'>Transparent</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(1)'>Opaque</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(false)'>Not Selectable</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(true)'>Selectable</li>",e+="</ul>","<button id=\"SmartSearchResultsUIDropdown\" style=\"right:56px;top:3px;position:absolute;\" class=\"SmartSearchSearchButton SmartSearchDropdow-button\">...</button><ul  id=\"SmartSearchResultsUIDropdownContent\" style=\"position:absolute;z-index:10000\" class=\"SmartSearchDropdow-content\"><li onclick='hcSmartSearch.SmartSearchEditorUI.selectAll(this)'>Select</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().isolateAll(this)'>Isolate</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(true)'>Show</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().makeVisible(false)'>Hide</li><li >---</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,0,0))'>Red</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,255,0))'>Green</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(0,0,255))'>Blue</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(255,255,0))'>Yellow</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().colorize(new Communicator.Color(128,128,128))'>Grey</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(0.7)'>Transparent</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setOpacity(1)'>Opaque</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(false)'>Not Selectable</li><li onclick='hcSmartSearch.SmartSearchEditorUI.getFoundItems().setSelectable(true)'>Selectable</li></ul>"}}class p{static _chainSkip=0;static _showFirstRow=!0;static _showPropertyStats=!0;static _hideIFCProperties=!1;static _searchResultsCallback=null;static _transparencyMode=1;static _htmlEncode(e){return(e=$.trim(e)).replace(/[&"'\<\>]/g,(function(e){switch(e){case"&":return"&amp;";case"'":return"&#39;";case'"':return"&quot;";case"<":return"&lt;";default:return"&gt;"}}))}static async initialize(e,t,r){p.ctrlPressed=!1,$(document).on("keyup keydown",(function(e){p.shiftPressed=e.shiftKey,p.ctrlPressed=e.ctrlKey})),p._maindiv=e,p._manager=t,p._viewer=t._viewer,p._currentSearch=new hcSmartSearch.SmartSearch(p._manager,r),p._currentSearch.tempId=0,new ResizeObserver((function(){p.adjust()})).observe($("#"+p._maindiv)[0]),p._searchResultsCallback||h.initialize(p._maindiv+"_resultscontainer",t),await p._manager.initialize(),await p.display()}static setHideIFCProperties(e){p._hideIFCProperties=e}static setChainSkip(e){p._chainSkip=e}static showFirstRow(e){p._showFirstRow=e}static showPropertyStats(e){p._showPropertyStats=e}static setSearchResultsCallback(e){p._searchResultsCallback=e}static _generateDropdown(){let e="";return e+='<button style="right:57px;top:3px;position:absolute;" class="SmartSearchSearchButton SmartSearchDropdow-button">...</button>',e+='<ul style="position:absolute;z-index:10000" class="SmartSearchDropdow-content">',e+='<li id="'+p._maindiv+'searchChildren"onclick=\'hcSmartSearch.SmartSearchEditorUI._setSearchChildren(this)\'><span style="left:-5px;position:absolute;">&#x2714</span>Search Children</li>',e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._setSearchVisible(this)'>Search Visible</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._setFilterBodies(this)'>Filter Bodies</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._limitSelection(this)'>Limit to Selection</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._limitSelectionShow(this)'>Show Limit Nodes</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._toggleLighting()'>Toggle Lighting</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesFaceColor([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],Communicator.Color.white())'>Set Model to White</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesVisibility([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],false)'>Hide Model</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],0.75)'>Set Model Transparent (Low)</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],0.15)'>Set Model Transparent (High)</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setNodesOpacity([hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],1)'>Set Model Opaque</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._transparencyMode ? hcSmartSearch.SmartSearchEditorUI._transparencyMode = 0 : hcSmartSearch.SmartSearchEditorUI._transparencyMode = 1; hcSmartSearch.SmartSearchEditorUI._viewer.view.setTransparencyMode(hcSmartSearch.SmartSearchEditorUI._transparencyMode)'>Toggle Transparency Mode</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],true)'>Set Model Unselectabe</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI._viewer.model.setInstanceModifier(Communicator.InstanceModifier.DoNotSelect,[hcSmartSearch.SmartSearchEditorUI._viewer.model.getRootNode()],false)'>Set Model Selectable</li>",e+="<li>---</li>",e+="<li onclick='hcSmartSearch.SmartSearchEditorUI.resetModel()'>Reset Model</li>",e+="</ul>",e}static _toggleLighting(){p._viewer.view.setLightingEnabled(!p._viewer.view.getLightingEnabled())}static async display(){let e="";if(e+='<div class = "SmartSearchMain" id="'+p._maindiv+'_main">',p._showFirstRow&&(e+='<div id = "SmartSearchEditorUIFirstRow">',e+='<div style="position:relative;height:20px;"></div>',e+=p._generateDropdown(),e+='<button class="SmartSearchSearchButtonImportant" type="button" style="right:5px;top:3px;position:absolute;" onclick=\'hcSmartSearch.SmartSearchEditorUI.search()\'>Search</button>',e+='<hr class="SmartSearchEditorUIDivider">',e+="</div>"),e+='<div id="'+p._maindiv+'_conditions" class="SmartSearchSearchtoolsConditions">',e+=await p._generateConditions(),e+="</div>",p._searchResultsCallback||(e+="<hr>",e+='<div id="'+p._maindiv+'_resultscontainer"</div>'),e+="</div>",$("#"+p._maindiv).empty(),$("#"+p._maindiv).append(e),p._searchResultsCallback||h.display(),p._showFirstRow){const e=document.querySelector(".SmartSearchDropdow-button"),t=document.querySelector(".SmartSearchDropdow-content");e.addEventListener("click",(function(){if($(t).hasClass("SmartSearchDropdowShow"))$(e).append(t),$(t).parent().offset();else{$("body").append(t);let r=$(e).offset(),a=r.top,i=r.left,o=$(t).height(),s=$(t).width();a+o>$(window).height()&&(a=$(window).height()-o-10),i+s>$(window).width()&&(i=$(window).width()-s-30),$(t).css("top",a+"px"),$(t).css("left",i+"px")}t.classList.toggle("SmartSearchDropdowShow")})),window.addEventListener("click",(function(e){e.target.matches(".SmartSearchDropdow-button")||t.classList.contains("SmartSearchDropdowShow")&&t.classList.remove("SmartSearchDropdowShow")}))}p._generateSearchResults(),p._addFilterFromUI(!1,0),p._showFirstRow&&p._setDefaultSettingsUI()}static getFilter(){return p._currentSearch}static adjust(){p._searchResultsCallback||h.adjust()}static flush(){$("#"+p._maindiv).empty()}static async search(e=!1){p.updateFilterFromUI(),p.clearSearchResults(),$("#SmartSearchEditorUIFirstRow").css("opacity",.5),$("#SmartSearchEditorUIFirstRow").css("pointer-events","none"),p._searchResultsCallback||$("#"+h._maindiv+"_found").append("Searching...");let t=await p._currentSearch.execute();$("#SmartSearchEditorUIFirstRow").css("opacity",""),$("#SmartSearchEditorUIFirstRow").css("pointer-events","");let r=p._currentSearch.getStartNode();p._founditems=new hcSmartSearch.SmartSearchResult(this._manager,p._currentSearch),p._founditems.generateItems(t,r,p._chainSkip),p._generateSearchResults(),e&&p._currentSearch.performAction(t)}static _getSmartSearchFromTempId(e){if(0==e)return p._currentSearch;for(let t=0;t<p._currentSearch.getNumConditions();t++){let r=p._currentSearch.getCondition(t);if(r.childFilter&&r.childFilter.tempId==e)return r.childFilter}}static async _updateSearch(){(p._founditems||p._currentSearch.getNumConditions())&&await p.search()}static resetModel(){this._viewer.model.reset(),this._viewer.model.unsetNodesFaceColor([this._viewer.model.getAbsoluteRootNode()]),this._viewer.selectionManager.clear()}static getFoundItems(){return p._founditems}static selectAll(){p.ctrlPressed||p._viewer.selectionManager.clear(),this._founditems.selectAll(),p._generateSearchResults()}static updateFilterFromUI(e){let t;t=e||p._currentSearch;for(let e=0;e<t.getNumConditions();e++){let r=t.getCondition(e);if(r.childFilter)this.updateFilterFromUI(r.childFilter);else{r.conditionType=hcSmartSearch.SmartSearchCondition.convertStringConditionToEnum($("#"+p._maindiv+"_propertyChoiceSelect"+e+"-"+t.tempId)[0].value),r.propertyType=hcSmartSearch.SmartSearchCondition.convertStringPropertyTypeToEnum($("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value);let a=!1;if(r.propertyType==hcSmartSearch.SmartSearchPropertyType.relationship&&(a=!0,r.relationship=hcSmartSearch.SmartSearchCondition.convertStringToRelationshipType($("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value),r.propertyType=hcSmartSearch.SmartSearchPropertyType.nodeName,r.propertyName="Node Name"),null!=$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0]&&(!r.propertyType==hcSmartSearch.SmartSearchPropertyType.SmartSearch?r.text=p._htmlEncode($("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0].value):r.text=$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t.tempId)[0].value),a||(r.propertyName=$("#"+p._maindiv+"_propertyTypeSelect"+e+"-"+t.tempId)[0].value),p._showPropertyStats&&r.propertyName.endsWith(")")){let e=r.propertyName.lastIndexOf("(")-1;r.propertyName=r.propertyName.substring(0,e)}}1==e?r.and="and"==$("#"+p._maindiv+"_andOrchoiceSelect"+e+"-"+t.tempId)[0].value:e>1&&(r.and="and"==$("#"+p._maindiv+"_andOrchoiceSelect1-"+t.tempId)[0].value)}}static async refreshUI(){$("#"+p._maindiv+"_conditions").empty(),$("#"+p._maindiv+"_conditions").append(await p._generateConditions()),p.adjust()}static async _andorchangedFromUI(){p.updateFilterFromUI(),await p.refreshUI()}static async _convertToChildfilter(){let e=p._currentSearch,t=new hcSmartSearch.SmartSearch(p._manager,p._currentSearch.getStartNode());for(let r=0;r<e.getNumConditions();r++){let a=e.getCondition(r);a.childFilter||(t.addCondition(a),e.removeCondition(r),r--)}if(t.getNumConditions()){let r=new hcSmartSearch.SmartSearchCondition;r.propertyName="Node Name",r.setChildFilter(t),e.addCondition(r),await p.refreshUI()}}static async _addFilterFromUI(e,t){let r;p.clearSearchResults(),p.updateFilterFromUI(),r=p._getSmartSearchFromTempId(t);let a=null;if(e&&(a=new hcSmartSearch.SmartSearch(p._manager,p._currentSearch.getStartNode()),a.addCondition(new hcSmartSearch.SmartSearchCondition)),r.getNumConditions()<=1){let e=new hcSmartSearch.SmartSearchCondition;e.propertyName="Node Name",e.setChildFilter(a),r.addCondition(e)}else{let e=r.getCondition(r.getNumConditions()-1),t=new hcSmartSearch.SmartSearchCondition;t.propertyName="Node Name",t.setChildFilter(a),t.setAndOr(e.getAndOr()),r.addCondition(t)}await p.refreshUI()}static _deleteFilter(e,t){p.clearSearchResults(),p.updateFilterFromUI(),p._getSmartSearchFromTempId(t).removeCondition(e),p.refreshUI()}static _setDefaultSettingsUI(){let e="Search Children";p._manager.getKeepSearchingChildren()&&(e='<span style="left:-5px;position:absolute;">&#x2714</span>'+e),$("#"+p._maindiv+"searchChildren").html(e)}static _setSearchChildren(e){p._manager.setKeepSearchingChildren(!p._manager.getKeepSearchingChildren());let t="Search Children";p._manager.getKeepSearchingChildren()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _setSearchVisible(e){p._manager.setSearchVisible(!p._manager.getSearchVisible());let t="Search Visible";p._manager.getSearchVisible()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _setFilterBodies(e){p._manager.setFilterBodies(!p._manager.getFilterBodies());let t="Filter Bodies";p._manager.getFilterBodies()&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static _limitSelectionShow(){let e=p._currentSearch.getLimitSelectionList();p._founditems=new hcSmartSearch.SmartSearchResult(this._manager,p._currentSearch),p._founditems.generateItems(e,p._viewer.model.getRootNode(),0),p.selectAll()}static _limitSelection(e){if(0==p._currentSearch.getLimitSelectionList().length){let e=[],t=p._viewer.selectionManager.getResults();for(let r=0;r<t.length;r++)e.push(t[r].getNodeId());p._currentSearch.limitToNodes(e)}else p._currentSearch.limitToNodes([]);let t="Limit Selection";0!=p._currentSearch.getLimitSelectionList().length&&(t='<span style="left:-5px;position:absolute;">&#x2714</span>'+t),$(e).html(t)}static clearSearchResults(){p._founditems=void 0,p._generateSearchResults()}static _generateSearchResults(){p._searchResultsCallback?p._searchResultsCallback(p._founditems):h.generateSearchResults(p._founditems)}static _generateAndOrChoiceSelect(e,t,r){if(0==t||t>1)return 0==t?e.childFilter?'<span style="top:7px;left:6px;position:relative;font-size:14px; margin-top:2px;height:20px;width:50px;max-width:50px;min-width:50px">Where:</span>':'<span style="top:7px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;width:50px;max-width:50px;min-width:50px">Where:</span>':'<span style="top:5px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;max-width:50px;min-width:50px">'+(e.and?"and":"or")+"</span>";{let a='<span style="top:5px;left:6px;position:relative;font-size:14px; margin-top:2px;width:50px;max-width:50px;min-width:50px">';return a+='<select class="SmartSearchSearchSelect" onchange=\'hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI()\' id="'+p._maindiv+"_andOrchoiceSelect"+t+"-"+r.tempId+'" value="">\n',e.and?(a+='<option value="and" selected>and</option>\n',a+='<option value="or">or</option>\n'):(a+='<option value="and">and</option>\n',a+='<option value="or" selected>or</option>\n'),a+="</select></span>\n",a}}static _generateChoiceSelect(e,t,r){let a,i='<select onchange=\'hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI()\' class="SmartSearchAndOrSelect" id="'+p._maindiv+"_propertyChoiceSelect"+t+"-"+r.tempId+'" value="">\n';a="SmartSearch"==e.propertyName?["=","≠"]:"Bounding"==e.propertyName?["evaluate"]:"COG"==e.propertyName?["contains","evaluate","exists"]:["contains","exists","!exists","regex","!regex",">=","<=",">=(Date)","<=(Date)","=","≠"];for(let t=0;t<a.length;t++)a[t]==hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(e.conditionType)?i+='<option selected value="'+a[t]+'">'+a[t]+"</option>\n":i+='<option value="'+a[t]+'">'+a[t]+"</option>\n";return i+="</select>\n",i}static _clearInputField(e,t){$("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t)[0]&&($("#"+p._maindiv+"_modeltreesearchtext"+e+"-"+t)[0].value="")}static _generatePropertyTypeSelect(e,t,r){let a="<select onchange='hcSmartSearch.SmartSearchEditorUI._clearInputField("+t+","+r.tempId+');hcSmartSearch.SmartSearchEditorUI._andorchangedFromUI();\' class="SmartSearchPropertyTypeSelect" id="'+p._maindiv+"_propertyTypeSelect"+t+"-"+r.tempId+'" value="">\n',i=p._manager.getAllProperties(p._hideIFCProperties);if(p._showPropertyStats)for(let e=0;e<i.length;e++){p._showPropertyStats;let t=p._manager.getNumOptions(i[e]);if(t){let r=p._manager.getNumOptionsUsed(i[e]);i[e]=i[e]+" ("+t+"/"+r+")"}}let o=e.propertyName;if(p._showPropertyStats){let e=p._manager.getNumOptions(o);e&&(o=o+" ("+e+"/"+p._manager.getNumOptionsUsed(o)+")")}for(let e=0;e<i.length;e++)o==i[e]?a+='<option value="'+i[e]+'" selected>'+i[e]+"</option>\n":a+='<option value="'+i[e]+'">'+i[e]+"</option>\n";return a+="</select>\n",a}static async _updateBoundingDatalist(e){let t=[],r=hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getResults();for(let e=0;e<r.length;e++)t.push(r[e].getNodeId());if(t.length>0){let r=await hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodesBounding(t),a="bounds:"+r.min.x+" "+r.min.y+" "+r.min.z+" "+r.max.x+" "+r.max.y+" "+r.max.z;$(e).next().html('<option value="'+a+'"></option>')}else $(e).next().html('<option value=""></option>')}static async _updateColorDatalist(e){if(hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getLast()){let t=hcSmartSearch.SmartSearchEditorUI._viewer.selectionManager.getLast().getNodeId(),r=hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodeChildren(t);r.length>0&&(t=r[0]);let a=await hcSmartSearch.SmartSearchEditorUI._viewer.model.getNodesEffectiveFaceColor([t]);$(e).next().html('<option value="'+a[0].r+" "+a[0].g+" "+a[0].b+'"></option>')}else $(e).next().html('<option value=""></option>')}static async _generateInput(e,t,r){let a="";a="Bounding"==e.propertyName?'<input type="search" onfocus="hcSmartSearch.SmartSearchEditorUI._updateBoundingDatalist(this)" class = "valueinput" list="datalist'+t+"-"+r.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+r.tempId+'" value="'+e.text+'">\n':"Node Color"==e.propertyName?'<input type="search" onfocus="hcSmartSearch.SmartSearchEditorUI._updateColorDatalist(this)" class = "valueinput" list="datalist'+t+"-"+r.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+r.tempId+'" value="'+e.text+'">\n':'<input type="search" class = "valueinput" list="datalist'+t+"-"+r.tempId+'" id="'+p._maindiv+"_modeltreesearchtext"+t+"-"+r.tempId+'" value="'+p._htmlEncode(e.text)+'">\n',a+='<datalist id="datalist'+t+"-"+r.tempId+'">\n';let i=[];if("Node Type"==e.propertyName)for(const e in Communicator.NodeType)isNaN(parseFloat(Communicator.NodeType[e]))&&i.push(Communicator.NodeType[e]);else if("SmartSearch"==e.propertyName){let e=p._manager.getSmartSearchs();for(let t=0;t<e.length;t++)i.push(e[t].getName())}else{let t=p._manager.getAllOptionsForProperty(e.propertyName);for(let e in t)i.push(e)}i.sort();for(let t=0;t<i.length;t++)e.propertyName==i[t]?a+='<option value="'+i[t]+'" selected></option>\n':a+='<option value="'+i[t]+'"></option>\n';return a+="</datalist>\n",a}static _generateTrashBin(){let e='<div title = "Delete condition" class="icon-trash" style="float: left;">';return e+='<div class="trash-lid"></div>',e+='<div class="trash-container"></div>',e+='<div class="trash-line-1"></div>',e+='<div class="trash-line-2"></div>',e+='<div class="trash-line-3"></div>',e+="</div>",'<div title = "Delete condition" class="icon-trash" style="float: left;"><div class="trash-lid"></div><div class="trash-container"></div><div class="trash-line-1"></div><div class="trash-line-2"></div><div class="trash-line-3"></div></div>'}static async _generateConditions(e,t){let r,a="";e?r=e:(p.tempId=0,r=p._currentSearch),r.tempId=p.tempId,e&&(a+='<div class = "SmartSearchChildCondition" style = "position:relative;left:65px;top:-10px">');for(let t=0;t<r.getNumConditions();t++){let i=r.getCondition(t);if(i.childFilter)p.tempId++,a+="<div>",a+='<div style="position:relative;width:10px; height:10px;float:left;top:10px;left:-1px" onclick=\'hcSmartSearch.SmartSearchEditorUI._deleteFilter('+t+","+r.tempId+")'>",a+=p._generateTrashBin(),a+="</div>",a+=p._generateAndOrChoiceSelect(i,t,r),a+=await this._generateConditions(i.childFilter,t),a+="</div>";else{i.relationship&&(a+='<div class="SmartSearchRelationshipTag" style="left:64px;position:relative">Relationship:'+hcSmartSearch.SmartSearchCondition.convertEnumRelationshipTypeToString(i.relationship)+"</div>"),a+='<div style="height:30px;margin-top:-3px">',a+='<div style="position:relative;width:10px; height:10px;float:left;top:10px;left:-1px" onclick=\'hcSmartSearch.SmartSearchEditorUI._deleteFilter('+t+","+r.tempId+")'>",a+=p._generateTrashBin(),a+="</div>",a+=p._generateAndOrChoiceSelect(i,t,r);let o=66;e&&(o*=2),a+=1==t?'<div style="display:flex;position:relative;top:-11px;left:64px;margin-right: 1em;width:calc(100%  - '+o+'px)">':'<div style="display:flex;position:relative;top:-8px;left:64px;margin-right: 1em;width:calc(100%  - '+o+'px)">',a+=p._generatePropertyTypeSelect(i,t,r),a+=p._generateChoiceSelect(i,t,r),"exists"!=hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(i.conditionType)&&"!exists"!=hcSmartSearch.SmartSearchCondition.convertEnumConditionToString(i.conditionType)?a+=await p._generateInput(i,t,r):a+='<div style="position:relative;left:5px;top:0px;width:275px"></div>',a+="</div>",a+="</div>"}}return a+='<button title = "Add new condition" class="SmartSearchSearchButton" type="button" style="margin-top:2px;left:2px;bottom:2px;position:relative;" onclick=\'hcSmartSearch.SmartSearchEditorUI._addFilterFromUI(false,'+r.tempId+")'>Add condition</button>",a+=e?"</div>":'<button title="Add new condition group: hold down Shift to convert existing conditions to group" class="SmartSearchSearchButton" type="button" style="left:4px;bottom:2px;position:relative;" onclick=\'!hcSmartSearch.SmartSearchEditorUI.shiftPressed ? hcSmartSearch.SmartSearchEditorUI._addFilterFromUI(true,'+r.tempId+") : hcSmartSearch.SmartSearchEditorUI._convertToChildfilter(true,"+r.tempId+")'>Add condition group</button>",a}}class m{static _updatedCallback=null;static _showButtonRow=!0;static initialize(e,t,r){m._manager=t,m._viewer=t._viewer,m._table=null,m._uidiv=e,m._showButtonRow&&($("#"+m._uidiv).append('<button title = "Add search to SmartSearch Manager" class="SmartSearchSearchButton" id="SmartSearchManagerAddCurrentFilter" type="button" style="top:2px">Add</button>'),$("#"+m._uidiv).append('<button title = "Execute all queries" class="SmartSearchSearchButton" id="SmartSearchManagerExecute" type="button" style="top:2px;margin-left:2px;">Execute</button>'),r&&($("#"+m._uidiv).append('<button class="SmartSearchSearchButton" id="SmartSearchManagerExport" type="button" style="position:absolute;right:0px;top:2px">Export</button>'),$("#"+m._uidiv).append('<button class="SmartSearchSearchButton" id="SmartSearchManagerUpload" type="button" style="position:absolute;right:52px;top:2px">Load</button><input style="display:none" type="file" id="inputupload">'),$("#SmartSearchManagerExport").click((function(){m.exportToFile("SmartSearchfilters.json")})),$("#SmartSearchManagerUpload").click((function(e){e.preventDefault(),$("#inputupload").trigger("click")})),$("#inputupload").change((function(){let e=$("#inputupload")[0].files;e.length>0&&m.load(e[0])}))),$("#SmartSearchManagerAddCurrentFilter").click((function(){m._addCurrentFilter()})),$("#SmartSearchManagerExecute").click((function(){m._executeAllFilters()}))),$("#"+this._uidiv).append('<div id="'+m._uidiv+'Tabulator" class = "SmartSearchManagerTabulator"></div>'),m.refreshUI()}static setUpdatedCallback(e){m._updatedCallback=e}static async load(e){let t=new FileReader;t.onload=async function(e){let t=JSON.parse(e.target.result);m._manager.fromJSON(t),m.refreshUI()},t.readAsText(e)}static async _executeAllFilters(){m._manager.executeSearchActions()}static async _addCurrentFilter(){p.updateFilterFromUI();let e=p.getFilter().toJSON(),t=new hcSmartSearch.SmartSearch(m._manager);t.fromJSON(e),t.clearActions(),t._id=m._manager.generateGUID(),t.setName(""),m._manager.addSmartSearch(t,!1);let r={};r.id=t._id,r.description=t.getName(),await m._table.addRow(r),m._updatedCallback&&m._updatedCallback()}static formatTooltip(e,t){let r=t.getData().id;return m._manager.getSmartSearchByID(r).generateString()}static editCheck(e){return m._editable}static async refreshUI(){if(m._table)await m._table.clearData();else{let e=[{label:"<i class='fas fa-user'></i> Select",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.selectAll()}},{label:"<i class='fas fa-user'></i> Isolate",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().isolateAll()}},{label:"<i class='fas fa-user'></i> Show",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().makeVisible(!0)}},{label:"<i class='fas fa-user'></i> Hide",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().makeVisible(!1)}},{separator:!0},{label:"<i class='fas fa-user'></i> Red",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(255,0,0))}},{label:"<i class='fas fa-user'></i> Green",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(0,255,0))}},{label:"<i class='fas fa-user'></i> Blue",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(0,0,255))}},{label:"<i class='fas fa-user'></i> Yellow",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(255,255,0))}},{label:"<i class='fas fa-user'></i> Grey",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().colorize(new Communicator.Color(128,128,128))}},{label:"<i class='fas fa-user'></i> Transparent",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().setOpacity(.25)}},{label:"<i class='fas fa-user'></i> Opaque",action:async function(e,t){await m._updateEditor(t.getData().id),await p.search(),p.getFoundItems().setOpacity(1)}},{separator:!0},{label:"<i class='fas fa-user'></i> View",action:async function(e,t){let r=t.getData(),a=m._manager.getSmartSearchByID(r.id).toJSON();p.getFilter().fromJSON(a),p.clearSearchResults(),await p.refreshUI()}},{label:"<i class='fas fa-user'></i> Edit Name",action:async function(e,t){m._editable=!0}},{label:"<i class='fas fa-user'></i> Update",action:async function(e,t){m._handleSmartSearchUpdate(t)}},{label:"<i class='fas fa-user'></i> Delete",action:async function(e,t){m._manager.removeSmartSearch(t.getData().id),t.delete(),m._updatedCallback&&m._updatedCallback()}}],t=function(e,t,r){if(null==e.getValue())return e.getValue();switch(e.getValue()){case"red":return'<div style="background:red;color:red;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"green":return'<div style="background:green;color:green;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"blue":return'<div style="background:blue;color:blue;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"yellow":return'<div style="background:yellow;color:yellow;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';case"grey":return'<div style="background:grey;color:grey;width:100%;height:calc(100% - 4px);margin-bottom:3px"></div>';default:return e.getValue()}},r=function(e,t,r,a){switch(t){case"red":return'<span style="background:red;color:red">XXXXXXXXX</span>';case"green":return'<span style="background:green;color:green">XXXXXXXXX</span>';case"blue":return'<span style="background:blue;color:blue">XXXXXXXXX</span>';case"yellow":return'<span style="background:yellow;color:yellow">XXXXXXXXX</span>';case"grey":return'<span style="background:grey;color:grey">XXXXXXXXX</span>';case"":return"None";default:return t}},a=["","Isolate","Show","Hide","Select","Auto Color","red","green","blue","yellow","grey","Transparent","Opaque","Not Selectable","Selectable","Fit Nodes","Fit World"];m._table=new Tabulator("#"+m._uidiv+"Tabulator",{data:[],selectable:0,movableRows:!0,layout:"fitColumns",rowContextMenu:e,columns:[{title:"Name",headerSort:!1,field:"description",formatter:"textarea",editor:"input",editable:m.editCheck,tooltip:m.formatTooltip},{title:"ID",field:"id",width:20,visible:!1},{title:"Action1",headerSort:!1,field:"action0",editor:"list",width:47,formatter:t,editorParams:{values:a,itemFormatter:r}},{title:"Action2",headerSort:!1,field:"action1",editor:"list",width:47,formatter:t,editorParams:{values:a,itemFormatter:r}},{title:"Action3",headerSort:!1,field:"action2",editor:"list",width:47,formatter:t,editorParams:{values:a,itemFormatter:r}},{title:"Prop",headerSort:!1,field:"prop",width:20,hozAlign:"center",formatter:"tickCross",sorter:"boolean",editor:!0,editorParams:{tristate:!1}}]}),m._table.on("rowClick",(async function(e,t){let r=t.getData(),a=m._manager.getSmartSearchByID(r.id),i=a.toJSON();p.getFilter().fromJSON(i),p.clearSearchResults(),await p.refreshUI(),a.hasAction()?await p.search(!0):await p.search()})),m._table.on("rowDblClick",(function(e,t){m._editable=!0})),m._table.on("rowMoved",(function(e){let t=m._table.getRows(),r=[];for(let e=0;e<t.length;e++){let a=t[e].getData();r.push(m._manager.getSmartSearchByID(a.id))}m._manager.setSearches(r)})),m._table.on("cellEdited",(function(e){"description"==e.getField()?(m._handleSmartSearchNameEdit(e.getRow()),m._editable=!1):"prop"==e.getField()?m._handleSmartSearchIsPropEdit(e.getRow()):"action0"==e.getField()?m._handleSmartSearchIsActionEdit(e.getRow(),0):"action1"==e.getField()?m._handleSmartSearchIsActionEdit(e.getRow(),1):"action2"==e.getField()&&m._handleSmartSearchIsActionEdit(e.getRow(),2),m._table.redraw()}))}for(let e=0;e<m._manager.getSmartSearchNum();e++){let t,r=m._manager.getSmartSearch(e);t=""==r.getName()?r.generateString():r.getName();let a={};t=t.replace(/&quot;/g,'"'),a.id=m._manager.getSmartSearchID(e),a.description=t,a.action0=r.getAction(0),a.action1=r.getAction(1),a.action2=r.getAction(2),a.prop=m._manager.getSmartSearch(e).getProp(),await m._table.addRow(a)}}static async _updateEditor(e){let t=m._manager.getSmartSearchByID(e).toJSON();p.getFilter().fromJSON(t),await p.refreshUI()}static async _handleSmartSearchNameEdit(e){let t=e.getData(),r=m._manager.getSmartSearchByID(t.id);r.setName(t.description),""==t.description&&e.update({description:r.getName()}),m._updatedCallback&&m._updatedCallback()}static async _handleSmartSearchIsPropEdit(e){let t=e.getData();m._manager.updateSmartSearchIsProp(t.id,t.prop),m._updatedCallback&&m._updatedCallback()}static async _handleSmartSearchIsActionEdit(e,t){let r=e.getData(),a=m._manager.getSmartSearchByID(r.id);0==t?a.setAction(r.action0,0):1==t?a.setAction(r.action1,1):a.setAction(r.action2,2),m._updatedCallback&&m._updatedCallback()}static _handleSmartSearchUpdate(e){let t=e.getData(),r=m._manager.getSmartSearchByID(t.id);p.updateFilterFromUI();let a=p.getFilter().toJSON(),i=new hcSmartSearch.SmartSearch(m._manager);i.fromJSON(a),r.updateConditions(i._conditions),r.setAutoColors(i.getAutoColors(),i.getAutoColorProperty()),r.setName(""),e.update({description:r.getName()}),m._updatedCallback&&m._updatedCallback()}static exportToFile(e){let t=JSON.stringify(m._manager.toJSON()),r=document.createElement("a");r.setAttribute("download",e),r.href=function(e){let t=new Blob([e],{type:"text/plain"});return window.URL.createObjectURL(t)}(t),document.body.appendChild(r),window.requestAnimationFrame((function(){let e=new MouseEvent("click");r.dispatchEvent(e),document.body.removeChild(r)}))}}class u{static initialize(e,t){u._table=null,u._manager=t,u._viewer=t._viewer,u._uidiv=e,u._viewer.setCallbacks({selectionArray:function(e,t){u._itemSelected()}}),$("#"+this._uidiv).append('<div id="'+u._uidiv+'Tabulator" class="SmartSearchPropertiesTabulator"></div>'),u._refreshUI()}static async _refreshUI(){u._table?await u._table.clearData():u._table=new Tabulator("#"+u._uidiv+"Tabulator",{data:[],dataTree:!0,dataTreeStartExpanded:!0,selectable:1,layout:"fitColumns",columns:[{title:"Name",field:"name"},{title:"Value",field:"value"},{title:"ID",field:"id",width:20,visible:!1}]})}static async _itemSelected(){let e=u._viewer.selectionManager.getResults();if(await u._table.clearData(),e.length>0){let t=e[0].getNodeId(),r=await u._manager.evaluateProperties(t),a=0;for(let e=0;e<r.length;e++){let t=r[e].properties;if(0==t.length){let t={};t.id=a++,t.name=r[e].name,t.value="true",await u._table.addRow(t)}else if(1==t.length){let i={};i.id=a++,i.name=r[e].name,i.value=t[0].name+":"+t[0].value,await u._table.addRow(i)}else{let i={};i.id=a++,i.name=r[e].name;let o=[];for(let e=0;e<t.length;e++){let r={};r.id=a++,r.name=t[e].name,r.value=t[e].value,o.push(r)}i._children=o,await u._table.addRow(i)}}}}}function g(){return"1.1.0"}hcSmartSearch=t})();